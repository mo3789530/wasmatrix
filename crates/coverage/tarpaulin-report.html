<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <style>:root {
  --color: black;
  --bg: white;
  --head-bg: white;
  --link: #338;

  --blue: #ccf;
  --red: #fcc;
  --yellow: #ffc;
  --green: #cfc;
}

[data-theme='dark'] {
  --color: white;
  --bg: black;
  --head-bg: #333;
  --link: #aaf;

  --blue: #225;
  --red: #522;
  --yellow: #552;
  --green: #252;
}

html,
body {
  margin: 0;
  padding: 0;
  color: var(--color);
  background: var(--bg);
}

.app {
  margin: 10px;
  padding: 0;
}

.files-list {
  margin: 10px 0 0;
  width: 100%;
  border-collapse: collapse;
}
.files-list__head {
  border: 1px solid #999;
}
.files-list__head > tr > th {
  padding: 10px;
  border: 1px solid #999;
  text-align: left;
  font-weight: normal;
  background: var(--head-bg);
}
.files-list__body {
}
.files-list__file {
  cursor: pointer;
}
.files-list__file:hover {
  background: var(--blue);
}
.files-list__file > td {
  padding: 10px;
  border: 1px solid #999;
}
.files-list__file > td:first-child::before {
  content: '\01F4C4';
  margin-right: 1em;
}
.files-list__file_low {
  background: var(--red);
}
.files-list__file_medium {
  background: var(--yellow);
}
.files-list__file_high {
  background: var(--green);
}
.files-list__file_folder > td:first-child::before {
  content: '\01F4C1';
  margin-right: 1em;
}

.file-header {
  border: 1px solid #999;
  display: flex;
  justify-content: space-between;
  align-items: center;
  position: sticky;
  top: 0;
  background: var(--bg);
}

.file-header__back {
  margin: 10px;
  cursor: pointer;
  flex-shrink: 0;
  flex-grow: 0;
  text-decoration: underline;
  color: var(--link);
}

.file-header__name {
  margin: 10px;
  flex-shrink: 2;
  flex-grow: 2;
}

.file-header__stat {
  margin: 10px;
  flex-shrink: 0;
  flex-grow: 0;
}

.file-content {
  margin: 10px 0 0;
  border: 1px solid #999;
  padding: 10px;
  counter-reset: line;
  display: flex;
  flex-direction: column;
}

.code-line::before {
  content: counter(line);
  margin-right: 72px;
}
.code-line {
  margin: 0;
  height: 1em;
  counter-increment: line;

  position: absolute;
  padding: 0 0.3em 0.3em 0.3em;
  display: inherit;
  width: 100%;
}
.code-line_covered {
  background: var(--green);
}
.code-line_uncovered {
  background: var(--red);
}

.code-text-container {
  position: relative;
  height: 1em;
  padding: 0.3em 0;
}

.cover-indicator {
  display: flex;
  width: 100%;
  position: absolute;
  justify-content: end;
  height: 1em;
  align-items: center;
  padding: 0 0.3em 0.3em 0.3em;
}

.cover-indicator.check-cover::after {
  content: "\2713";
  font-weight: bold;
  background-color: var(--green);
  height: 1em;
}

.cover-indicator.no-cover::after {
  content: "\2716";
  font-weight: bold;
  background-color: var(--red);
  height: 1em;
}

.stat-line-hit {
  max-width: 48px;
  overflow: hidden;
  font-weight: bold;
  margin-right: 4px;
  background-color: var(--green);
  position: relative;
  top: 0.1em;
}

#theme-toggle-label {
  margin-left: 1ch;
}
</style>
</head>
<body>
    <div id="root"></div>
    <script>
        var data = {"files":[{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-agent","src","lib.rs"],"content":"use std::collections::HashMap;\nuse std::sync::Arc;\nuse tokio::sync::RwLock;\nuse tracing::{error, info, warn};\nuse wasmatrix_core::{\n    CapabilityAssignment, CoreError, InstanceStatus, RestartPolicy, RestartPolicyType, Result,\n};\nuse wasmtime::{Config, Engine, Instance, Module, Store};\n\n/// Handle to a running Wasm instance\npub struct InstanceHandle {\n    pub instance_id: String,\n    pub store: Store\u003c()\u003e,\n    pub instance: Instance,\n    pub module_bytes: Vec\u003cu8\u003e,\n    pub capabilities: Vec\u003cCapabilityAssignment\u003e,\n    pub restart_policy: RestartPolicy,\n}\n\n/// Crash information for restart policy evaluation\n#[derive(Debug, Clone)]\npub struct CrashInfo {\n    pub crash_count: u32,\n    pub last_crash_time: Option\u003cstd::time::Instant\u003e,\n}\n\nimpl CrashInfo {\n    pub fn new() -\u003e Self {\n        Self {\n            crash_count: 0,\n            last_crash_time: None,\n        }\n    }\n\n    pub fn record_crash(\u0026mut self) {\n        self.crash_count += 1;\n        self.last_crash_time = Some(std::time::Instant::now());\n    }\n\n    /// Calculate backoff delay based on crash count\n    pub fn calculate_backoff(\u0026self, base_seconds: u64) -\u003e u64 {\n        // Exponential backoff: base * 2^(crash_count - 1), capped at 5 minutes\n        let exponent = self.crash_count.saturating_sub(1);\n        let delay = base_seconds * 2_u64.pow(exponent.min(8)); // Cap at 256x base\n        delay.min(300) // Cap at 5 minutes\n    }\n}\n\nimpl Default for CrashInfo {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\n/// Restart policy evaluator\npub struct RestartPolicyEvaluator;\n\nimpl RestartPolicyEvaluator {\n    /// Evaluate whether an instance should be restarted based on policy and crash history\n    pub fn should_restart(\n        policy: \u0026RestartPolicy,\n        crash_info: \u0026CrashInfo,\n    ) -\u003e Option\u003cstd::time::Duration\u003e {\n        match policy.policy_type {\n            RestartPolicyType::Never =\u003e {\n                info!(\"Restart policy is 'never', not restarting instance\");\n                None\n            }\n            RestartPolicyType::Always =\u003e {\n                info!(\"Restart policy is 'always', restarting instance immediately\");\n                Some(std::time::Duration::from_secs(0))\n            }\n            RestartPolicyType::OnFailure =\u003e {\n                // Check if we've exceeded max retries (crash count includes current crash)\n                if let Some(max_retries) = policy.max_retries {\n                    if crash_info.crash_count \u003e max_retries {\n                        warn!(\n                            crash_count = crash_info.crash_count,\n                            max_retries = max_retries,\n                            \"Maximum retry count exceeded, not restarting\"\n                        );\n                        return None;\n                    }\n                }\n\n                // Calculate backoff delay\n                let backoff_seconds = policy.backoff_seconds.unwrap_or(5);\n                let delay = crash_info.calculate_backoff(backoff_seconds);\n                info!(delay_seconds = delay, \"Restarting instance with backoff\");\n                Some(std::time::Duration::from_secs(delay))\n            }\n        }\n    }\n}\n\n/// Node Agent manages local Wasm instance execution\npub struct NodeAgent {\n    engine: Engine,\n    instances: Arc\u003cRwLock\u003cHashMap\u003cString, InstanceHandle\u003e\u003e\u003e,\n    crash_history: Arc\u003cRwLock\u003cHashMap\u003cString, CrashInfo\u003e\u003e\u003e,\n    node_id: String,\n}\n\nimpl NodeAgent {\n    pub fn new(node_id: impl Into\u003cString\u003e) -\u003e Result\u003cSelf\u003e {\n        let mut config = Config::new();\n        config.wasm_backtrace_details(wasmtime::WasmBacktraceDetails::Enable);\n\n        let engine = Engine::new(\u0026config).map_err(|e| {\n            CoreError::InvalidInstanceId(format!(\"Failed to create wasmtime engine: {}\", e))\n        })?;\n\n        Ok(Self {\n            engine,\n            instances: Arc::new(RwLock::new(HashMap::new())),\n            crash_history: Arc::new(RwLock::new(HashMap::new())),\n            node_id: node_id.into(),\n        })\n    }\n\n    /// Start a Wasm instance locally\n    pub async fn start_instance_local(\n        \u0026self,\n        instance_id: String,\n        module_bytes: Vec\u003cu8\u003e,\n        capabilities: Vec\u003cCapabilityAssignment\u003e,\n        restart_policy: RestartPolicy,\n    ) -\u003e Result\u003c()\u003e {\n        // Validate module bytes\n        if module_bytes.len() \u003c 4 || \u0026module_bytes[0..4] != \u0026[0x00, 0x61, 0x73, 0x6d] {\n            return Err(CoreError::InvalidInstanceId(\n                \"Invalid Wasm module format\".to_string(),\n            ));\n        }\n\n        // Compile module\n        let module = Module::new(\u0026self.engine, \u0026module_bytes).map_err(|e| {\n            CoreError::InvalidInstanceId(format!(\"Failed to compile Wasm module: {}\", e))\n        })?;\n\n        // Create store with WASI context\n        let mut store = Store::new(\u0026self.engine, ());\n\n        // Instantiate the module\n        let instance = Instance::new(\u0026mut store, \u0026module, \u0026[]).map_err(|e| {\n            CoreError::InvalidInstanceId(format!(\"Failed to instantiate Wasm module: {}\", e))\n        })?;\n\n        info!(instance_id = %instance_id, \"Wasm instance started successfully\");\n\n        // Store the handle\n        let handle = InstanceHandle {\n            instance_id: instance_id.clone(),\n            store,\n            instance,\n            module_bytes,\n            capabilities,\n            restart_policy,\n        };\n\n        let mut instances = self.instances.write().await;\n        instances.insert(instance_id, handle);\n\n        Ok(())\n    }\n\n    /// Stop a running Wasm instance\n    pub async fn stop_instance_local(\u0026self, instance_id: \u0026str) -\u003e Result\u003c()\u003e {\n        let mut instances = self.instances.write().await;\n\n        if instances.remove(instance_id).is_some() {\n            info!(instance_id = %instance_id, \"Wasm instance stopped\");\n            Ok(())\n        } else {\n            Err(CoreError::InvalidInstanceId(format!(\n                \"Instance {} not found\",\n                instance_id\n            )))\n        }\n    }\n\n    /// Handle instance crash detection\n    pub async fn on_instance_crash(\u0026self, instance_id: \u0026str, error: String) -\u003e Option\u003cstd::time::Duration\u003e {\n        error!(instance_id = %instance_id, error = %error, \"Instance crashed\");\n\n        // Record crash in history\n        let mut crash_history = self.crash_history.write().await;\n        let crash_info = crash_history\n            .entry(instance_id.to_string())\n            .or_insert_with(CrashInfo::new);\n        crash_info.record_crash();\n\n        // Get the instance's restart policy\n        let instances = self.instances.read().await;\n        if let Some(handle) = instances.get(instance_id) {\n            let policy = \u0026handle.restart_policy;\n            let delay = RestartPolicyEvaluator::should_restart(policy, crash_info);\n            \n            if delay.is_some() {\n                info!(instance_id = %instance_id, \"Instance will be restarted according to policy\");\n            } else {\n                info!(instance_id = %instance_id, \"Instance will not be restarted according to policy\");\n            }\n            \n            delay\n        } else {\n            warn!(instance_id = %instance_id, \"Crashed instance not found in active instances\");\n            None\n        }\n    }\n\n    /// Get instance status\n    pub async fn get_instance_status(\u0026self, instance_id: \u0026str) -\u003e InstanceStatus {\n        let instances = self.instances.read().await;\n        if instances.contains_key(instance_id) {\n            InstanceStatus::Running\n        } else {\n            InstanceStatus::Stopped\n        }\n    }\n\n    /// Get crash count for an instance\n    pub async fn get_crash_count(\u0026self, instance_id: \u0026str) -\u003e u32 {\n        let crash_history = self.crash_history.read().await;\n        crash_history\n            .get(instance_id)\n            .map(|info| info.crash_count)\n            .unwrap_or(0)\n    }\n\n    /// Restart an instance (internal use)\n    pub async fn restart_instance(\u0026self, instance_id: \u0026str) -\u003e Result\u003c()\u003e {\n        let instances = self.instances.read().await;\n        \n        if let Some(handle) = instances.get(instance_id) {\n            let module_bytes = handle.module_bytes.clone();\n            let capabilities = handle.capabilities.clone();\n            let restart_policy = handle.restart_policy.clone();\n            drop(instances);\n\n            // Stop the old instance\n            self.stop_instance_local(instance_id).await?;\n\n            // Start a new instance with the same parameters\n            self.start_instance_local(\n                instance_id.to_string(),\n                module_bytes,\n                capabilities,\n                restart_policy,\n            )\n            .await?;\n\n            info!(instance_id = %instance_id, \"Instance restarted successfully\");\n            Ok(())\n        } else {\n            Err(CoreError::InvalidInstanceId(format!(\n                \"Instance {} not found for restart\",\n                instance_id\n            )))\n        }\n    }\n\n    /// List all running instances\n    pub async fn list_instances(\u0026self) -\u003e Vec\u003cString\u003e {\n        let instances = self.instances.read().await;\n        instances.keys().cloned().collect()\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    fn create_valid_wasm_module() -\u003e Vec\u003cu8\u003e {\n        // Minimal valid Wasm module (magic bytes + version)\n        vec![0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00]\n    }\n\n    #[tokio::test]\n    async fn test_start_stop_instance() {\n        let agent = NodeAgent::new(\"test-node\").unwrap();\n        let instance_id = \"test-instance-1\".to_string();\n\n        // Start instance\n        agent\n            .start_instance_local(\n                instance_id.clone(),\n                create_valid_wasm_module(),\n                vec![],\n                RestartPolicy::default(),\n            )\n            .await\n            .unwrap();\n\n        // Verify it's running\n        let status = agent.get_instance_status(\u0026instance_id).await;\n        assert_eq!(status, InstanceStatus::Running);\n\n        // Stop instance\n        agent.stop_instance_local(\u0026instance_id).await.unwrap();\n\n        // Verify it's stopped\n        let status = agent.get_instance_status(\u0026instance_id).await;\n        assert_eq!(status, InstanceStatus::Stopped);\n    }\n\n    #[tokio::test]\n    async fn test_invalid_wasm_module() {\n        let agent = NodeAgent::new(\"test-node\").unwrap();\n        let result = agent\n            .start_instance_local(\n                \"test\".to_string(),\n                vec![0x00, 0x00, 0x00, 0x00],\n                vec![],\n                RestartPolicy::default(),\n            )\n            .await;\n\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_restart_policy_never() {\n        let policy = RestartPolicy::never();\n        let crash_info = CrashInfo::new();\n\n        let result = RestartPolicyEvaluator::should_restart(\u0026policy, \u0026crash_info);\n        assert!(result.is_none());\n    }\n\n    #[test]\n    fn test_restart_policy_always() {\n        let policy = RestartPolicy::always();\n        let crash_info = CrashInfo::new();\n\n        let result = RestartPolicyEvaluator::should_restart(\u0026policy, \u0026crash_info);\n        assert_eq!(result, Some(std::time::Duration::from_secs(0)));\n    }\n\n    #[test]\n    fn test_restart_policy_on_failure() {\n        let policy = RestartPolicy::on_failure(3, 5);\n        let mut crash_info = CrashInfo::new();\n\n        // First crash - should restart with 5s delay\n        crash_info.record_crash();\n        let result = RestartPolicyEvaluator::should_restart(\u0026policy, \u0026crash_info);\n        assert_eq!(result, Some(std::time::Duration::from_secs(5)));\n\n        // Second crash - should restart with 10s delay (exponential backoff)\n        crash_info.record_crash();\n        let result = RestartPolicyEvaluator::should_restart(\u0026policy, \u0026crash_info);\n        assert_eq!(result, Some(std::time::Duration::from_secs(10)));\n\n        // Third crash - should restart with 20s delay\n        crash_info.record_crash();\n        let result = RestartPolicyEvaluator::should_restart(\u0026policy, \u0026crash_info);\n        assert_eq!(result, Some(std::time::Duration::from_secs(20)));\n\n        // Fifth crash - exceeds max_retries (3), should not restart\n        crash_info.record_crash();\n        let result = RestartPolicyEvaluator::should_restart(\u0026policy, \u0026crash_info);\n        assert!(result.is_none());\n    }\n\n    #[tokio::test]\n    async fn test_crash_detection() {\n        let agent = NodeAgent::new(\"test-node\").unwrap();\n        let instance_id = \"test-instance-1\".to_string();\n\n        // Start instance with \"always\" restart policy\n        agent\n            .start_instance_local(\n                instance_id.clone(),\n                create_valid_wasm_module(),\n                vec![],\n                RestartPolicy::always(),\n            )\n            .await\n            .unwrap();\n\n        // Simulate crash\n        let delay = agent\n            .on_instance_crash(\u0026instance_id, \"test error\".to_string())\n            .await;\n\n        // Should restart immediately (always policy)\n        assert_eq!(delay, Some(std::time::Duration::from_secs(0)));\n\n        // Verify crash was recorded\n        let crash_count = agent.get_crash_count(\u0026instance_id).await;\n        assert_eq!(crash_count, 1);\n    }\n\n    #[tokio::test]\n    async fn test_list_instances() {\n        let agent = NodeAgent::new(\"test-node\").unwrap();\n\n        // Start multiple instances\n        for i in 0..3 {\n            agent\n                .start_instance_local(\n                    format!(\"instance-{}\", i),\n                    create_valid_wasm_module(),\n                    vec![],\n                    RestartPolicy::default(),\n                )\n                .await\n                .unwrap();\n        }\n\n        let instances = agent.list_instances().await;\n        assert_eq!(instances.len(), 3);\n    }\n\n    #[test]\n    fn test_crash_info_backoff_calculation() {\n        let mut crash_info = CrashInfo::new();\n\n        // Test exponential backoff\n        crash_info.record_crash();\n        assert_eq!(crash_info.calculate_backoff(5), 5); // 5 * 2^0\n\n        crash_info.record_crash();\n        assert_eq!(crash_info.calculate_backoff(5), 10); // 5 * 2^1\n\n        crash_info.record_crash();\n        assert_eq!(crash_info.calculate_backoff(5), 20); // 5 * 2^2\n\n        crash_info.record_crash();\n        assert_eq!(crash_info.calculate_backoff(5), 40); // 5 * 2^3\n\n        // Test capping at 300 seconds\n        for _ in 0..10 {\n            crash_info.record_crash();\n        }\n        assert_eq!(crash_info.calculate_backoff(5), 300); // capped at 300\n    }\n}\n","traces":[{"line":28,"address":[14761104],"length":1,"stats":{"Line":1}},{"line":35,"address":[14760896],"length":1,"stats":{"Line":2}},{"line":36,"address":[14760909,14760960],"length":1,"stats":{"Line":2}},{"line":37,"address":[14760936],"length":1,"stats":{"Line":2}},{"line":41,"address":[14760976],"length":1,"stats":{"Line":1}},{"line":43,"address":[14760995],"length":1,"stats":{"Line":1}},{"line":44,"address":[14761014,14761084],"length":1,"stats":{"Line":1}},{"line":45,"address":[14761068],"length":1,"stats":{"Line":1}},{"line":50,"address":[14761760],"length":1,"stats":{"Line":0}},{"line":51,"address":[14761768],"length":1,"stats":{"Line":0}},{"line":60,"address":[14757152],"length":1,"stats":{"Line":2}},{"line":64,"address":[14757191],"length":1,"stats":{"Line":2}},{"line":66,"address":[14757721,14757230,14757315],"length":1,"stats":{"Line":3}},{"line":67,"address":[14757705],"length":1,"stats":{"Line":1}},{"line":70,"address":[14758151,14758570,14757255],"length":1,"stats":{"Line":3}},{"line":71,"address":[14758541],"length":1,"stats":{"Line":1}},{"line":75,"address":[14757295,14758966],"length":1,"stats":{"Line":2}},{"line":76,"address":[14758976],"length":1,"stats":{"Line":1}},{"line":77,"address":[14759078,14759567],"length":1,"stats":{"Line":2}},{"line":82,"address":[14759551],"length":1,"stats":{"Line":1}},{"line":87,"address":[14758996],"length":1,"stats":{"Line":1}},{"line":88,"address":[14759033],"length":1,"stats":{"Line":1}},{"line":89,"address":[14759046,14760007,14760455],"length":1,"stats":{"Line":3}},{"line":90,"address":[14760422],"length":1,"stats":{"Line":1}},{"line":105,"address":[],"length":0,"stats":{"Line":4}},{"line":106,"address":[],"length":0,"stats":{"Line":4}},{"line":107,"address":[],"length":0,"stats":{"Line":4}},{"line":109,"address":[],"length":0,"stats":{"Line":3}},{"line":110,"address":[],"length":0,"stats":{"Line":0}},{"line":113,"address":[],"length":0,"stats":{"Line":4}},{"line":114,"address":[],"length":0,"stats":{"Line":4}},{"line":115,"address":[],"length":0,"stats":{"Line":6}},{"line":116,"address":[],"length":0,"stats":{"Line":7}},{"line":117,"address":[],"length":0,"stats":{"Line":3}},{"line":122,"address":[14761408],"length":1,"stats":{"Line":1}},{"line":130,"address":[14737854,14738086,14737972],"length":1,"stats":{"Line":7}},{"line":131,"address":[14740664],"length":1,"stats":{"Line":1}},{"line":132,"address":[14738036],"length":1,"stats":{"Line":1}},{"line":137,"address":[14741904,14738312,14738164,14742153,14742147,14740662],"length":1,"stats":{"Line":1}},{"line":138,"address":[14741931,14741999],"length":1,"stats":{"Line":0}},{"line":142,"address":[14738503,14738388],"length":1,"stats":{"Line":3}},{"line":145,"address":[14738709,14742745,14738619,14742496,14742739,14738513],"length":1,"stats":{"Line":4}},{"line":146,"address":[14742523,14742591],"length":1,"stats":{"Line":0}},{"line":149,"address":[14738794,14739236],"length":1,"stats":{"Line":2}},{"line":153,"address":[14739203],"length":1,"stats":{"Line":2}},{"line":161,"address":[14740415,14741152,14737903,14740492],"length":1,"stats":{"Line":3}},{"line":162,"address":[14741390,14741455],"length":1,"stats":{"Line":3}},{"line":164,"address":[14741662],"length":1,"stats":{"Line":1}},{"line":168,"address":[14734816,14734863,14734958,14735006,14735151,14737243],"length":1,"stats":{"Line":4}},{"line":169,"address":[14735064,14734939,14734988,14735185],"length":1,"stats":{"Line":2}},{"line":171,"address":[14735491,14735420,14736313],"length":1,"stats":{"Line":3}},{"line":172,"address":[14736325,14735900],"length":1,"stats":{"Line":2}},{"line":173,"address":[14736301],"length":1,"stats":{"Line":1}},{"line":175,"address":[14735627],"length":1,"stats":{"Line":0}},{"line":183,"address":[14761248,14761266],"length":1,"stats":{"Line":4}},{"line":184,"address":[14725716,14726270,14725863],"length":1,"stats":{"Line":3}},{"line":187,"address":[14727381,14726237,14727505,14725774],"length":1,"stats":{"Line":2}},{"line":188,"address":[14727869,14727732,14727928],"length":1,"stats":{"Line":3}},{"line":189,"address":[14727803],"length":1,"stats":{"Line":1}},{"line":190,"address":[14727889],"length":1,"stats":{"Line":1}},{"line":191,"address":[14727931],"length":1,"stats":{"Line":1}},{"line":194,"address":[14725795,14727953,14728099],"length":1,"stats":{"Line":1}},{"line":195,"address":[14729128,14731806,14728435,14728364],"length":1,"stats":{"Line":3}},{"line":196,"address":[14728529],"length":1,"stats":{"Line":1}},{"line":197,"address":[14728537,14728612],"length":1,"stats":{"Line":2}},{"line":199,"address":[14728627],"length":1,"stats":{"Line":1}},{"line":200,"address":[14728694,14730086],"length":1,"stats":{"Line":2}},{"line":202,"address":[14728666,14729140,14728732],"length":1,"stats":{"Line":0}},{"line":205,"address":[14729098],"length":1,"stats":{"Line":1}},{"line":207,"address":[14728566,14731429,14731818],"length":1,"stats":{"Line":0}},{"line":208,"address":[14731795],"length":1,"stats":{"Line":0}},{"line":213,"address":[14734402,14734798,14734128,14734153,14734236,14734275],"length":1,"stats":{"Line":4}},{"line":214,"address":[14734330,14734263,14734220,14734433],"length":1,"stats":{"Line":2}},{"line":215,"address":[14734645,14734704,14734741],"length":1,"stats":{"Line":3}},{"line":216,"address":[14734743],"length":1,"stats":{"Line":1}},{"line":218,"address":[14734733],"length":1,"stats":{"Line":1}},{"line":223,"address":[14761152,14761170],"length":1,"stats":{"Line":4}},{"line":224,"address":[14720615,14720785,14720682,14720572],"length":1,"stats":{"Line":2}},{"line":225,"address":[14721004],"length":1,"stats":{"Line":1}},{"line":226,"address":[14721063],"length":1,"stats":{"Line":1}},{"line":227,"address":[14721200,14721205,14721088],"length":1,"stats":{"Line":3}},{"line":232,"address":[14721216,14721594,14721431,14721367,14721410,14721263,14722723,14722709],"length":1,"stats":{"Line":0}},{"line":233,"address":[14721344,14721397,14721628,14721507],"length":1,"stats":{"Line":0}},{"line":235,"address":[14721960,14721880,14724111],"length":1,"stats":{"Line":0}},{"line":236,"address":[14722061,14722173],"length":1,"stats":{"Line":0}},{"line":237,"address":[14722177,14722258],"length":1,"stats":{"Line":0}},{"line":238,"address":[14722262],"length":1,"stats":{"Line":0}},{"line":239,"address":[14722326],"length":1,"stats":{"Line":0}},{"line":242,"address":[14722353,14723336,14722748,14721418],"length":1,"stats":{"Line":0}},{"line":245,"address":[14723287,14723249,14723515,14723069,14723558,14723645,14725105],"length":1,"stats":{"Line":0}},{"line":246,"address":[14723081],"length":1,"stats":{"Line":0}},{"line":247,"address":[14723123],"length":1,"stats":{"Line":0}},{"line":248,"address":[14723151],"length":1,"stats":{"Line":0}},{"line":249,"address":[14723179],"length":1,"stats":{"Line":0}},{"line":251,"address":[14721439,14723369,14723272,14723547,14723317,14723613],"length":1,"stats":{"Line":0}},{"line":253,"address":[14724123,14723682],"length":1,"stats":{"Line":0}},{"line":254,"address":[14724091],"length":1,"stats":{"Line":0}},{"line":256,"address":[14722088,14722462],"length":1,"stats":{"Line":0}},{"line":264,"address":[14720022,14719898,14720463,14719795,14719859,14719760],"length":1,"stats":{"Line":4}},{"line":265,"address":[14719886,14719843,14720053,14719950],"length":1,"stats":{"Line":2}},{"line":266,"address":[14720276,14720336],"length":1,"stats":{"Line":2}}],"covered":75,"coverable":101},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-agent","src","main.rs"],"content":"use std::net::SocketAddr;\nuse tracing::{info, Level};\nuse tracing_subscriber::FmtSubscriber;\n\n#[tokio::main]\nasync fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let subscriber = FmtSubscriber::builder()\n        .with_max_level(Level::INFO)\n        .finish();\n    tracing::subscriber::set_global_default(subscriber)?;\n\n    info!(\"Starting Wasmatrix Node Agent\");\n    \n    // Agent initialization will be implemented here\n    \n    Ok(())\n}\n","traces":[{"line":6,"address":[3226022,3225616,3226028],"length":1,"stats":{"Line":0}},{"line":7,"address":[3227169],"length":1,"stats":{"Line":0}},{"line":8,"address":[3227277],"length":1,"stats":{"Line":0}},{"line":10,"address":[3228606,3227319],"length":1,"stats":{"Line":0}},{"line":12,"address":[3227429,3227842],"length":1,"stats":{"Line":0}},{"line":16,"address":[3225644,3225704,3225851],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","features","instance_management","controller","mod.rs"],"content":"use crate::features::instance_management::service::InstanceService;\nuse crate::shared::error::ControlPlaneError;\nuse crate::shared::types::{\n    InstanceStatusResponse, QueryInstanceRequest, StartInstanceRequest, StopInstanceRequest,\n};\nuse std::sync::Arc;\nuse tracing::{info, warn};\n\n/// Controller for instance management API endpoints\npub struct InstanceController {\n    service: Arc\u003cInstanceService\u003e,\n}\n\nimpl InstanceController {\n    pub fn new(service: Arc\u003cInstanceService\u003e) -\u003e Self {\n        Self { service }\n    }\n    \n    /// Handle start instance request\n    /// Thin wrapper that delegates to service\n    pub async fn start_instance(\n        \u0026self,\n        request: StartInstanceRequest,\n    ) -\u003e Result\u003cString, wasmatrix_core::ErrorResponse\u003e {\n        info!(\"Received start instance request\");\n        \n        self.service\n            .start_instance(request)\n            .await\n            .map_err(|e| e.into())\n    }\n    \n    /// Handle stop instance request\n    pub async fn stop_instance(\n        \u0026self,\n        request: StopInstanceRequest,\n    ) -\u003e Result\u003c(), wasmatrix_core::ErrorResponse\u003e {\n        info!(instance_id = %request.instance_id, \"Received stop instance request\");\n        \n        self.service\n            .stop_instance(request)\n            .await\n            .map_err(|e| e.into())\n    }\n    \n    /// Handle query instance request\n    pub async fn query_instance(\n        \u0026self,\n        request: QueryInstanceRequest,\n    ) -\u003e Result\u003cInstanceStatusResponse, wasmatrix_core::ErrorResponse\u003e {\n        info!(instance_id = %request.instance_id, \"Received query instance request\");\n        \n        self.service\n            .query_instance(request)\n            .await\n            .map_err(|e| e.into())\n    }\n    \n    /// Handle list instances request\n    pub async fn list_instances(\n        \u0026self,\n    ) -\u003e Result\u003cVec\u003cwasmatrix_core::InstanceMetadata\u003e, wasmatrix_core::ErrorResponse\u003e {\n        info!(\"Received list instances request\");\n        \n        self.service\n            .list_instances()\n            .await\n            .map_err(|e| e.into())\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::features::instance_management::repo::InMemoryInstanceRepository;\n    use crate::shared::types::RestartPolicy;\n    \n    fn create_test_controller() -\u003e InstanceController {\n        let repo = Arc::new(InMemoryInstanceRepository::new());\n        let service = Arc::new(InstanceService::new(repo, \"test-node\"));\n        InstanceController::new(service)\n    }\n    \n    fn create_valid_wasm_module() -\u003e Vec\u003cu8\u003e {\n        vec![0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00]\n    }\n    \n    #[tokio::test]\n    async fn test_controller_start_instance() {\n        let controller = create_test_controller();\n        \n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n        \n        let result = controller.start_instance(request).await;\n        assert!(result.is_ok());\n    }\n    \n    #[tokio::test]\n    async fn test_controller_stop_instance() {\n        let controller = create_test_controller();\n        \n        // Create instance\n        let start_request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n        let instance_id = controller.start_instance(start_request).await.unwrap();\n        \n        // Stop instance\n        let stop_request = StopInstanceRequest { instance_id };\n        let result = controller.stop_instance(stop_request).await;\n        assert!(result.is_ok());\n    }\n}\n","traces":[{"line":15,"address":[2576480],"length":1,"stats":{"Line":2}},{"line":21,"address":[2576400],"length":1,"stats":{"Line":2}},{"line":25,"address":[2669946,2669547,2669421],"length":1,"stats":{"Line":6}},{"line":27,"address":[2669921,2670787,2671017],"length":1,"stats":{"Line":6}},{"line":28,"address":[2670646],"length":1,"stats":{"Line":2}},{"line":29,"address":[2558093],"length":1,"stats":{"Line":6}},{"line":30,"address":[2671548,2671076,2671536],"length":1,"stats":{"Line":2}},{"line":34,"address":[2576288],"length":1,"stats":{"Line":1}},{"line":38,"address":[2662447,2662321,2662846],"length":1,"stats":{"Line":3}},{"line":40,"address":[2664034,2662821,2663802],"length":1,"stats":{"Line":3}},{"line":41,"address":[2663717],"length":1,"stats":{"Line":1}},{"line":42,"address":[2557933],"length":1,"stats":{"Line":3}},{"line":43,"address":[2664560,2664093,2664572],"length":1,"stats":{"Line":1}},{"line":47,"address":[2576352],"length":1,"stats":{"Line":0}},{"line":51,"address":[2666897,2667023,2667422],"length":1,"stats":{"Line":0}},{"line":53,"address":[2668619,2668378,2667397],"length":1,"stats":{"Line":0}},{"line":54,"address":[2668293],"length":1,"stats":{"Line":0}},{"line":55,"address":[2666955,2668363,2668408,2668458,2668683],"length":1,"stats":{"Line":0}},{"line":56,"address":[2668864,2668876,2668710],"length":1,"stats":{"Line":0}},{"line":60,"address":[2576336],"length":1,"stats":{"Line":0}},{"line":63,"address":[2664720,2664845,2665244],"length":1,"stats":{"Line":0}},{"line":65,"address":[2666246,2665991,2665219],"length":1,"stats":{"Line":0}},{"line":67,"address":[2666047,2666097,2665976,2666278,2664778],"length":1,"stats":{"Line":0}},{"line":68,"address":[2666396,2666305,2666384],"length":1,"stats":{"Line":0}}],"covered":13,"coverable":24},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","features","instance_management","mod.rs"],"content":"pub mod controller;\npub mod repo;\npub mod service;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","features","instance_management","repo","mod.rs"],"content":"use crate::shared::error::ControlPlaneResult;\nuse crate::shared::types::{InstanceMetadata, InstanceStatus};\nuse async_trait::async_trait;\nuse std::collections::HashMap;\nuse std::sync::{Arc, RwLock};\n\n/// Repository trait for instance storage\n#[async_trait]\npub trait InstanceRepository: Send + Sync {\n    /// Store a new instance\n    async fn create(\u0026self, metadata: InstanceMetadata) -\u003e ControlPlaneResult\u003c()\u003e;\n    \n    /// Retrieve an instance by ID\n    async fn get(\u0026self, instance_id: \u0026str) -\u003e ControlPlaneResult\u003cOption\u003cInstanceMetadata\u003e\u003e;\n    \n    /// Update instance status\n    async fn update_status(\u0026self, instance_id: \u0026str, status: InstanceStatus) -\u003e ControlPlaneResult\u003c()\u003e;\n    \n    /// Delete an instance\n    async fn delete(\u0026self, instance_id: \u0026str) -\u003e ControlPlaneResult\u003cbool\u003e;\n    \n    /// List all instances\n    async fn list(\u0026self) -\u003e ControlPlaneResult\u003cVec\u003cInstanceMetadata\u003e\u003e;\n    \n    /// Check if instance exists\n    async fn exists(\u0026self, instance_id: \u0026str) -\u003e ControlPlaneResult\u003cbool\u003e;\n}\n\n/// In-memory implementation of instance repository\npub struct InMemoryInstanceRepository {\n    storage: Arc\u003cRwLock\u003cHashMap\u003cString, InstanceMetadata\u003e\u003e\u003e,\n}\n\nimpl InMemoryInstanceRepository {\n    pub fn new() -\u003e Self {\n        Self {\n            storage: Arc::new(RwLock::new(HashMap::new())),\n        }\n    }\n}\n\nimpl Default for InMemoryInstanceRepository {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n\n#[async_trait]\nimpl InstanceRepository for InMemoryInstanceRepository {\n    async fn create(\u0026self, metadata: InstanceMetadata) -\u003e ControlPlaneResult\u003c()\u003e {\n        let mut storage = self.storage.write().map_err(|_| {\n            crate::shared::error::ControlPlaneError::StorageError(\"Lock poisoned\".to_string())\n        })?;\n        storage.insert(metadata.instance_id.clone(), metadata);\n        Ok(())\n    }\n    \n    async fn get(\u0026self, instance_id: \u0026str) -\u003e ControlPlaneResult\u003cOption\u003cInstanceMetadata\u003e\u003e {\n        let storage = self.storage.read().map_err(|_| {\n            crate::shared::error::ControlPlaneError::StorageError(\"Lock poisoned\".to_string())\n        })?;\n        Ok(storage.get(instance_id).cloned())\n    }\n    \n    async fn update_status(\u0026self, instance_id: \u0026str, status: InstanceStatus) -\u003e ControlPlaneResult\u003c()\u003e {\n        let mut storage = self.storage.write().map_err(|_| {\n            crate::shared::error::ControlPlaneError::StorageError(\"Lock poisoned\".to_string())\n        })?;\n        \n        if let Some(metadata) = storage.get_mut(instance_id) {\n            metadata.status = status;\n            Ok(())\n        } else {\n            Err(crate::shared::error::ControlPlaneError::InstanceNotFound(\n                instance_id.to_string()\n            ))\n        }\n    }\n    \n    async fn delete(\u0026self, instance_id: \u0026str) -\u003e ControlPlaneResult\u003cbool\u003e {\n        let mut storage = self.storage.write().map_err(|_| {\n            crate::shared::error::ControlPlaneError::StorageError(\"Lock poisoned\".to_string())\n        })?;\n        Ok(storage.remove(instance_id).is_some())\n    }\n    \n    async fn list(\u0026self) -\u003e ControlPlaneResult\u003cVec\u003cInstanceMetadata\u003e\u003e {\n        let storage = self.storage.read().map_err(|_| {\n            crate::shared::error::ControlPlaneError::StorageError(\"Lock poisoned\".to_string())\n        })?;\n        Ok(storage.values().cloned().collect())\n    }\n    \n    async fn exists(\u0026self, instance_id: \u0026str) -\u003e ControlPlaneResult\u003cbool\u003e {\n        let storage = self.storage.read().map_err(|_| {\n            crate::shared::error::ControlPlaneError::StorageError(\"Lock poisoned\".to_string())\n        })?;\n        Ok(storage.contains_key(instance_id))\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    \n    fn create_test_metadata(id: \u0026str) -\u003e InstanceMetadata {\n        InstanceMetadata::new(\n            \"test-node\".to_string(),\n            \"test-hash\".to_string(),\n        )\n    }\n    \n    #[tokio::test]\n    async fn test_create_and_get() {\n        let repo = InMemoryInstanceRepository::new();\n        let metadata = create_test_metadata(\"test-1\");\n        let id = metadata.instance_id.clone();\n        \n        repo.create(metadata.clone()).await.unwrap();\n        \n        let retrieved = repo.get(\u0026id).await.unwrap();\n        assert!(retrieved.is_some());\n        assert_eq!(retrieved.unwrap().instance_id, id);\n    }\n    \n    #[tokio::test]\n    async fn test_update_status() {\n        let repo = InMemoryInstanceRepository::new();\n        let metadata = create_test_metadata(\"test-1\");\n        let id = metadata.instance_id.clone();\n        \n        repo.create(metadata).await.unwrap();\n        repo.update_status(\u0026id, InstanceStatus::Running).await.unwrap();\n        \n        let retrieved = repo.get(\u0026id).await.unwrap().unwrap();\n        assert_eq!(retrieved.status, InstanceStatus::Running);\n    }\n    \n    #[tokio::test]\n    async fn test_delete() {\n        let repo = InMemoryInstanceRepository::new();\n        let metadata = create_test_metadata(\"test-1\");\n        let id = metadata.instance_id.clone();\n        \n        repo.create(metadata).await.unwrap();\n        assert!(repo.delete(\u0026id).await.unwrap());\n        assert!(!repo.exists(\u0026id).await.unwrap());\n    }\n    \n    #[tokio::test]\n    async fn test_list() {\n        let repo = InMemoryInstanceRepository::new();\n        \n        for i in 0..3 {\n            let metadata = create_test_metadata(\u0026format!(\"test-{}\", i));\n            repo.create(metadata).await.unwrap();\n        }\n        \n        let list = repo.list().await.unwrap();\n        assert_eq!(list.len(), 3);\n    }\n}\n","traces":[{"line":35,"address":[2657008],"length":1,"stats":{"Line":2}},{"line":37,"address":[2657012],"length":1,"stats":{"Line":2}},{"line":43,"address":[2656576],"length":1,"stats":{"Line":0}},{"line":44,"address":[2656577],"length":1,"stats":{"Line":0}},{"line":50,"address":[2572875,2572976,2572793,2571878,2572196,2572897,2571967,2571840,2572215,2572088],"length":1,"stats":{"Line":10}},{"line":51,"address":[2573236,2572382,2572184,2573088,2573230,2572269],"length":1,"stats":{"Line":4}},{"line":52,"address":[2573115,2573176],"length":1,"stats":{"Line":0}},{"line":54,"address":[2572468,2572519],"length":1,"stats":{"Line":4}},{"line":55,"address":[2572702],"length":1,"stats":{"Line":2}},{"line":58,"address":[2656691],"length":1,"stats":{"Line":6}},{"line":59,"address":[2570617,2570656,2570795,2570801,2570161,2570047,2570274],"length":1,"stats":{"Line":2}},{"line":60,"address":[2570680,2570741],"length":1,"stats":{"Line":0}},{"line":62,"address":[2570363,2570425],"length":1,"stats":{"Line":2}},{"line":65,"address":[2656617],"length":1,"stats":{"Line":6}},{"line":66,"address":[2569680,2569023,2569136,2568880,2569637,2569822,2569828],"length":1,"stats":{"Line":2}},{"line":67,"address":[2569768,2569707],"length":1,"stats":{"Line":0}},{"line":70,"address":[2569382,2569284,2569557,2569222],"length":1,"stats":{"Line":3}},{"line":71,"address":[2569367],"length":1,"stats":{"Line":1}},{"line":72,"address":[2569370],"length":1,"stats":{"Line":1}},{"line":74,"address":[2569433],"length":1,"stats":{"Line":0}},{"line":75,"address":[2569389],"length":1,"stats":{"Line":0}},{"line":80,"address":[2574071,2573286,2573574,2574180,2573510,2574164,2573248,2574169,2573472,2573351],"length":1,"stats":{"Line":6}},{"line":81,"address":[2573739,2574208,2574350,2573626,2574175,2574356,2573483],"length":1,"stats":{"Line":2}},{"line":82,"address":[2574235,2574296],"length":1,"stats":{"Line":0}},{"line":84,"address":[2573825,2573970,2573887],"length":1,"stats":{"Line":3}},{"line":87,"address":[2571631,2571647,2570919,2571078,2570854,2571040,2571142,2570816,2571636],"length":1,"stats":{"Line":6}},{"line":88,"address":[2571680,2571194,2571642,2571819,2571825,2571051,2571307],"length":1,"stats":{"Line":2}},{"line":89,"address":[2571704,2571765],"length":1,"stats":{"Line":0}},{"line":91,"address":[2571461,2571396],"length":1,"stats":{"Line":2}},{"line":94,"address":[2575127,2574592,2574368,2575132,2574694,2575143,2574406,2574471,2574630],"length":1,"stats":{"Line":6}},{"line":95,"address":[2575329,2575184,2574746,2574859,2574603,2575138,2575323],"length":1,"stats":{"Line":2}},{"line":96,"address":[2575269,2575208],"length":1,"stats":{"Line":0}},{"line":98,"address":[2575010,2574948],"length":1,"stats":{"Line":2}}],"covered":23,"coverable":33},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","features","instance_management","service","mod.rs"],"content":"use crate::features::instance_management::repo::InstanceRepository;\nuse crate::shared::error::{ControlPlaneError, ControlPlaneResult};\nuse crate::shared::types::{\n    InstanceMetadata, InstanceStatus, InstanceStatusResponse, QueryInstanceRequest,\n    StartInstanceRequest, StopInstanceRequest,\n};\nuse std::sync::Arc;\nuse tracing::{info, warn};\n\n/// Service for managing Wasm instances\npub struct InstanceService {\n    repo: Arc\u003cdyn InstanceRepository\u003e,\n    node_id: String,\n}\n\nimpl InstanceService {\n    pub fn new(repo: Arc\u003cdyn InstanceRepository\u003e, node_id: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            repo,\n            node_id: node_id.into(),\n        }\n    }\n    \n    /// Validate Wasm module format\n    fn validate_wasm_module(module_bytes: \u0026[u8]) -\u003e ControlPlaneResult\u003c()\u003e {\n        if module_bytes.is_empty() {\n            return Err(ControlPlaneError::ValidationError(\n                \"Module bytes cannot be empty\".to_string()\n            ));\n        }\n        \n        if module_bytes.len() \u003c 4 || \u0026module_bytes[0..4] != \u0026[0x00, 0x61, 0x73, 0x6d] {\n            return Err(ControlPlaneError::ValidationError(\n                \"Invalid Wasm module format\".to_string()\n            ));\n        }\n        \n        Ok(())\n    }\n    \n    /// Start a new instance\n    pub async fn start_instance(\n        \u0026self,\n        request: StartInstanceRequest,\n    ) -\u003e ControlPlaneResult\u003cString\u003e {\n        // Validation\n        Self::validate_wasm_module(\u0026request.module_bytes)?;\n        \n        // Create metadata\n        let metadata = InstanceMetadata::new(\n            self.node_id.clone(),\n            format!(\"{:x}\", md5::compute(\u0026request.module_bytes)),\n        );\n        \n        let instance_id = metadata.instance_id.clone();\n        \n        // Store in repository\n        self.repo.create(metadata).await?;\n        \n        info!(instance_id = %instance_id, \"Instance created successfully\");\n        \n        Ok(instance_id)\n    }\n    \n    /// Stop an instance\n    pub async fn stop_instance(\u0026self, request: StopInstanceRequest) -\u003e ControlPlaneResult\u003c()\u003e {\n        // Validation\n        if request.instance_id.is_empty() {\n            return Err(ControlPlaneError::ValidationError(\n                \"Instance ID cannot be empty\".to_string()\n            ));\n        }\n        \n        // Check existence\n        if !self.repo.exists(\u0026request.instance_id).await? {\n            return Err(ControlPlaneError::InstanceNotFound(\n                request.instance_id.clone()\n            ));\n        }\n        \n        // Update status\n        self.repo.update_status(\u0026request.instance_id, InstanceStatus::Stopped).await?;\n        \n        info!(instance_id = %request.instance_id, \"Instance stopped successfully\");\n        \n        Ok(())\n    }\n    \n    /// Query instance status\n    pub async fn query_instance(\n        \u0026self,\n        request: QueryInstanceRequest,\n    ) -\u003e ControlPlaneResult\u003cInstanceStatusResponse\u003e {\n        // Validation\n        if request.instance_id.is_empty() {\n            return Err(ControlPlaneError::ValidationError(\n                \"Instance ID cannot be empty\".to_string()\n            ));\n        }\n        \n        // Retrieve from repository\n        let metadata = self.repo.get(\u0026request.instance_id).await?;\n        \n        if let Some(metadata) = metadata {\n            Ok(InstanceStatusResponse {\n                instance_id: metadata.instance_id,\n                status: metadata.status,\n                node_id: metadata.node_id,\n                created_at: metadata.created_at,\n            })\n        } else {\n            Err(ControlPlaneError::InstanceNotFound(\n                request.instance_id.clone()\n            ))\n        }\n    }\n    \n    /// List all instances\n    pub async fn list_instances(\u0026self) -\u003e ControlPlaneResult\u003cVec\u003cInstanceMetadata\u003e\u003e {\n        self.repo.list().await\n    }\n    \n    /// Update instance status (called by node agent)\n    pub async fn update_status(\u0026self, instance_id: \u0026str, status: InstanceStatus) -\u003e ControlPlaneResult\u003c()\u003e {\n        if !self.repo.exists(instance_id).await? {\n            return Err(ControlPlaneError::InstanceNotFound(\n                instance_id.to_string()\n            ));\n        }\n        \n        self.repo.update_status(instance_id, status).await\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::features::instance_management::repo::InMemoryInstanceRepository;\n    use crate::shared::types::RestartPolicy;\n    \n    fn create_test_service() -\u003e InstanceService {\n        let repo = Arc::new(InMemoryInstanceRepository::new());\n        InstanceService::new(repo, \"test-node\")\n    }\n    \n    fn create_valid_wasm_module() -\u003e Vec\u003cu8\u003e {\n        vec![0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00]\n    }\n    \n    #[tokio::test]\n    async fn test_start_instance_success() {\n        let service = create_test_service();\n        \n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n        \n        let instance_id = service.start_instance(request).await.unwrap();\n        assert!(!instance_id.is_empty());\n    }\n    \n    #[tokio::test]\n    async fn test_start_instance_invalid_wasm() {\n        let service = create_test_service();\n        \n        let request = StartInstanceRequest {\n            module_bytes: vec![0x00, 0x00, 0x00, 0x00],\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n        \n        let result = service.start_instance(request).await;\n        assert!(result.is_err());\n    }\n    \n    #[tokio::test]\n    async fn test_stop_instance_success() {\n        let service = create_test_service();\n        \n        // Create instance\n        let start_request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n        let instance_id = service.start_instance(start_request).await.unwrap();\n        \n        // Stop instance\n        let stop_request = StopInstanceRequest { instance_id };\n        service.stop_instance(stop_request).await.unwrap();\n    }\n    \n    #[tokio::test]\n    async fn test_stop_instance_not_found() {\n        let service = create_test_service();\n        \n        let request = StopInstanceRequest {\n            instance_id: \"nonexistent\".to_string(),\n        };\n        \n        let result = service.stop_instance(request).await;\n        assert!(result.is_err());\n    }\n    \n    #[tokio::test]\n    async fn test_query_instance() {\n        let service = create_test_service();\n        \n        // Create instance\n        let start_request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n        let instance_id = service.start_instance(start_request).await.unwrap();\n        \n        // Query instance\n        let query_request = QueryInstanceRequest { instance_id: instance_id.clone() };\n        let response = service.query_instance(query_request).await.unwrap();\n        \n        assert_eq!(response.instance_id, instance_id);\n    }\n}\n","traces":[{"line":17,"address":[2548386,2548208,2548392],"length":1,"stats":{"Line":7}},{"line":20,"address":[],"length":0,"stats":{"Line":7}},{"line":25,"address":[2604112],"length":1,"stats":{"Line":4}},{"line":26,"address":[2604171],"length":1,"stats":{"Line":4}},{"line":27,"address":[2604226],"length":1,"stats":{"Line":0}},{"line":28,"address":[2604198],"length":1,"stats":{"Line":0}},{"line":32,"address":[2604315,2604186],"length":1,"stats":{"Line":8}},{"line":33,"address":[2604404],"length":1,"stats":{"Line":1}},{"line":34,"address":[2604373],"length":1,"stats":{"Line":1}},{"line":38,"address":[2604506],"length":1,"stats":{"Line":3}},{"line":42,"address":[2604032],"length":1,"stats":{"Line":4}},{"line":47,"address":[2544868,2545938,2545006],"length":1,"stats":{"Line":9}},{"line":51,"address":[2545137,2545199],"length":1,"stats":{"Line":8}},{"line":52,"address":[2545272,2545207],"length":1,"stats":{"Line":7}},{"line":55,"address":[2545468],"length":1,"stats":{"Line":5}},{"line":58,"address":[3948884],"length":1,"stats":{"Line":10}},{"line":60,"address":[2546821,2546310],"length":1,"stats":{"Line":8}},{"line":62,"address":[2546719],"length":1,"stats":{"Line":3}},{"line":66,"address":[2538760,2537401,2537264,2537311,2540372,2537444,2537965],"length":1,"stats":{"Line":4}},{"line":68,"address":[2537516,2537387],"length":1,"stats":{"Line":2}},{"line":69,"address":[2537819],"length":1,"stats":{"Line":0}},{"line":70,"address":[2537561],"length":1,"stats":{"Line":0}},{"line":75,"address":[2538755,2537999,2537530,2537431,2537635],"length":1,"stats":{"Line":2}},{"line":76,"address":[2538400],"length":1,"stats":{"Line":1}},{"line":77,"address":[2538335],"length":1,"stats":{"Line":1}},{"line":82,"address":[3948320],"length":1,"stats":{"Line":2}},{"line":84,"address":[2539079,2539521],"length":1,"stats":{"Line":2}},{"line":86,"address":[2539488],"length":1,"stats":{"Line":1}},{"line":90,"address":[2603984],"length":1,"stats":{"Line":1}},{"line":95,"address":[2542848,2542947],"length":1,"stats":{"Line":2}},{"line":96,"address":[2543202],"length":1,"stats":{"Line":0}},{"line":97,"address":[2542979],"length":1,"stats":{"Line":0}},{"line":102,"address":[3948654],"length":1,"stats":{"Line":2}},{"line":104,"address":[2543831],"length":1,"stats":{"Line":1}},{"line":105,"address":[2544085],"length":1,"stats":{"Line":1}},{"line":106,"address":[2543984],"length":1,"stats":{"Line":1}},{"line":107,"address":[2544016],"length":1,"stats":{"Line":1}},{"line":108,"address":[2544023],"length":1,"stats":{"Line":1}},{"line":109,"address":[2544055],"length":1,"stats":{"Line":1}},{"line":112,"address":[2544382],"length":1,"stats":{"Line":0}},{"line":113,"address":[2544266],"length":1,"stats":{"Line":0}},{"line":119,"address":[2542160,2542440,2542264,2542303,2542703,2542195],"length":1,"stats":{"Line":0}},{"line":120,"address":[3948532],"length":1,"stats":{"Line":0}},{"line":124,"address":[2541042,2541929,2541192,2541016,2540876,2540832,2540973],"length":1,"stats":{"Line":0}},{"line":125,"address":[2541223,2541924,2541003,2541096,2540948],"length":1,"stats":{"Line":0}},{"line":126,"address":[2541606],"length":1,"stats":{"Line":0}},{"line":127,"address":[2541547],"length":1,"stats":{"Line":0}},{"line":131,"address":[2541825,2541940,2541578,2541024],"length":1,"stats":{"Line":0}}],"covered":33,"coverable":48},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","features","mod.rs"],"content":"pub mod instance_management;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","lib.rs"],"content":"pub mod features;\npub mod shared;\n\n// Legacy ControlPlane implementation for backward compatibility\nuse std::collections::HashMap;\nuse wasmatrix_core::{\n    CapabilityAssignment, CoreError, ErrorResponse, InstanceMetadata, InstanceStatus,\n    InstanceStatusResponse, QueryInstanceRequest, RestartPolicy, Result, StartInstanceRequest,\n    StopInstanceRequest,\n};\n\npub struct ControlPlane {\n    instances: HashMap\u003cString, InstanceMetadata\u003e,\n    capabilities: HashMap\u003cString, Vec\u003cCapabilityAssignment\u003e\u003e,\n    node_id: String,\n}\n\nimpl ControlPlane {\n    pub fn new(node_id: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            instances: HashMap::new(),\n            capabilities: HashMap::new(),\n            node_id: node_id.into(),\n        }\n    }\n\n    /// Start a new Wasm instance\n    /// Validates request and creates instance metadata\n    pub fn start_instance(\n        \u0026mut self,\n        request: StartInstanceRequest,\n    ) -\u003e std::result::Result\u003cString, ErrorResponse\u003e {\n        // Validate module bytes\n        if request.module_bytes.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Module bytes cannot be empty\",\n            ));\n        }\n\n        // Validate module is valid Wasm (basic check - starts with magic bytes)\n        if request.module_bytes.len() \u003c 4\n            || \u0026request.module_bytes[0..4] != \u0026[0x00, 0x61, 0x73, 0x6d]\n        {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Invalid Wasm module format\",\n            ));\n        }\n\n        // Create instance metadata\n        let metadata = InstanceMetadata::new(\n            self.node_id.clone(),\n            format!(\"{:x}\", md5::compute(\u0026request.module_bytes)),\n        );\n\n        let instance_id = metadata.instance_id.clone();\n\n        // Store instance\n        self.instances.insert(instance_id.clone(), metadata);\n\n        // Store capability assignments\n        if !request.capabilities.is_empty() {\n            self.capabilities\n                .insert(instance_id.clone(), request.capabilities);\n        }\n\n        Ok(instance_id)\n    }\n\n    /// Stop an existing Wasm instance\n    pub fn stop_instance(\n        \u0026mut self,\n        request: StopInstanceRequest,\n    ) -\u003e std::result::Result\u003c(), ErrorResponse\u003e {\n        // Validate request\n        if request.instance_id.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Instance ID cannot be empty\",\n            ));\n        }\n\n        // Find and update instance\n        if let Some(metadata) = self.instances.get_mut(\u0026request.instance_id) {\n            metadata.status = InstanceStatus::Stopped;\n            Ok(())\n        } else {\n            Err(ErrorResponse::new(\n                \"INSTANCE_NOT_FOUND\",\n                format!(\"Instance {} not found\", request.instance_id),\n            ))\n        }\n    }\n\n    /// Query instance status\n    pub fn query_instance(\n        \u0026self,\n        request: QueryInstanceRequest,\n    ) -\u003e std::result::Result\u003cInstanceStatusResponse, ErrorResponse\u003e {\n        // Validate request\n        if request.instance_id.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Instance ID cannot be empty\",\n            ));\n        }\n\n        // Find instance\n        if let Some(metadata) = self.instances.get(\u0026request.instance_id) {\n            Ok(InstanceStatusResponse {\n                instance_id: metadata.instance_id.clone(),\n                status: metadata.status,\n                node_id: metadata.node_id.clone(),\n                created_at: metadata.created_at,\n            })\n        } else {\n            Err(ErrorResponse::new(\n                \"INSTANCE_NOT_FOUND\",\n                format!(\"Instance {} not found\", request.instance_id),\n            ))\n        }\n    }\n\n    /// Assign capabilities to an instance\n    pub fn assign_capability(\n        \u0026mut self,\n        assignment: CapabilityAssignment,\n    ) -\u003e std::result::Result\u003c(), ErrorResponse\u003e {\n        // Validate instance exists\n        if !self.instances.contains_key(\u0026assignment.instance_id) {\n            return Err(ErrorResponse::new(\n                \"INSTANCE_NOT_FOUND\",\n                format!(\"Instance {} not found\", assignment.instance_id),\n            ));\n        }\n\n        // Validate capability_id\n        if assignment.capability_id.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Capability ID cannot be empty\",\n            ));\n        }\n\n        // Validate permissions\n        if assignment.permissions.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"At least one permission must be specified\",\n            ));\n        }\n\n        // Add capability assignment\n        self.capabilities\n            .entry(assignment.instance_id.clone())\n            .or_insert_with(Vec::new)\n            .push(assignment);\n\n        Ok(())\n    }\n\n    /// Revoke a capability from an instance\n    pub fn revoke_capability(\n        \u0026mut self,\n        instance_id: \u0026str,\n        capability_id: \u0026str,\n    ) -\u003e std::result::Result\u003c(), ErrorResponse\u003e {\n        // Validate instance_id\n        if instance_id.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Instance ID cannot be empty\",\n            ));\n        }\n\n        // Validate capability_id\n        if capability_id.is_empty() {\n            return Err(ErrorResponse::new(\n                \"INVALID_REQUEST\",\n                \"Capability ID cannot be empty\",\n            ));\n        }\n\n        // Remove capability assignment\n        if let Some(assignments) = self.capabilities.get_mut(instance_id) {\n            assignments.retain(|a| a.capability_id != capability_id);\n\n            // Clean up empty entry\n            if assignments.is_empty() {\n                self.capabilities.remove(instance_id);\n            }\n\n            Ok(())\n        } else {\n            Err(ErrorResponse::new(\n                \"INSTANCE_NOT_FOUND\",\n                format!(\"Instance {} has no capability assignments\", instance_id),\n            ))\n        }\n    }\n\n    /// List all instances\n    pub fn list_instances(\u0026self) -\u003e Vec\u003c\u0026InstanceMetadata\u003e {\n        self.instances.values().collect()\n    }\n\n    /// Get capability assignments for an instance\n    pub fn get_capabilities(\u0026self, instance_id: \u0026str) -\u003e Option\u003c\u0026Vec\u003cCapabilityAssignment\u003e\u003e {\n        self.capabilities.get(instance_id)\n    }\n\n    /// Get instance metadata (internal use)\n    pub fn get_instance(\u0026self, instance_id: \u0026str) -\u003e Option\u003c\u0026InstanceMetadata\u003e {\n        self.instances.get(instance_id)\n    }\n\n    /// Update instance status (called by Node Agent)\n    pub fn update_instance_status(\n        \u0026mut self,\n        instance_id: \u0026str,\n        status: InstanceStatus,\n    ) -\u003e Result\u003c()\u003e {\n        if let Some(metadata) = self.instances.get_mut(instance_id) {\n            metadata.status = status;\n            Ok(())\n        } else {\n            Err(CoreError::InvalidInstanceId(instance_id.to_string()))\n        }\n    }\n}\n\nimpl Default for ControlPlane {\n    fn default() -\u003e Self {\n        Self::new(\"default-node\")\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use wasmatrix_core::{ProviderType, RestartPolicy};\n\n    fn create_valid_wasm_module() -\u003e Vec\u003cu8\u003e {\n        // Minimal valid Wasm module (magic bytes + version)\n        vec![0x00, 0x61, 0x73, 0x6d, 0x01, 0x00, 0x00, 0x00]\n    }\n\n    #[test]\n    fn test_start_instance_success() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let instance_id = cp.start_instance(request).unwrap();\n        assert!(!instance_id.is_empty());\n        assert!(cp.get_instance(\u0026instance_id).is_some());\n    }\n\n    #[test]\n    fn test_start_instance_empty_module() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: vec![],\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let result = cp.start_instance(request);\n        assert!(result.is_err());\n        assert_eq!(result.unwrap_err().error_code, \"INVALID_REQUEST\");\n    }\n\n    #[test]\n    fn test_start_instance_invalid_wasm() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: vec![0x00, 0x00, 0x00, 0x00],\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let result = cp.start_instance(request);\n        assert!(result.is_err());\n        assert_eq!(result.unwrap_err().error_code, \"INVALID_REQUEST\");\n    }\n\n    #[test]\n    fn test_stop_instance_success() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let instance_id = cp.start_instance(request).unwrap();\n        let stop_request = StopInstanceRequest {\n            instance_id: instance_id.clone(),\n        };\n\n        cp.stop_instance(stop_request).unwrap();\n        assert_eq!(\n            cp.get_instance(\u0026instance_id).unwrap().status,\n            InstanceStatus::Stopped\n        );\n    }\n\n    #[test]\n    fn test_stop_instance_not_found() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StopInstanceRequest {\n            instance_id: \"non-existent\".to_string(),\n        };\n\n        let result = cp.stop_instance(request);\n        assert!(result.is_err());\n        assert_eq!(result.unwrap_err().error_code, \"INSTANCE_NOT_FOUND\");\n    }\n\n    #[test]\n    fn test_query_instance_success() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let instance_id = cp.start_instance(request).unwrap();\n        let query_request = QueryInstanceRequest {\n            instance_id: instance_id.clone(),\n        };\n\n        let response = cp.query_instance(query_request).unwrap();\n        assert_eq!(response.instance_id, instance_id);\n    }\n\n    #[test]\n    fn test_query_instance_not_found() {\n        let cp = ControlPlane::new(\"node-1\");\n        let request = QueryInstanceRequest {\n            instance_id: \"non-existent\".to_string(),\n        };\n\n        let result = cp.query_instance(request);\n        assert!(result.is_err());\n        assert_eq!(result.unwrap_err().error_code, \"INSTANCE_NOT_FOUND\");\n    }\n\n    #[test]\n    fn test_assign_capability_success() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let instance_id = cp.start_instance(request).unwrap();\n        let assignment = CapabilityAssignment::new(\n            instance_id.clone(),\n            \"kv-1\".to_string(),\n            ProviderType::Kv,\n            vec![\"kv:read\".to_string(), \"kv:write\".to_string()],\n        );\n\n        cp.assign_capability(assignment).unwrap();\n        let capabilities = cp.get_capabilities(\u0026instance_id).unwrap();\n        assert_eq!(capabilities.len(), 1);\n        assert_eq!(capabilities[0].capability_id, \"kv-1\");\n    }\n\n    #[test]\n    fn test_revoke_capability_success() {\n        let mut cp = ControlPlane::new(\"node-1\");\n        let request = StartInstanceRequest {\n            module_bytes: create_valid_wasm_module(),\n            capabilities: vec![],\n            restart_policy: RestartPolicy::default(),\n        };\n\n        let instance_id = cp.start_instance(request).unwrap();\n        let assignment = CapabilityAssignment::new(\n            instance_id.clone(),\n            \"kv-1\".to_string(),\n            ProviderType::Kv,\n            vec![\"kv:read\".to_string()],\n        );\n\n        cp.assign_capability(assignment).unwrap();\n        cp.revoke_capability(\u0026instance_id, \"kv-1\").unwrap();\n\n        assert!(cp.get_capabilities(\u0026instance_id).is_none());\n    }\n\n    #[test]\n    fn test_list_instances() {\n        let mut cp = ControlPlane::new(\"node-1\");\n\n        // Start multiple instances\n        for _ in 0..3 {\n            let request = StartInstanceRequest {\n                module_bytes: create_valid_wasm_module(),\n                capabilities: vec![],\n                restart_policy: RestartPolicy::default(),\n            };\n            cp.start_instance(request).unwrap();\n        }\n\n        let instances = cp.list_instances();\n        assert_eq!(instances.len(), 3);\n    }\n}\n","traces":[{"line":19,"address":[3938816,3939169,3939175],"length":1,"stats":{"Line":10}},{"line":21,"address":[],"length":0,"stats":{"Line":10}},{"line":22,"address":[2606661],"length":1,"stats":{"Line":10}},{"line":23,"address":[],"length":0,"stats":{"Line":10}},{"line":29,"address":[2584811,2584844,2583488],"length":1,"stats":{"Line":8}},{"line":34,"address":[2583531,2583631],"length":1,"stats":{"Line":16}},{"line":35,"address":[2583662,2584938],"length":1,"stats":{"Line":2}},{"line":42,"address":[2583707,2583642],"length":1,"stats":{"Line":14}},{"line":43,"address":[2583808,2583718],"length":1,"stats":{"Line":14}},{"line":45,"address":[2584899,2583755],"length":1,"stats":{"Line":2}},{"line":53,"address":[2583865],"length":1,"stats":{"Line":6}},{"line":54,"address":[2583897,2583965],"length":1,"stats":{"Line":12}},{"line":57,"address":[2584147],"length":1,"stats":{"Line":2}},{"line":60,"address":[2584220,2584302],"length":1,"stats":{"Line":8}},{"line":63,"address":[2584465],"length":1,"stats":{"Line":6}},{"line":64,"address":[2584499],"length":1,"stats":{"Line":0}},{"line":65,"address":[2584507,2584648],"length":1,"stats":{"Line":0}},{"line":68,"address":[2584544],"length":1,"stats":{"Line":1}},{"line":72,"address":[2582560,2582048],"length":1,"stats":{"Line":1}},{"line":77,"address":[2582091,2582147],"length":1,"stats":{"Line":2}},{"line":78,"address":[2582179,2582532],"length":1,"stats":{"Line":0}},{"line":85,"address":[2582301,2582224,2582509,2582163],"length":1,"stats":{"Line":4}},{"line":86,"address":[2582284],"length":1,"stats":{"Line":1}},{"line":87,"address":[2582288],"length":1,"stats":{"Line":1}},{"line":89,"address":[2582451],"length":1,"stats":{"Line":1}},{"line":91,"address":[2582308,2582351],"length":1,"stats":{"Line":2}},{"line":97,"address":[2583465,2583250,2582656],"length":1,"stats":{"Line":1}},{"line":102,"address":[2582755,2582699],"length":1,"stats":{"Line":2}},{"line":103,"address":[2582787,2583437],"length":1,"stats":{"Line":0}},{"line":110,"address":[2583414,2582771,2582832],"length":1,"stats":{"Line":3}},{"line":111,"address":[2583061],"length":1,"stats":{"Line":1}},{"line":112,"address":[2582892],"length":1,"stats":{"Line":1}},{"line":113,"address":[2582951],"length":1,"stats":{"Line":1}},{"line":114,"address":[2582958],"length":1,"stats":{"Line":1}},{"line":115,"address":[2583039],"length":1,"stats":{"Line":1}},{"line":118,"address":[2583356],"length":1,"stats":{"Line":1}},{"line":120,"address":[2582916,2583256],"length":1,"stats":{"Line":2}},{"line":126,"address":[2585040,2585826,2585797],"length":1,"stats":{"Line":2}},{"line":131,"address":[2585091,2585167],"length":1,"stats":{"Line":4}},{"line":132,"address":[2585328],"length":1,"stats":{"Line":0}},{"line":134,"address":[2585178,2585228],"length":1,"stats":{"Line":0}},{"line":139,"address":[2585210,2585400],"length":1,"stats":{"Line":3}},{"line":140,"address":[2585426,2585774],"length":1,"stats":{"Line":0}},{"line":147,"address":[2585411,2585473],"length":1,"stats":{"Line":3}},{"line":148,"address":[2585746,2585517],"length":1,"stats":{"Line":0}},{"line":155,"address":[2585489],"length":1,"stats":{"Line":2}},{"line":156,"address":[2585498,2585565],"length":1,"stats":{"Line":4}},{"line":157,"address":[2585592],"length":1,"stats":{"Line":2}},{"line":158,"address":[2585624],"length":1,"stats":{"Line":2}},{"line":160,"address":[2585715],"length":1,"stats":{"Line":2}},{"line":164,"address":[2585840],"length":1,"stats":{"Line":1}},{"line":170,"address":[2585890],"length":1,"stats":{"Line":1}},{"line":171,"address":[2585934],"length":1,"stats":{"Line":0}},{"line":178,"address":[2585909],"length":1,"stats":{"Line":1}},{"line":179,"address":[2586060],"length":1,"stats":{"Line":0}},{"line":186,"address":[2586126,2585999,2586371,2586391],"length":1,"stats":{"Line":3}},{"line":187,"address":[3938768,3938793],"length":1,"stats":{"Line":3}},{"line":190,"address":[2586160],"length":1,"stats":{"Line":1}},{"line":191,"address":[2586398],"length":1,"stats":{"Line":1}},{"line":194,"address":[2586378],"length":1,"stats":{"Line":1}},{"line":196,"address":[2586315],"length":1,"stats":{"Line":0}},{"line":198,"address":[2586179],"length":1,"stats":{"Line":0}},{"line":204,"address":[2582592],"length":1,"stats":{"Line":1}},{"line":205,"address":[2582611],"length":1,"stats":{"Line":1}},{"line":209,"address":[2584992],"length":1,"stats":{"Line":1}},{"line":210,"address":[2585010],"length":1,"stats":{"Line":1}},{"line":214,"address":[2582000],"length":1,"stats":{"Line":1}},{"line":215,"address":[2582018],"length":1,"stats":{"Line":1}},{"line":219,"address":[2586464],"length":1,"stats":{"Line":0}},{"line":224,"address":[2586550,2586624],"length":1,"stats":{"Line":0}},{"line":225,"address":[2586614],"length":1,"stats":{"Line":0}},{"line":226,"address":[2586617],"length":1,"stats":{"Line":0}},{"line":228,"address":[2586635],"length":1,"stats":{"Line":0}},{"line":234,"address":[2586784],"length":1,"stats":{"Line":0}},{"line":235,"address":[2586792],"length":1,"stats":{"Line":0}}],"covered":56,"coverable":75},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","main.rs"],"content":"use tracing::info;\n\n#[tokio::main]\nasync fn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    tracing_subscriber::fmt::init();\n\n    info!(\"Starting Wasmatrix Control Plane\");\n\n    let _control_plane = wasmatrix_control_plane::ControlPlane::new(\"node-1\");\n\n    info!(\"Control Plane initialized successfully\");\n\n    // TODO: Implement gRPC server and HTTP API\n\n    Ok(())\n}\n","traces":[{"line":4,"address":[3907516,3907104,3907510],"length":1,"stats":{"Line":0}},{"line":5,"address":[3902769],"length":1,"stats":{"Line":0}},{"line":7,"address":[3902848,3903290],"length":1,"stats":{"Line":0}},{"line":9,"address":[3903249],"length":1,"stats":{"Line":0}},{"line":11,"address":[3904073,3904535,3904152],"length":1,"stats":{"Line":0}},{"line":15,"address":[3907192,3907132,3907339],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","shared","error.rs"],"content":"use serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse thiserror::Error;\n\n/// Control plane specific errors\n#[derive(Debug, Error)]\npub enum ControlPlaneError {\n    #[error(\"Invalid request: {0}\")]\n    InvalidRequest(String),\n    #[error(\"Instance not found: {0}\")]\n    InstanceNotFound(String),\n    #[error(\"Capability not found: {0}\")]\n    CapabilityNotFound(String),\n    #[error(\"Permission denied: {0}\")]\n    PermissionDenied(String),\n    #[error(\"Storage error: {0}\")]\n    StorageError(String),\n    #[error(\"Validation error: {0}\")]\n    ValidationError(String),\n}\n\nimpl From\u003cControlPlaneError\u003e for wasmatrix_core::ErrorResponse {\n    fn from(err: ControlPlaneError) -\u003e Self {\n        let (code, message) = match \u0026err {\n            ControlPlaneError::InvalidRequest(msg) =\u003e (\"INVALID_REQUEST\", msg.clone()),\n            ControlPlaneError::InstanceNotFound(msg) =\u003e (\"INSTANCE_NOT_FOUND\", msg.clone()),\n            ControlPlaneError::CapabilityNotFound(msg) =\u003e (\"CAPABILITY_NOT_FOUND\", msg.clone()),\n            ControlPlaneError::PermissionDenied(msg) =\u003e (\"PERMISSION_DENIED\", msg.clone()),\n            ControlPlaneError::StorageError(msg) =\u003e (\"STORAGE_ERROR\", msg.clone()),\n            ControlPlaneError::ValidationError(msg) =\u003e (\"VALIDATION_ERROR\", msg.clone()),\n        };\n\n        wasmatrix_core::ErrorResponse::new(code, message)\n    }\n}\n\npub type ControlPlaneResult\u003cT\u003e = std::result::Result\u003cT, ControlPlaneError\u003e;\n","traces":[{"line":23,"address":[3958240,3959137],"length":1,"stats":{"Line":0}},{"line":24,"address":[3958261,3958618],"length":1,"stats":{"Line":0}},{"line":25,"address":[3958304,3958562],"length":1,"stats":{"Line":0}},{"line":26,"address":[3958728,3958339],"length":1,"stats":{"Line":0}},{"line":27,"address":[3958374,3958790],"length":1,"stats":{"Line":0}},{"line":28,"address":[3958412,3958855],"length":1,"stats":{"Line":0}},{"line":29,"address":[3958920,3958450],"length":1,"stats":{"Line":0}},{"line":30,"address":[3958488,3958985],"length":1,"stats":{"Line":0}},{"line":33,"address":[3958672],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":9},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","shared","mod.rs"],"content":"pub mod error;\npub mod types;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-control-plane","src","shared","types.rs"],"content":"pub use wasmatrix_core::{\n    CapabilityAssignment, InstanceMetadata, InstanceStatus, ProviderType, RestartPolicy,\n};\n\n/// Request to start a new instance\n#[derive(Debug, Clone)]\npub struct StartInstanceRequest {\n    pub module_bytes: Vec\u003cu8\u003e,\n    pub capabilities: Vec\u003cCapabilityAssignment\u003e,\n    pub restart_policy: RestartPolicy,\n}\n\n/// Request to stop an instance\n#[derive(Debug, Clone)]\npub struct StopInstanceRequest {\n    pub instance_id: String,\n}\n\n/// Request to query an instance\n#[derive(Debug, Clone)]\npub struct QueryInstanceRequest {\n    pub instance_id: String,\n}\n\n/// Instance status response\n#[derive(Debug, Clone)]\npub struct InstanceStatusResponse {\n    pub instance_id: String,\n    pub status: InstanceStatus,\n    pub node_id: String,\n    pub created_at: chrono::DateTime\u003cchrono::Utc\u003e,\n}\n\n/// Request to assign a capability\n#[derive(Debug, Clone)]\npub struct AssignCapabilityRequest {\n    pub instance_id: String,\n    pub capability: CapabilityAssignment,\n}\n\n/// Request to revoke a capability\n#[derive(Debug, Clone)]\npub struct RevokeCapabilityRequest {\n    pub instance_id: String,\n    pub capability_id: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-core","src","capability.rs"],"content":"use crate::{CapabilityAssignment, CoreError, ProviderType, Result};\nuse std::collections::HashMap;\n\n/// Registry for managing capability assignments\n#[derive(Debug, Default)]\npub struct CapabilityRegistry {\n    assignments: HashMap\u003cString, Vec\u003cCapabilityAssignment\u003e\u003e,\n    /// Known provider IDs for validation\n    known_providers: HashMap\u003cString, ProviderType\u003e,\n}\n\nimpl CapabilityRegistry {\n    pub fn new() -\u003e Self {\n        Self::default()\n    }\n\n    /// Register a known provider for validation\n    pub fn register_provider(\n        \u0026mut self,\n        provider_id: impl Into\u003cString\u003e,\n        provider_type: ProviderType,\n    ) {\n        self.known_providers\n            .insert(provider_id.into(), provider_type);\n    }\n\n    /// Validate a capability assignment\n    fn validate_assignment(\u0026self, assignment: \u0026CapabilityAssignment) -\u003e Result\u003c()\u003e {\n        // Check that provider exists\n        let provider_type = self\n            .known_providers\n            .get(\u0026assignment.capability_id)\n            .ok_or_else(|| {\n                CoreError::InvalidCapabilityAssignment(format!(\n                    \"Provider '{}' not found\",\n                    assignment.capability_id\n                ))\n            })?;\n\n        // Verify provider type matches\n        if *provider_type != assignment.provider_type {\n            return Err(CoreError::InvalidCapabilityAssignment(format!(\n                \"Provider type mismatch: expected {:?}, got {:?}\",\n                provider_type, assignment.provider_type\n            )));\n        }\n\n        // Validate permissions based on provider type\n        self.validate_permissions(assignment, *provider_type)?;\n\n        Ok(())\n    }\n\n    /// Validate permissions for a specific provider type\n    fn validate_permissions(\n        \u0026self,\n        assignment: \u0026CapabilityAssignment,\n        provider_type: ProviderType,\n    ) -\u003e Result\u003c()\u003e {\n        let valid_permissions: Vec\u003c\u0026str\u003e = match provider_type {\n            ProviderType::Kv =\u003e vec![\"kv:read\", \"kv:write\", \"kv:delete\"],\n            ProviderType::Http =\u003e vec![\"http:request\"],\n            ProviderType::Messaging =\u003e vec![\"msg:publish\", \"msg:subscribe\"],\n        };\n\n        for permission in \u0026assignment.permissions {\n            if !valid_permissions.contains(\u0026permission.as_str()) {\n                return Err(CoreError::InvalidCapabilityAssignment(format!(\n                    \"Invalid permission '{}' for provider type {:?}\",\n                    permission, provider_type\n                )));\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Store a capability assignment for an instance\n    pub fn assign_capability(\u0026mut self, assignment: CapabilityAssignment) -\u003e Result\u003c()\u003e {\n        // Validate the assignment\n        self.validate_assignment(\u0026assignment)?;\n\n        // Store the assignment\n        self.assignments\n            .entry(assignment.instance_id.clone())\n            .or_insert_with(Vec::new)\n            .push(assignment);\n\n        Ok(())\n    }\n\n    /// Revoke a capability from an instance\n    pub fn revoke_capability(\u0026mut self, instance_id: \u0026str, capability_id: \u0026str) -\u003e Result\u003cbool\u003e {\n        if let Some(assignments) = self.assignments.get_mut(instance_id) {\n            let original_len = assignments.len();\n            assignments.retain(|a| a.capability_id != capability_id);\n            let was_removed = assignments.len() \u003c original_len;\n\n            // Clean up empty entry if needed\n            let should_remove = assignments.is_empty();\n            drop(assignments); // Drop the mutable borrow before calling remove\n\n            if should_remove {\n                self.assignments.remove(instance_id);\n            }\n\n            Ok(was_removed)\n        } else {\n            Ok(false)\n        }\n    }\n\n    /// Get all capability assignments for an instance\n    pub fn get_capabilities(\u0026self, instance_id: \u0026str) -\u003e Option\u003c\u0026Vec\u003cCapabilityAssignment\u003e\u003e {\n        self.assignments.get(instance_id)\n    }\n\n    /// Check if an instance has a specific capability\n    pub fn has_capability(\u0026self, instance_id: \u0026str, capability_id: \u0026str) -\u003e bool {\n        self.assignments\n            .get(instance_id)\n            .map(|assignments| assignments.iter().any(|a| a.capability_id == capability_id))\n            .unwrap_or(false)\n    }\n\n    /// Check if an instance has a specific permission for a capability\n    pub fn has_permission(\u0026self, instance_id: \u0026str, capability_id: \u0026str, permission: \u0026str) -\u003e bool {\n        self.assignments\n            .get(instance_id)\n            .map(|assignments| {\n                assignments\n                    .iter()\n                    .filter(|a| a.capability_id == capability_id)\n                    .any(|a| a.has_permission(permission))\n            })\n            .unwrap_or(false)\n    }\n\n    /// Get all instance IDs with capabilities\n    pub fn get_instances(\u0026self) -\u003e Vec\u003c\u0026String\u003e {\n        self.assignments.keys().collect()\n    }\n\n    /// Clear all assignments for an instance (e.g., when instance is stopped)\n    pub fn clear_instance(\u0026mut self, instance_id: \u0026str) {\n        self.assignments.remove(instance_id);\n    }\n\n    /// Get total number of capability assignments\n    pub fn assignment_count(\u0026self) -\u003e usize {\n        self.assignments.values().map(|v| v.len()).sum()\n    }\n}\n\n/// Runtime permission enforcer for capability invocations\npub struct PermissionEnforcer;\n\nimpl PermissionEnforcer {\n    /// Required permission for a KV operation\n    pub fn kv_permission(operation: \u0026str) -\u003e Option\u003c\u0026'static str\u003e {\n        match operation {\n            \"get\" | \"list\" | \"exists\" =\u003e Some(\"kv:read\"),\n            \"set\" =\u003e Some(\"kv:write\"),\n            \"delete\" =\u003e Some(\"kv:delete\"),\n            _ =\u003e None,\n        }\n    }\n\n    /// Required permission for an HTTP operation\n    pub fn http_permission(operation: \u0026str) -\u003e Option\u003c\u0026'static str\u003e {\n        match operation {\n            \"request\" =\u003e Some(\"http:request\"),\n            _ =\u003e None,\n        }\n    }\n\n    /// Required permission for a messaging operation\n    pub fn messaging_permission(operation: \u0026str) -\u003e Option\u003c\u0026'static str\u003e {\n        match operation {\n            \"publish\" =\u003e Some(\"msg:publish\"),\n            \"subscribe\" =\u003e Some(\"msg:subscribe\"),\n            _ =\u003e None,\n        }\n    }\n\n    /// Get required permission for any operation\n    pub fn required_permission(\n        provider_type: ProviderType,\n        operation: \u0026str,\n    ) -\u003e Option\u003c\u0026'static str\u003e {\n        match provider_type {\n            ProviderType::Kv =\u003e Self::kv_permission(operation),\n            ProviderType::Http =\u003e Self::http_permission(operation),\n            ProviderType::Messaging =\u003e Self::messaging_permission(operation),\n        }\n    }\n\n    /// Enforce permission check for a capability invocation\n    pub fn enforce(\n        registry: \u0026CapabilityRegistry,\n        instance_id: \u0026str,\n        capability_id: \u0026str,\n        provider_type: ProviderType,\n        operation: \u0026str,\n    ) -\u003e Result\u003c()\u003e {\n        // Check if assignment exists\n        if !registry.has_capability(instance_id, capability_id) {\n            return Err(CoreError::InvalidCapabilityAssignment(format!(\n                \"Instance '{}' does not have capability '{}' assigned\",\n                instance_id, capability_id\n            )));\n        }\n\n        // Get required permission\n        let required = Self::required_permission(provider_type, operation).ok_or_else(|| {\n            CoreError::InvalidCapabilityAssignment(format!(\n                \"Unknown operation '{}' for provider type {:?}\",\n                operation, provider_type\n            ))\n        })?;\n\n        // Check permission\n        if !registry.has_permission(instance_id, capability_id, required) {\n            return Err(CoreError::InvalidCapabilityAssignment(format!(\n                \"Permission denied: instance '{}' lacks '{}' permission for capability '{}'\",\n                instance_id, required, capability_id\n            )));\n        }\n\n        Ok(())\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    fn create_test_assignment(\n        instance_id: \u0026str,\n        capability_id: \u0026str,\n        provider_type: ProviderType,\n        permissions: Vec\u003c\u0026str\u003e,\n    ) -\u003e CapabilityAssignment {\n        CapabilityAssignment::new(\n            instance_id.to_string(),\n            capability_id.to_string(),\n            provider_type,\n            permissions.into_iter().map(|s| s.to_string()).collect(),\n        )\n    }\n\n    #[test]\n    fn test_capability_registry_basic() {\n        let mut registry = CapabilityRegistry::new();\n\n        // Register a provider\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n\n        // Assign capability\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            vec![\"kv:read\", \"kv:write\"],\n        );\n        registry.assign_capability(assignment).unwrap();\n\n        // Verify assignment exists\n        assert!(registry.has_capability(\"instance-1\", \"kv-store\"));\n        assert!(!registry.has_capability(\"instance-1\", \"other-provider\"));\n        assert!(!registry.has_capability(\"other-instance\", \"kv-store\"));\n\n        // Verify permissions\n        assert!(registry.has_permission(\"instance-1\", \"kv-store\", \"kv:read\"));\n        assert!(registry.has_permission(\"instance-1\", \"kv-store\", \"kv:write\"));\n        assert!(!registry.has_permission(\"instance-1\", \"kv-store\", \"kv:delete\"));\n    }\n\n    #[test]\n    fn test_capability_registry_unregistered_provider() {\n        let mut registry = CapabilityRegistry::new();\n\n        // Try to assign capability for unregistered provider\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"unregistered\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        );\n        let result = registry.assign_capability(assignment);\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_capability_registry_type_mismatch() {\n        let mut registry = CapabilityRegistry::new();\n\n        // Register as KV provider\n        registry.register_provider(\"store\", ProviderType::Kv);\n\n        // Try to assign with wrong type\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"store\",\n            ProviderType::Http, // Wrong type\n            vec![\"http:request\"],\n        );\n        let result = registry.assign_capability(assignment);\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_capability_registry_invalid_permissions() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n\n        // Try to assign with invalid permission for KV\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            vec![\"invalid:permission\"],\n        );\n        let result = registry.assign_capability(assignment);\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_capability_registry_revoke() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n        registry.register_provider(\"http-client\", ProviderType::Http);\n\n        let assignment1 =\n            create_test_assignment(\"instance-1\", \"kv-store\", ProviderType::Kv, vec![\"kv:read\"]);\n        let assignment2 = create_test_assignment(\n            \"instance-1\",\n            \"http-client\",\n            ProviderType::Http,\n            vec![\"http:request\"],\n        );\n\n        registry.assign_capability(assignment1).unwrap();\n        registry.assign_capability(assignment2).unwrap();\n\n        // Revoke one capability\n        let revoked = registry\n            .revoke_capability(\"instance-1\", \"kv-store\")\n            .unwrap();\n        assert!(revoked);\n        assert!(!registry.has_capability(\"instance-1\", \"kv-store\"));\n        assert!(registry.has_capability(\"instance-1\", \"http-client\"));\n\n        // Revoke same capability again should return false\n        let revoked = registry\n            .revoke_capability(\"instance-1\", \"kv-store\")\n            .unwrap();\n        assert!(!revoked);\n\n        // Revoke from non-existent instance\n        let revoked = registry\n            .revoke_capability(\"nonexistent\", \"kv-store\")\n            .unwrap();\n        assert!(!revoked);\n    }\n\n    #[test]\n    fn test_capability_registry_clear_instance() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n        registry.register_provider(\"http-client\", ProviderType::Http);\n\n        let assignment1 =\n            create_test_assignment(\"instance-1\", \"kv-store\", ProviderType::Kv, vec![\"kv:read\"]);\n        let assignment2 = create_test_assignment(\n            \"instance-1\",\n            \"http-client\",\n            ProviderType::Http,\n            vec![\"http:request\"],\n        );\n\n        registry.assign_capability(assignment1).unwrap();\n        registry.assign_capability(assignment2).unwrap();\n\n        assert_eq!(registry.assignment_count(), 2);\n\n        registry.clear_instance(\"instance-1\");\n\n        assert_eq!(registry.assignment_count(), 0);\n        assert!(!registry.has_capability(\"instance-1\", \"kv-store\"));\n        assert!(!registry.has_capability(\"instance-1\", \"http-client\"));\n    }\n\n    #[test]\n    fn test_permission_enforcer_kv() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            vec![\"kv:read\", \"kv:delete\"], // Note: no kv:write\n        );\n        registry.assign_capability(assignment).unwrap();\n\n        // Should allow get (kv:read)\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            \"get\",\n        );\n        assert!(result.is_ok());\n\n        // Should allow list (kv:read)\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            \"list\",\n        );\n        assert!(result.is_ok());\n\n        // Should deny set (missing kv:write)\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            \"set\",\n        );\n        assert!(result.is_err());\n\n        // Should allow delete (kv:delete)\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            \"delete\",\n        );\n        assert!(result.is_ok());\n    }\n\n    #[test]\n    fn test_permission_enforcer_no_assignment() {\n        let registry = CapabilityRegistry::new();\n\n        // Try to enforce on instance with no assignments\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            \"get\",\n        );\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_permission_enforcer_unknown_operation() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n\n        let assignment =\n            create_test_assignment(\"instance-1\", \"kv-store\", ProviderType::Kv, vec![\"kv:read\"]);\n        registry.assign_capability(assignment).unwrap();\n\n        // Unknown operation should fail\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"kv-store\",\n            ProviderType::Kv,\n            \"unknown_op\",\n        );\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_permission_enforcer_http() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"http-client\", ProviderType::Http);\n\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"http-client\",\n            ProviderType::Http,\n            vec![\"http:request\"],\n        );\n        registry.assign_capability(assignment).unwrap();\n\n        // Should allow request\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"http-client\",\n            ProviderType::Http,\n            \"request\",\n        );\n        assert!(result.is_ok());\n    }\n\n    #[test]\n    fn test_permission_enforcer_messaging() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"messaging\", ProviderType::Messaging);\n\n        let assignment = create_test_assignment(\n            \"instance-1\",\n            \"messaging\",\n            ProviderType::Messaging,\n            vec![\"msg:publish\"], // Note: no subscribe\n        );\n        registry.assign_capability(assignment).unwrap();\n\n        // Should allow publish\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"messaging\",\n            ProviderType::Messaging,\n            \"publish\",\n        );\n        assert!(result.is_ok());\n\n        // Should deny subscribe\n        let result = PermissionEnforcer::enforce(\n            \u0026registry,\n            \"instance-1\",\n            \"messaging\",\n            ProviderType::Messaging,\n            \"subscribe\",\n        );\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_registry_multiple_instances() {\n        let mut registry = CapabilityRegistry::new();\n\n        registry.register_provider(\"kv-store\", ProviderType::Kv);\n        registry.register_provider(\"http-client\", ProviderType::Http);\n\n        // Assign different capabilities to different instances\n        let assignment1 =\n            create_test_assignment(\"instance-1\", \"kv-store\", ProviderType::Kv, vec![\"kv:read\"]);\n        let assignment2 = create_test_assignment(\n            \"instance-2\",\n            \"http-client\",\n            ProviderType::Http,\n            vec![\"http:request\"],\n        );\n\n        registry.assign_capability(assignment1).unwrap();\n        registry.assign_capability(assignment2).unwrap();\n\n        // Verify isolation\n        assert!(registry.has_capability(\"instance-1\", \"kv-store\"));\n        assert!(!registry.has_capability(\"instance-1\", \"http-client\"));\n        assert!(!registry.has_capability(\"instance-2\", \"kv-store\"));\n        assert!(registry.has_capability(\"instance-2\", \"http-client\"));\n\n        // Get all instances\n        let instances = registry.get_instances();\n        assert_eq!(instances.len(), 2);\n    }\n}\n","traces":[{"line":13,"address":[4905552],"length":1,"stats":{"Line":12}},{"line":14,"address":[4905560],"length":1,"stats":{"Line":12}},{"line":18,"address":[4622656],"length":1,"stats":{"Line":10}},{"line":23,"address":[4622685],"length":1,"stats":{"Line":10}},{"line":24,"address":[4622693],"length":1,"stats":{"Line":10}},{"line":28,"address":[4903488],"length":1,"stats":{"Line":1}},{"line":30,"address":[4903672,4903578,4903547],"length":1,"stats":{"Line":22}},{"line":32,"address":[4903551],"length":1,"stats":{"Line":11}},{"line":33,"address":[4014624],"length":1,"stats":{"Line":12}},{"line":34,"address":[46849929],"length":1,"stats":{"Line":1}},{"line":41,"address":[4903717],"length":1,"stats":{"Line":2}},{"line":42,"address":[4903829],"length":1,"stats":{"Line":1}},{"line":49,"address":[4904150,4903745],"length":1,"stats":{"Line":10}},{"line":51,"address":[4904241],"length":1,"stats":{"Line":8}},{"line":55,"address":[4904272,4905533,4905527],"length":1,"stats":{"Line":9}},{"line":60,"address":[4904322],"length":1,"stats":{"Line":9}},{"line":61,"address":[4904365,4904480],"length":1,"stats":{"Line":6}},{"line":62,"address":[4904397,4904648],"length":1,"stats":{"Line":2}},{"line":63,"address":[4904749,4904436],"length":1,"stats":{"Line":2}},{"line":66,"address":[4904619,4904921],"length":1,"stats":{"Line":18}},{"line":67,"address":[4905029,4905108],"length":1,"stats":{"Line":18}},{"line":68,"address":[4905214],"length":1,"stats":{"Line":1}},{"line":75,"address":[4905051],"length":1,"stats":{"Line":8}},{"line":79,"address":[4902704,4903101,4903126],"length":1,"stats":{"Line":1}},{"line":81,"address":[4902739,4902818],"length":1,"stats":{"Line":2}},{"line":85,"address":[4902905],"length":1,"stats":{"Line":8}},{"line":86,"address":[4902960],"length":1,"stats":{"Line":6}},{"line":87,"address":[4902982],"length":1,"stats":{"Line":8}},{"line":89,"address":[4903069],"length":1,"stats":{"Line":8}},{"line":93,"address":[4903136],"length":1,"stats":{"Line":1}},{"line":94,"address":[4903427,4903223,4903403],"length":1,"stats":{"Line":3}},{"line":95,"address":[4903279],"length":1,"stats":{"Line":1}},{"line":96,"address":[4622761,4622736],"length":1,"stats":{"Line":3}},{"line":97,"address":[4903316],"length":1,"stats":{"Line":1}},{"line":100,"address":[4903349],"length":1,"stats":{"Line":1}},{"line":101,"address":[4903372],"length":1,"stats":{"Line":1}},{"line":103,"address":[4903381],"length":1,"stats":{"Line":1}},{"line":104,"address":[4903444],"length":1,"stats":{"Line":0}},{"line":107,"address":[4903414],"length":1,"stats":{"Line":1}},{"line":109,"address":[4903392],"length":1,"stats":{"Line":1}},{"line":114,"address":[4902672],"length":1,"stats":{"Line":0}},{"line":115,"address":[4902690],"length":1,"stats":{"Line":0}},{"line":119,"address":[4902432],"length":1,"stats":{"Line":1}},{"line":121,"address":[4902460],"length":1,"stats":{"Line":1}},{"line":122,"address":[4014297,4014176,4014208,4014272],"length":1,"stats":{"Line":19}},{"line":127,"address":[4902496],"length":1,"stats":{"Line":1}},{"line":129,"address":[4902550],"length":1,"stats":{"Line":1}},{"line":130,"address":[46849600],"length":1,"stats":{"Line":3}},{"line":131,"address":[1671611],"length":1,"stats":{"Line":4}},{"line":132,"address":[4622454],"length":1,"stats":{"Line":4}},{"line":133,"address":[1671761,1671637,1671744],"length":1,"stats":{"Line":9}},{"line":134,"address":[1671721,1671656,1671696],"length":1,"stats":{"Line":8}},{"line":140,"address":[4902304],"length":1,"stats":{"Line":1}},{"line":141,"address":[4902323],"length":1,"stats":{"Line":1}},{"line":145,"address":[4902368],"length":1,"stats":{"Line":1}},{"line":146,"address":[4902396],"length":1,"stats":{"Line":1}},{"line":150,"address":[4902624],"length":1,"stats":{"Line":1}},{"line":151,"address":[4622633,4622608],"length":1,"stats":{"Line":3}},{"line":160,"address":[4905584],"length":1,"stats":{"Line":1}},{"line":162,"address":[4905608],"length":1,"stats":{"Line":1}},{"line":163,"address":[4905783,4905729],"length":1,"stats":{"Line":2}},{"line":164,"address":[4905760,4905817],"length":1,"stats":{"Line":2}},{"line":165,"address":[4905806],"length":1,"stats":{"Line":1}},{"line":170,"address":[4905856],"length":1,"stats":{"Line":1}},{"line":172,"address":[4905902,4905870],"length":1,"stats":{"Line":2}},{"line":173,"address":[4905891],"length":1,"stats":{"Line":0}},{"line":178,"address":[4906112],"length":1,"stats":{"Line":1}},{"line":180,"address":[4906136,4906190],"length":1,"stats":{"Line":2}},{"line":181,"address":[4906224,4906167],"length":1,"stats":{"Line":2}},{"line":182,"address":[4906213],"length":1,"stats":{"Line":0}},{"line":187,"address":[4905952],"length":1,"stats":{"Line":3}},{"line":191,"address":[4905983],"length":1,"stats":{"Line":1}},{"line":192,"address":[4906024],"length":1,"stats":{"Line":1}},{"line":193,"address":[4906051],"length":1,"stats":{"Line":1}},{"line":194,"address":[4906078],"length":1,"stats":{"Line":1}},{"line":199,"address":[4906272],"length":1,"stats":{"Line":1}},{"line":207,"address":[4906390],"length":1,"stats":{"Line":1}},{"line":208,"address":[4906423],"length":1,"stats":{"Line":1}},{"line":215,"address":[4906906,4906719],"length":1,"stats":{"Line":3}},{"line":216,"address":[4623013],"length":1,"stats":{"Line":1}},{"line":223,"address":[4906981],"length":1,"stats":{"Line":1}},{"line":224,"address":[4907034],"length":1,"stats":{"Line":1}},{"line":230,"address":[4907432],"length":1,"stats":{"Line":2}}],"covered":78,"coverable":83},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-core","src","isolation.rs"],"content":"//! Instance isolation guarantees for Wasm Orchestrator\n//!\n//! This module enforces isolation between instances:\n//! - Wasmtime provides memory isolation\n//! - Capability assignments are scoped per instance\n//! - Provider access is scoped to requesting instance\n\nuse crate::{CapabilityAssignment, InstanceMetadata, ProviderType, Result};\nuse std::collections::HashMap;\nuse tracing::{info, warn};\n\n/// Isolation policy enforcer\npub struct IsolationPolicy;\n\nimpl IsolationPolicy {\n    /// Verify Wasmtime provides memory isolation\n    /// Note: Wasmtime inherently provides memory isolation between instances\n    /// This function documents the guarantee and could add runtime checks\n    pub fn verify_wasmtime_isolation() -\u003e Result\u003c()\u003e {\n        // Wasmtime provides:\n        // 1. Separate linear memory for each instance\n        // 2. No shared mutable state between instances\n        // 3. Memory bounds enforcement\n        Ok(())\n    }\n\n    /// Verify capability assignments are scoped per instance\n    pub fn verify_capability_isolation(\n        instance_a_id: \u0026str,\n        assignments_a: \u0026[CapabilityAssignment],\n        instance_b_id: \u0026str,\n        assignments_b: \u0026[CapabilityAssignment],\n    ) -\u003e Result\u003cbool\u003e {\n        // Each instance should have its own set of assignments\n        // They should not share the same capability assignments\n        let has_shared_assignments = assignments_a.iter().any(|a| {\n            assignments_b.iter().any(|b| {\n                // Same capability_id means they share the same provider instance\n                // This is okay if both instances have separate permission sets\n                // but we need to verify they don't have the same assignments\n                a.capability_id == b.capability_id \u0026\u0026 a.permissions == b.permissions\n            })\n        });\n\n        Ok(has_shared_assignments)\n    }\n\n    /// Verify provider access is scoped to requesting instance\n    pub fn verify_provider_scoping(\n        requesting_instance: \u0026str,\n        instance_assignments: \u0026[CapabilityAssignment],\n    ) -\u003e Result\u003cbool\u003e {\n        // Check if instance has any capability assignments\n        let has_capabilities = !instance_assignments.is_empty();\n\n        // Verify that each capability has the requesting instance ID\n        let all_scoped = instance_assignments\n            .iter()\n            .all(|a| a.instance_id == requesting_instance);\n\n        if has_capabilities \u0026\u0026 !all_scoped {\n            warn!(\n                instance_id = %requesting_instance,\n                \"Instance has capability assignments not scoped to it\"\n            );\n        }\n\n        Ok(all_scoped)\n    }\n}\n\n/// Isolation sandbox for tracking instance boundaries\n#[derive(Debug, Default)]\npub struct IsolationSandbox {\n    /// Map of instance_id -\u003e isolated memory pages\n    instance_memory: HashMap\u003cString, Vec\u003cu8\u003e\u003e,\n    /// Map of instance_id -\u003e capability assignments\n    instance_capabilities: HashMap\u003cString, Vec\u003cCapabilityAssignment\u003e\u003e,\n}\n\nimpl IsolationSandbox {\n    pub fn new() -\u003e Self {\n        Self::default()\n    }\n\n    /// Register an instance in the sandbox\n    pub fn register_instance(\n        \u0026mut self,\n        instance_id: String,\n        capabilities: Vec\u003cCapabilityAssignment\u003e,\n    ) -\u003e Result\u003c()\u003e {\n        info!(instance_id = %instance_id, \"Registering instance in isolation sandbox\");\n\n        // Initialize isolated memory for instance\n        self.instance_memory.insert(instance_id.clone(), vec![]);\n\n        // Store scoped capabilities\n        self.instance_capabilities.insert(instance_id, capabilities);\n\n        Ok(())\n    }\n\n    /// Unregister an instance from the sandbox\n    pub fn unregister_instance(\u0026mut self, instance_id: \u0026str) -\u003e Result\u003c()\u003e {\n        info!(instance_id = %instance_id, \"Unregistering instance from isolation sandbox\");\n\n        // Remove all instance data from sandbox\n        self.instance_memory.remove(instance_id);\n        self.instance_capabilities.remove(instance_id);\n\n        Ok(())\n    }\n\n    /// Verify instance cannot access another's memory\n    pub fn verify_memory_isolation(\n        \u0026self,\n        instance_id: \u0026str,\n        target_instance_id: \u0026str,\n    ) -\u003e Result\u003cbool\u003e {\n        // Instances should not be able to access each other's memory\n        // This is enforced at the runtime level by wasmtime\n        // We verify the sandbox tracks them separately\n        Ok(instance_id != target_instance_id\n            || self.instance_memory.get(instance_id)\n                != self.instance_memory.get(target_instance_id))\n    }\n\n    /// Verify instance cannot access another's capabilities\n    pub fn verify_capability_isolation(\n        \u0026self,\n        instance_id: \u0026str,\n        target_instance_id: \u0026str,\n        capability_id: \u0026str,\n    ) -\u003e Result\u003cbool\u003e {\n        let can_access = self\n            .instance_capabilities\n            .get(instance_id)\n            .map(|caps| caps.iter().any(|c| c.capability_id == capability_id))\n            .unwrap_or(false);\n\n        if can_access {\n            // Verify the capability is scoped to requesting instance\n            if let Some(caps) = self.instance_capabilities.get(instance_id) {\n                for cap in caps {\n                    if cap.capability_id == capability_id {\n                        return Ok(cap.instance_id == instance_id);\n                    }\n                }\n            }\n        }\n\n        // Cannot access other instance's capabilities\n        Ok(false)\n    }\n\n    /// Get capabilities scoped to instance\n    pub fn get_instance_capabilities(\n        \u0026self,\n        instance_id: \u0026str,\n    ) -\u003e Option\u003c\u0026Vec\u003cCapabilityAssignment\u003e\u003e {\n        self.instance_capabilities.get(instance_id)\n    }\n\n    /// Get isolated memory for instance\n    pub fn get_instance_memory(\u0026self, instance_id: \u0026str) -\u003e Option\u003c\u0026Vec\u003cu8\u003e\u003e {\n        self.instance_memory.get(instance_id)\n    }\n\n    /// Check if instance is registered\n    pub fn is_instance_registered(\u0026self, instance_id: \u0026str) -\u003e bool {\n        self.instance_memory.contains_key(instance_id)\n    }\n\n    /// Count registered instances\n    pub fn instance_count(\u0026self) -\u003e usize {\n        self.instance_memory.len()\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    fn create_test_assignment(\n        instance_id: \u0026str,\n        capability_id: \u0026str,\n        provider_type: ProviderType,\n        permissions: Vec\u003c\u0026str\u003e,\n    ) -\u003e CapabilityAssignment {\n        CapabilityAssignment::new(\n            instance_id.to_string(),\n            capability_id.to_string(),\n            provider_type,\n            permissions.into_iter().map(|s| s.to_string()).collect(),\n        )\n    }\n\n    #[test]\n    fn test_verify_wasmtime_isolation() {\n        assert!(IsolationPolicy::verify_wasmtime_isolation().is_ok());\n    }\n\n    #[test]\n    fn test_verify_capability_isolation_no_overlap() {\n        let assignments_a = vec![\n            create_test_assignment(\"instance-1\", \"kv-1\", ProviderType::Kv, vec![\"kv:read\"]),\n            create_test_assignment(\n                \"instance-1\",\n                \"http-1\",\n                ProviderType::Http,\n                vec![\"http:request\"],\n            ),\n        ];\n\n        let assignments_b = vec![create_test_assignment(\n            \"instance-2\",\n            \"kv-2\",\n            ProviderType::Kv,\n            vec![\"kv:write\"],\n        )];\n\n        let result = IsolationPolicy::verify_capability_isolation(\n            \"instance-1\",\n            \u0026assignments_a,\n            \"instance-2\",\n            \u0026assignments_b,\n        );\n        assert!(result.is_ok());\n        // No shared assignments\n        assert!(!result.unwrap());\n    }\n\n    #[test]\n    fn test_verify_capability_isolation_with_overlap() {\n        let assignments_a = vec![create_test_assignment(\n            \"instance-1\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        let assignments_b = vec![create_test_assignment(\n            \"instance-2\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        let result = IsolationPolicy::verify_capability_isolation(\n            \"instance-1\",\n            \u0026assignments_a,\n            \"instance-2\",\n            \u0026assignments_b,\n        );\n        assert!(result.is_ok());\n        // Has shared assignments (same provider and permissions)\n        assert!(result.unwrap());\n    }\n\n    #[test]\n    fn test_verify_provider_scoping_valid() {\n        let assignments = vec![create_test_assignment(\n            \"instance-1\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        let result = IsolationPolicy::verify_provider_scoping(\"instance-1\", \u0026assignments);\n        assert!(result.is_ok());\n        // All capabilities scoped to requesting instance\n        assert!(result.unwrap());\n    }\n\n    #[test]\n    fn test_verify_provider_scoping_invalid() {\n        // Assignment with wrong instance_id\n        let assignments = vec![create_test_assignment(\n            \"instance-2\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        let result = IsolationPolicy::verify_provider_scoping(\"instance-1\", \u0026assignments);\n        assert!(result.is_ok());\n        // Not scoped to requesting instance\n        assert!(!result.unwrap());\n    }\n\n    #[test]\n    fn test_sandbox_register_and_unregister() {\n        let mut sandbox = IsolationSandbox::new();\n\n        let assignments = vec![create_test_assignment(\n            \"instance-1\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        sandbox\n            .register_instance(\"instance-1\".to_string(), assignments)\n            .unwrap();\n        assert_eq!(sandbox.instance_count(), 1);\n        assert!(sandbox.is_instance_registered(\"instance-1\"));\n\n        sandbox.unregister_instance(\"instance-1\").unwrap();\n        assert_eq!(sandbox.instance_count(), 0);\n        assert!(!sandbox.is_instance_registered(\"instance-1\"));\n    }\n\n    #[test]\n    fn test_sandbox_memory_isolation() {\n        let mut sandbox = IsolationSandbox::new();\n\n        sandbox\n            .register_instance(\"instance-1\".to_string(), vec![])\n            .unwrap();\n        sandbox\n            .register_instance(\"instance-2\".to_string(), vec![])\n            .unwrap();\n\n        // Verify memory isolation between different instances\n        let result = sandbox.verify_memory_isolation(\"instance-1\", \"instance-2\");\n        assert!(result.is_ok());\n        assert!(result.unwrap());\n\n        // Same instance should have same memory\n        let result = sandbox.verify_memory_isolation(\"instance-1\", \"instance-1\");\n        assert!(result.is_ok());\n        assert!(!result.unwrap()); // Same instance, memory not isolated\n    }\n\n    #[test]\n    fn test_sandbox_capability_isolation() {\n        let mut sandbox = IsolationSandbox::new();\n\n        let instance1_caps = vec![create_test_assignment(\n            \"instance-1\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        let instance2_caps = vec![create_test_assignment(\n            \"instance-2\",\n            \"kv-2\",\n            ProviderType::Kv,\n            vec![\"kv:write\"],\n        )];\n\n        sandbox\n            .register_instance(\"instance-1\".to_string(), instance1_caps)\n            .unwrap();\n        sandbox\n            .register_instance(\"instance-2\".to_string(), instance2_caps)\n            .unwrap();\n\n        // Instance 1 cannot access instance 2's capability\n        let result = sandbox.verify_capability_isolation(\"instance-1\", \"instance-2\", \"kv-2\");\n        assert!(result.is_ok());\n        assert!(!result.unwrap());\n\n        // Instance 1 can access its own capability\n        let result = sandbox.verify_capability_isolation(\"instance-1\", \"instance-1\", \"kv-1\");\n        assert!(result.is_ok());\n        assert!(result.unwrap());\n    }\n\n    #[test]\n    fn test_sandbox_get_instance_capabilities() {\n        let mut sandbox = IsolationSandbox::new();\n\n        let caps = vec![create_test_assignment(\n            \"instance-1\",\n            \"kv-1\",\n            ProviderType::Kv,\n            vec![\"kv:read\"],\n        )];\n\n        sandbox\n            .register_instance(\"instance-1\".to_string(), caps)\n            .unwrap();\n\n        let retrieved = sandbox.get_instance_capabilities(\"instance-1\");\n        assert!(retrieved.is_some());\n        assert_eq!(retrieved.unwrap().len(), 1);\n\n        // Cannot get other instance's capabilities\n        let other = sandbox.get_instance_capabilities(\"instance-2\");\n        assert!(other.is_none());\n    }\n\n    #[test]\n    fn test_multiple_instances_isolation() {\n        let mut sandbox = IsolationSandbox::new();\n\n        // Register multiple instances\n        for i in 0..5 {\n            let caps = vec![create_test_assignment(\n                \u0026format!(\"instance-{}\", i),\n                \u0026format!(\"kv-{}\", i),\n                ProviderType::Kv,\n                vec![\"kv:read\"],\n            )];\n            sandbox\n                .register_instance(format!(\"instance-{}\", i), caps)\n                .unwrap();\n        }\n\n        assert_eq!(sandbox.instance_count(), 5);\n\n        // Each instance has its own capabilities\n        for i in 0..5 {\n            let caps = sandbox.get_instance_capabilities(\u0026format!(\"instance-{}\", i));\n            assert!(caps.is_some());\n            assert_eq!(caps.unwrap().len(), 1);\n        }\n\n        // Verify isolation between all pairs\n        for i in 0..5 {\n            for j in 0..5 {\n                if i != j {\n                    let result = sandbox.verify_capability_isolation(\n                        \u0026format!(\"instance-{}\", i),\n                        \u0026format!(\"instance-{}\", j),\n                        \u0026format!(\"kv-{}\", j),\n                    );\n                    assert!(result.is_ok());\n                    assert!(!result.unwrap());\n                }\n            }\n        }\n    }\n}\n","traces":[{"line":19,"address":[5432608],"length":1,"stats":{"Line":1}},{"line":24,"address":[1729251],"length":1,"stats":{"Line":1}},{"line":28,"address":[4627232],"length":1,"stats":{"Line":2}},{"line":36,"address":[5432742],"length":1,"stats":{"Line":4}},{"line":37,"address":[4008784,4008725],"length":1,"stats":{"Line":4}},{"line":41,"address":[1716519],"length":1,"stats":{"Line":2}},{"line":45,"address":[4070585],"length":1,"stats":{"Line":2}},{"line":49,"address":[1728160],"length":1,"stats":{"Line":2}},{"line":54,"address":[4069365],"length":1,"stats":{"Line":2}},{"line":59,"address":[4626242],"length":1,"stats":{"Line":6}},{"line":61,"address":[5431715,5431672],"length":1,"stats":{"Line":4}},{"line":62,"address":[1728361],"length":1,"stats":{"Line":1}},{"line":68,"address":[4069466],"length":1,"stats":{"Line":1}},{"line":82,"address":[5436384],"length":1,"stats":{"Line":5}},{"line":83,"address":[4074168],"length":1,"stats":{"Line":5}},{"line":87,"address":[1729488,1731232,1731269],"length":1,"stats":{"Line":5}},{"line":92,"address":[1730039,1729543,1729659],"length":1,"stats":{"Line":15}},{"line":95,"address":[46906433,46907305,46907626],"length":1,"stats":{"Line":10}},{"line":98,"address":[4072195],"length":1,"stats":{"Line":5}},{"line":100,"address":[4629143],"length":1,"stats":{"Line":5}},{"line":104,"address":[1731344],"length":1,"stats":{"Line":1}},{"line":105,"address":[4073056,4072520],"length":1,"stats":{"Line":2}},{"line":108,"address":[4629746],"length":1,"stats":{"Line":1}},{"line":109,"address":[4629788],"length":1,"stats":{"Line":1}},{"line":111,"address":[5435265],"length":1,"stats":{"Line":1}},{"line":115,"address":[1732384],"length":1,"stats":{"Line":1}},{"line":123,"address":[4630363,4630454,4630469],"length":1,"stats":{"Line":3}},{"line":124,"address":[5435857,5435811],"length":1,"stats":{"Line":2}},{"line":125,"address":[46908892],"length":1,"stats":{"Line":1}},{"line":129,"address":[4630528],"length":1,"stats":{"Line":1}},{"line":135,"address":[1732721],"length":1,"stats":{"Line":1}},{"line":137,"address":[46909151],"length":1,"stats":{"Line":2}},{"line":138,"address":[4866960,4866880,4866985,4866912],"length":1,"stats":{"Line":10}},{"line":141,"address":[1732778],"length":1,"stats":{"Line":2}},{"line":143,"address":[5436168],"length":1,"stats":{"Line":1}},{"line":144,"address":[5436250,5436234],"length":1,"stats":{"Line":2}},{"line":145,"address":[46909372],"length":1,"stats":{"Line":1}},{"line":146,"address":[1732981],"length":1,"stats":{"Line":1}},{"line":153,"address":[4630705],"length":1,"stats":{"Line":2}},{"line":157,"address":[4073696],"length":1,"stats":{"Line":1}},{"line":161,"address":[4073714],"length":1,"stats":{"Line":1}},{"line":165,"address":[4072448],"length":1,"stats":{"Line":0}},{"line":166,"address":[4072466],"length":1,"stats":{"Line":0}},{"line":170,"address":[46908768],"length":1,"stats":{"Line":1}},{"line":171,"address":[46908786],"length":1,"stats":{"Line":1}},{"line":175,"address":[4627440],"length":1,"stats":{"Line":2}},{"line":176,"address":[4627445],"length":1,"stats":{"Line":2}}],"covered":45,"coverable":47},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-core","src","lib.rs"],"content":"pub mod capability;\npub mod isolation;\npub mod statelessness;\n\nuse chrono::{DateTime, Utc};\nuse serde::{Deserialize, Serialize};\nuse std::collections::HashMap;\nuse thiserror::Error;\nuse uuid::Uuid;\n\n#[derive(Debug, Clone, Error)]\npub enum CoreError {\n    #[error(\"Invalid instance ID: {0}\")]\n    InvalidInstanceId(String),\n    #[error(\"Invalid capability assignment: {0}\")]\n    InvalidCapabilityAssignment(String),\n    #[error(\"Serialization error: {0}\")]\n    SerializationError(String),\n}\n\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\n#[serde(rename_all = \"snake_case\")]\npub enum InstanceStatus {\n    Starting,\n    Running,\n    Stopped,\n    Crashed,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct InstanceMetadata {\n    pub instance_id: String,\n    pub node_id: String,\n    pub module_hash: String,\n    pub created_at: DateTime\u003cUtc\u003e,\n    pub status: InstanceStatus,\n}\n\nimpl InstanceMetadata {\n    pub fn new(node_id: String, module_hash: String) -\u003e Self {\n        Self {\n            instance_id: Uuid::new_v4().to_string(),\n            node_id,\n            module_hash,\n            created_at: Utc::now(),\n            status: InstanceStatus::Starting,\n        }\n    }\n}\n\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\n#[serde(rename_all = \"snake_case\")]\npub enum ProviderType {\n    Kv,\n    Http,\n    Messaging,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct CapabilityAssignment {\n    pub instance_id: String,\n    pub capability_id: String,\n    pub provider_type: ProviderType,\n    pub permissions: Vec\u003cString\u003e,\n}\n\nimpl CapabilityAssignment {\n    pub fn new(\n        instance_id: String,\n        capability_id: String,\n        provider_type: ProviderType,\n        permissions: Vec\u003cString\u003e,\n    ) -\u003e Self {\n        Self {\n            instance_id,\n            capability_id,\n            provider_type,\n            permissions,\n        }\n    }\n\n    pub fn has_permission(\u0026self, permission: \u0026str) -\u003e bool {\n        self.permissions.contains(\u0026permission.to_string())\n    }\n}\n\n#[derive(Debug, Clone, Copy, PartialEq, Eq, Serialize, Deserialize)]\n#[serde(rename_all = \"snake_case\")]\npub enum RestartPolicyType {\n    Never,\n    Always,\n    OnFailure,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct RestartPolicy {\n    pub policy_type: RestartPolicyType,\n    pub max_retries: Option\u003cu32\u003e,\n    pub backoff_seconds: Option\u003cu64\u003e,\n}\n\nimpl Default for RestartPolicy {\n    fn default() -\u003e Self {\n        Self {\n            policy_type: RestartPolicyType::Never,\n            max_retries: None,\n            backoff_seconds: None,\n        }\n    }\n}\n\nimpl RestartPolicy {\n    pub fn never() -\u003e Self {\n        Self {\n            policy_type: RestartPolicyType::Never,\n            max_retries: None,\n            backoff_seconds: None,\n        }\n    }\n\n    pub fn always() -\u003e Self {\n        Self {\n            policy_type: RestartPolicyType::Always,\n            max_retries: None,\n            backoff_seconds: None,\n        }\n    }\n\n    pub fn on_failure(max_retries: u32, backoff_seconds: u64) -\u003e Self {\n        Self {\n            policy_type: RestartPolicyType::OnFailure,\n            max_retries: Some(max_retries),\n            backoff_seconds: Some(backoff_seconds),\n        }\n    }\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct StartInstanceRequest {\n    pub module_bytes: Vec\u003cu8\u003e,\n    pub capabilities: Vec\u003cCapabilityAssignment\u003e,\n    pub restart_policy: RestartPolicy,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct StopInstanceRequest {\n    pub instance_id: String,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct QueryInstanceRequest {\n    pub instance_id: String,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct InstanceStatusResponse {\n    pub instance_id: String,\n    pub status: InstanceStatus,\n    pub node_id: String,\n    pub created_at: DateTime\u003cUtc\u003e,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ErrorResponse {\n    pub error_code: String,\n    pub message: String,\n    pub details: Option\u003cHashMap\u003cString, String\u003e\u003e,\n    pub timestamp: DateTime\u003cUtc\u003e,\n}\n\nimpl ErrorResponse {\n    pub fn new(error_code: impl Into\u003cString\u003e, message: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            error_code: error_code.into(),\n            message: message.into(),\n            details: None,\n            timestamp: Utc::now(),\n        }\n    }\n\n    pub fn with_details(mut self, details: HashMap\u003cString, String\u003e) -\u003e Self {\n        self.details = Some(details);\n        self\n    }\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ExecutionEvent {\n    pub event_type: String,\n    pub instance_id: String,\n    pub timestamp: DateTime\u003cUtc\u003e,\n    pub details: Option\u003cHashMap\u003cString, String\u003e\u003e,\n}\n\nimpl ExecutionEvent {\n    pub fn new(event_type: impl Into\u003cString\u003e, instance_id: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            event_type: event_type.into(),\n            instance_id: instance_id.into(),\n            timestamp: Utc::now(),\n            details: None,\n        }\n    }\n\n    pub fn with_details(mut self, details: HashMap\u003cString, String\u003e) -\u003e Self {\n        self.details = Some(details);\n        self\n    }\n}\n\npub type Result\u003cT\u003e = std::result::Result\u003cT, CoreError\u003e;\n\n/// Registry that maintains separate storage for instance and provider metadata\n#[derive(Debug, Default)]\npub struct MetadataRegistry {\n    instances: HashMap\u003cString, InstanceMetadata\u003e,\n    providers: HashMap\u003cString, ProviderMetadata\u003e,\n}\n\n#[derive(Debug, Clone, Serialize, Deserialize)]\npub struct ProviderMetadata {\n    pub provider_id: String,\n    pub provider_type: ProviderType,\n    pub version: String,\n    pub created_at: DateTime\u003cUtc\u003e,\n}\n\nimpl ProviderMetadata {\n    pub fn new(provider_id: String, provider_type: ProviderType, version: String) -\u003e Self {\n        Self {\n            provider_id,\n            provider_type,\n            version,\n            created_at: Utc::now(),\n        }\n    }\n}\n\nimpl MetadataRegistry {\n    pub fn new() -\u003e Self {\n        Self::default()\n    }\n\n    pub fn store_instance(\u0026mut self, metadata: InstanceMetadata) {\n        self.instances\n            .insert(metadata.instance_id.clone(), metadata);\n    }\n\n    pub fn store_provider(\u0026mut self, metadata: ProviderMetadata) {\n        self.providers\n            .insert(metadata.provider_id.clone(), metadata);\n    }\n\n    pub fn get_instance(\u0026self, instance_id: \u0026str) -\u003e Option\u003c\u0026InstanceMetadata\u003e {\n        self.instances.get(instance_id)\n    }\n\n    pub fn get_provider(\u0026self, provider_id: \u0026str) -\u003e Option\u003c\u0026ProviderMetadata\u003e {\n        self.providers.get(provider_id)\n    }\n\n    pub fn instances(\u0026self) -\u003e \u0026HashMap\u003cString, InstanceMetadata\u003e {\n        \u0026self.instances\n    }\n\n    pub fn providers(\u0026self) -\u003e \u0026HashMap\u003cString, ProviderMetadata\u003e {\n        \u0026self.providers\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    #[test]\n    fn test_instance_metadata_creation() {\n        let metadata = InstanceMetadata::new(\"node-1\".to_string(), \"abc123\".to_string());\n        assert_eq!(metadata.node_id, \"node-1\");\n        assert_eq!(metadata.module_hash, \"abc123\");\n        assert_eq!(metadata.status, InstanceStatus::Starting);\n        assert!(!metadata.instance_id.is_empty());\n    }\n\n    #[test]\n    fn test_capability_assignment_permissions() {\n        let assignment = CapabilityAssignment::new(\n            \"instance-1\".to_string(),\n            \"kv-1\".to_string(),\n            ProviderType::Kv,\n            vec![\"kv:read\".to_string(), \"kv:write\".to_string()],\n        );\n\n        assert!(assignment.has_permission(\"kv:read\"));\n        assert!(assignment.has_permission(\"kv:write\"));\n        assert!(!assignment.has_permission(\"kv:delete\"));\n    }\n\n    #[test]\n    fn test_restart_policy_default() {\n        let policy = RestartPolicy::default();\n        assert_eq!(policy.policy_type, RestartPolicyType::Never);\n        assert!(policy.max_retries.is_none());\n        assert!(policy.backoff_seconds.is_none());\n    }\n\n    #[test]\n    fn test_restart_policy_on_failure() {\n        let policy = RestartPolicy::on_failure(3, 5);\n        assert_eq!(policy.policy_type, RestartPolicyType::OnFailure);\n        assert_eq!(policy.max_retries, Some(3));\n        assert_eq!(policy.backoff_seconds, Some(5));\n    }\n\n    #[test]\n    fn test_serialization_roundtrip() {\n        let metadata = InstanceMetadata::new(\"node-1\".to_string(), \"abc123\".to_string());\n        let json = serde_json::to_string(\u0026metadata).unwrap();\n        let deserialized: InstanceMetadata = serde_json::from_str(\u0026json).unwrap();\n\n        assert_eq!(metadata.instance_id, deserialized.instance_id);\n        assert_eq!(metadata.node_id, deserialized.node_id);\n        assert_eq!(metadata.module_hash, deserialized.module_hash);\n    }\n\n    #[test]\n    fn test_error_response_creation() {\n        let error = ErrorResponse::new(\"INVALID_REQUEST\", \"Invalid module format\");\n        assert_eq!(error.error_code, \"INVALID_REQUEST\");\n        assert_eq!(error.message, \"Invalid module format\");\n    }\n\n    /// Property 21: Provider and Instance Metadata Separation\n    /// For any capability provider and instance metadata stored by the orchestrator,\n    /// the metadata should be maintained in separate data structures.\n    /// Validates: Requirements 16.5\n    mod property_tests {\n        use super::*;\n        use proptest::prelude::*;\n\n        fn instance_metadata_strategy() -\u003e impl Strategy\u003cValue = InstanceMetadata\u003e {\n            (any::\u003c[u8; 16]\u003e(), any::\u003c[u8; 16]\u003e()).prop_map(|(node_bytes, hash_bytes)| {\n                let node_id = format!(\"node-{}\", hex::encode(\u0026node_bytes[..4]));\n                let module_hash = hex::encode(\u0026hash_bytes[..8]);\n                InstanceMetadata::new(node_id, module_hash)\n            })\n        }\n\n        fn provider_type_strategy() -\u003e impl Strategy\u003cValue = ProviderType\u003e {\n            prop_oneof![\n                Just(ProviderType::Kv),\n                Just(ProviderType::Http),\n                Just(ProviderType::Messaging),\n            ]\n        }\n\n        fn provider_metadata_strategy() -\u003e impl Strategy\u003cValue = ProviderMetadata\u003e {\n            (\n                any::\u003c[u8; 16]\u003e(),\n                provider_type_strategy(),\n                any::\u003c[u8; 4]\u003e(),\n            )\n                .prop_map(|(id_bytes, provider_type, version_bytes)| {\n                    let provider_id = format!(\"provider-{}\", hex::encode(\u0026id_bytes[..4]));\n                    let version = format!(\n                        \"{}.{}.{}\",\n                        version_bytes[0], version_bytes[1], version_bytes[2]\n                    );\n                    ProviderMetadata::new(provider_id, provider_type, version)\n                })\n        }\n\n        proptest! {\n            #![proptest_config(ProptestConfig::with_cases(100))]\n\n            #[test]\n            fn property_21_provider_and_instance_metadata_separation(\n                instances in prop::collection::vec(instance_metadata_strategy(), 0..100),\n                providers in prop::collection::vec(provider_metadata_strategy(), 0..100),\n            ) {\n                let mut registry = MetadataRegistry::new();\n\n                // Store all instances\n                for instance in \u0026instances {\n                    registry.store_instance(instance.clone());\n                }\n\n                // Store all providers\n                for provider in \u0026providers {\n                    registry.store_provider(provider.clone());\n                }\n\n                // Verify separation: instance IDs should not appear in providers\n                for instance in \u0026instances {\n                    prop_assert!(\n                        registry.get_provider(\u0026instance.instance_id).is_none(),\n                        \"Instance ID {} found in provider storage - metadata not properly separated\",\n                        instance.instance_id\n                    );\n                }\n\n                // Verify separation: provider IDs should not appear in instances\n                for provider in \u0026providers {\n                    prop_assert!(\n                        registry.get_instance(\u0026provider.provider_id).is_none(),\n                        \"Provider ID {} found in instance storage - metadata not properly separated\",\n                        provider.provider_id\n                    );\n                }\n\n                // Verify counts match\n                prop_assert_eq!(\n                    registry.instances().len(),\n                    instances.len(),\n                    \"Instance count mismatch\"\n                );\n                prop_assert_eq!(\n                    registry.providers().len(),\n                    providers.len(),\n                    \"Provider count mismatch\"\n                );\n\n                // Verify all instances are retrievable\n                for instance in \u0026instances {\n                    prop_assert!(\n                        registry.get_instance(\u0026instance.instance_id).is_some(),\n                        \"Instance {} not found in registry\",\n                        instance.instance_id\n                    );\n                }\n\n                // Verify all providers are retrievable\n                for provider in \u0026providers {\n                    prop_assert!(\n                        registry.get_provider(\u0026provider.provider_id).is_some(),\n                        \"Provider {} not found in registry\",\n                        provider.provider_id\n                    );\n                }\n            }\n        }\n    }\n}\n","traces":[{"line":40,"address":[46921587,46921656,46921200],"length":1,"stats":{"Line":3}},{"line":42,"address":[1746683,1746772],"length":1,"stats":{"Line":6}},{"line":45,"address":[4086120],"length":1,"stats":{"Line":3}},{"line":68,"address":[5449760],"length":1,"stats":{"Line":8}},{"line":82,"address":[4752080,4752250,4752244],"length":1,"stats":{"Line":2}},{"line":83,"address":[4087373],"length":1,"stats":{"Line":2}},{"line":103,"address":[4094032],"length":1,"stats":{"Line":8}},{"line":113,"address":[4085648],"length":1,"stats":{"Line":1}},{"line":121,"address":[4750480],"length":1,"stats":{"Line":1}},{"line":129,"address":[4085600],"length":1,"stats":{"Line":2}},{"line":172,"address":[3960660,3960256,3960685,3960704,3961104,3961129],"length":1,"stats":{"Line":4}},{"line":174,"address":[],"length":0,"stats":{"Line":4}},{"line":175,"address":[],"length":0,"stats":{"Line":3}},{"line":177,"address":[3960483,3960927],"length":1,"stats":{"Line":3}},{"line":181,"address":[1746128,1746309],"length":1,"stats":{"Line":0}},{"line":182,"address":[5447748,5447643],"length":1,"stats":{"Line":0}},{"line":183,"address":[4750361],"length":1,"stats":{"Line":0}},{"line":196,"address":[],"length":0,"stats":{"Line":0}},{"line":198,"address":[],"length":0,"stats":{"Line":0}},{"line":199,"address":[],"length":0,"stats":{"Line":0}},{"line":200,"address":[],"length":0,"stats":{"Line":0}},{"line":205,"address":[46921173,46920992],"length":1,"stats":{"Line":0}},{"line":206,"address":[4750539,4750636],"length":1,"stats":{"Line":0}},{"line":207,"address":[46921153],"length":1,"stats":{"Line":0}},{"line":229,"address":[1747840,1748037,1748059],"length":1,"stats":{"Line":1}},{"line":234,"address":[5449386],"length":1,"stats":{"Line":1}},{"line":240,"address":[46922320],"length":1,"stats":{"Line":1}},{"line":241,"address":[5449272],"length":1,"stats":{"Line":1}},{"line":244,"address":[46922014,46921776,46922043],"length":1,"stats":{"Line":1}},{"line":245,"address":[4086520],"length":1,"stats":{"Line":1}},{"line":246,"address":[46921816,46921882],"length":1,"stats":{"Line":2}},{"line":249,"address":[4751764,4751536,4751739],"length":1,"stats":{"Line":1}},{"line":250,"address":[46922084],"length":1,"stats":{"Line":1}},{"line":251,"address":[4751645,4751581],"length":1,"stats":{"Line":2}},{"line":254,"address":[1747152],"length":1,"stats":{"Line":1}},{"line":255,"address":[1747170],"length":1,"stats":{"Line":1}},{"line":258,"address":[46921728],"length":1,"stats":{"Line":1}},{"line":259,"address":[1747202],"length":1,"stats":{"Line":1}},{"line":262,"address":[46922352],"length":1,"stats":{"Line":1}},{"line":266,"address":[4751824],"length":1,"stats":{"Line":1}},{"line":267,"address":[4751832],"length":1,"stats":{"Line":1}}],"covered":31,"coverable":41},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-core","src","statelessness.rs"],"content":"//! Statelessness guarantees for the Wasm Orchestrator\n//!\n//! This module enforces the core principle that Wasm instances are stateless\n//! and restart-assumed. No instance memory state is persisted.\n\nuse crate::{CapabilityAssignment, CoreError, InstanceMetadata, InstanceStatus, Result};\n\n/// Audit record for verifying statelessness\n#[derive(Debug, Clone)]\npub struct StateAudit {\n    pub instance_id: String,\n    pub stored_fields: Vec\u003cString\u003e,\n    pub excluded_fields: Vec\u003cString\u003e,\n    pub timestamp: chrono::DateTime\u003cchrono::Utc\u003e,\n}\n\nimpl StateAudit {\n    pub fn new(instance_id: impl Into\u003cString\u003e) -\u003e Self {\n        Self {\n            instance_id: instance_id.into(),\n            stored_fields: Vec::new(),\n            excluded_fields: Vec::new(),\n            timestamp: chrono::Utc::now(),\n        }\n    }\n\n    /// Verify that only allowed metadata is stored\n    pub fn verify_minimal_storage(\u0026self) -\u003e Result\u003c()\u003e {\n        let allowed_fields = vec![\n            \"instance_id\",\n            \"node_id\",\n            \"module_hash\",\n            \"created_at\",\n            \"status\",\n        ];\n\n        for field in \u0026self.stored_fields {\n            if !allowed_fields.contains(\u0026field.as_str()) {\n                return Err(CoreError::InvalidCapabilityAssignment(format!(\n                    \"State violation: field '{}' should not be persisted\",\n                    field\n                )));\n            }\n        }\n\n        Ok(())\n    }\n}\n\n/// Policy enforcer for minimal state storage\npub struct StatelessnessPolicy;\n\nimpl StatelessnessPolicy {\n    /// Verify that instance metadata contains no application state\n    pub fn verify_instance_metadata(metadata: \u0026InstanceMetadata) -\u003e Result\u003c()\u003e {\n        // Ensure no application data in metadata\n        // Only system-level fields should be present\n        let allowed_statuses = vec![\n            InstanceStatus::Starting,\n            InstanceStatus::Running,\n            InstanceStatus::Stopped,\n            InstanceStatus::Crashed,\n        ];\n\n        if !allowed_statuses.contains(\u0026metadata.status) {\n            return Err(CoreError::InvalidCapabilityAssignment(\n                \"Invalid instance status in metadata\".to_string(),\n            ));\n        }\n\n        Ok(())\n    }\n\n    /// Verify capability assignments contain no application data\n    pub fn verify_capability_assignments(assignments: \u0026[CapabilityAssignment]) -\u003e Result\u003c()\u003e {\n        for assignment in assignments {\n            // Verify assignment only contains capability metadata\n            // No application state should be in assignments\n            if assignment.capability_id.is_empty() {\n                return Err(CoreError::InvalidCapabilityAssignment(\n                    \"Empty capability_id in assignment\".to_string(),\n                ));\n            }\n\n            if assignment.instance_id.is_empty() {\n                return Err(CoreError::InvalidCapabilityAssignment(\n                    \"Empty instance_id in assignment\".to_string(),\n                ));\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Verify that restart clears all instance state\n    pub fn verify_restart_state_cleared(\n        instance_id: \u0026str,\n        old_metadata: Option\u003c\u0026InstanceMetadata\u003e,\n        new_metadata: \u0026InstanceMetadata,\n    ) -\u003e Result\u003c()\u003e {\n        if let Some(old) = old_metadata {\n            // Ensure instance gets a new ID on restart\n            if old.instance_id == new_metadata.instance_id {\n                return Err(CoreError::InvalidCapabilityAssignment(format!(\n                    \"State violation: instance {} retains same ID after restart\",\n                    instance_id\n                )));\n            }\n\n            // Ensure new creation time (not copied from old)\n            if old.created_at \u003e= new_metadata.created_at {\n                return Err(CoreError::InvalidCapabilityAssignment(format!(\n                    \"State violation: instance {} creation time not updated after restart\",\n                    instance_id\n                )));\n            }\n        }\n\n        Ok(())\n    }\n\n    /// Check that no logs are persisted as state\n    pub fn verify_no_log_state(logs: \u0026[String]) -\u003e Result\u003c()\u003e {\n        // Logs should be ephemeral, not stored as state\n        // This is a documentation/verification function\n        // In practice, logs are written to stdout/stderr, not stored in metadata\n        Ok(())\n    }\n}\n\n/// Trait for KV provider externalization\npub trait KvProvider {\n    fn set(\u0026mut self, key: String, value: String) -\u003e Result\u003c()\u003e;\n}\n\n/// Externalization helper for state that must be persisted\npub struct StateExternalizer;\n\nimpl StateExternalizer {\n    /// All persistent state must be externalized through capability providers\n    /// This function documents the externalization pattern\n    pub fn externalize_via_kv\u003cT: serde::Serialize\u003e(\n        key: \u0026str,\n        value: \u0026T,\n        kv_provider: \u0026mut dyn KvProvider,\n    ) -\u003e Result\u003c()\u003e {\n        let json = serde_json::to_string(value)\n            .map_err(|e| CoreError::SerializationError(e.to_string()))?;\n\n        kv_provider.set(key.to_string(), json)\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n    use crate::{ProviderType, RestartPolicy};\n\n    #[test]\n    fn test_verify_minimal_storage_allowed_fields() {\n        let audit = StateAudit {\n            instance_id: \"test-1\".to_string(),\n            stored_fields: vec![\n                \"instance_id\".to_string(),\n                \"node_id\".to_string(),\n                \"module_hash\".to_string(),\n            ],\n            excluded_fields: vec![],\n            timestamp: chrono::Utc::now(),\n        };\n\n        assert!(audit.verify_minimal_storage().is_ok());\n    }\n\n    #[test]\n    fn test_verify_minimal_storage_violation() {\n        let audit = StateAudit {\n            instance_id: \"test-1\".to_string(),\n            stored_fields: vec![\n                \"instance_id\".to_string(),\n                \"user_session_data\".to_string(), // Not allowed!\n            ],\n            excluded_fields: vec![],\n            timestamp: chrono::Utc::now(),\n        };\n\n        assert!(audit.verify_minimal_storage().is_err());\n    }\n\n    #[test]\n    fn test_verify_instance_metadata() {\n        let metadata = InstanceMetadata::new(\"node-1\".to_string(), \"abc123\".to_string());\n\n        assert!(StatelessnessPolicy::verify_instance_metadata(\u0026metadata).is_ok());\n    }\n\n    #[test]\n    fn test_verify_capability_assignments() {\n        let assignments = vec![CapabilityAssignment::new(\n            \"instance-1\".to_string(),\n            \"kv-1\".to_string(),\n            ProviderType::Kv,\n            vec![\"kv:read\".to_string()],\n        )];\n\n        assert!(StatelessnessPolicy::verify_capability_assignments(\u0026assignments).is_ok());\n    }\n\n    #[test]\n    fn test_verify_capability_assignments_empty_id() {\n        let assignments = vec![CapabilityAssignment::new(\n            \"instance-1\".to_string(),\n            \"\".to_string(), // Empty capability_id\n            ProviderType::Kv,\n            vec![\"kv:read\".to_string()],\n        )];\n\n        assert!(StatelessnessPolicy::verify_capability_assignments(\u0026assignments).is_err());\n    }\n\n    #[test]\n    fn test_verify_restart_state_cleared_same_id() {\n        // Create metadata with the same ID (simulating a bug where ID is reused)\n        let shared_id = \"same-instance-id\".to_string();\n        let old_metadata = InstanceMetadata {\n            instance_id: shared_id.clone(),\n            node_id: \"node-1\".to_string(),\n            module_hash: \"hash123\".to_string(),\n            created_at: chrono::Utc::now(),\n            status: InstanceStatus::Running,\n        };\n\n        // Wait a moment\n        std::thread::sleep(std::time::Duration::from_millis(10));\n\n        // New metadata with SAME ID (this should fail validation)\n        let new_metadata = InstanceMetadata {\n            instance_id: shared_id, // Same ID!\n            node_id: \"node-1\".to_string(),\n            module_hash: \"hash123\".to_string(),\n            created_at: chrono::Utc::now(),\n            status: InstanceStatus::Starting,\n        };\n\n        // Should fail because instance_id is the same after restart\n        let result = StatelessnessPolicy::verify_restart_state_cleared(\n            \"test-instance\",\n            Some(\u0026old_metadata),\n            \u0026new_metadata,\n        );\n\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_verify_restart_state_cleared_new_id() {\n        // First instance\n        let old_id = \"old-instance-id\".to_string();\n        let old_metadata = InstanceMetadata {\n            instance_id: old_id.clone(),\n            node_id: \"node-1\".to_string(),\n            module_hash: \"hash123\".to_string(),\n            created_at: chrono::Utc::now(),\n            status: InstanceStatus::Running,\n        };\n\n        // Wait a moment to ensure different timestamp\n        std::thread::sleep(std::time::Duration::from_millis(10));\n\n        // New instance after restart (different ID)\n        let new_metadata = InstanceMetadata {\n            instance_id: \"new-instance-id\".to_string(),\n            node_id: \"node-1\".to_string(),\n            module_hash: \"hash123\".to_string(),\n            created_at: chrono::Utc::now(),\n            status: InstanceStatus::Starting,\n        };\n\n        let result = StatelessnessPolicy::verify_restart_state_cleared(\n            \"test-instance\",\n            Some(\u0026old_metadata),\n            \u0026new_metadata,\n        );\n\n        assert!(result.is_ok());\n    }\n}\n\n/// Module for in-memory KV store testing\npub mod test_utils {\n    use super::*;\n    use std::collections::HashMap;\n\n    pub struct TestKvProvider {\n        storage: HashMap\u003cString, String\u003e,\n    }\n\n    impl TestKvProvider {\n        pub fn new() -\u003e Self {\n            Self {\n                storage: HashMap::new(),\n            }\n        }\n    }\n\n    impl KvProvider for TestKvProvider {\n        fn set(\u0026mut self, key: String, value: String) -\u003e Result\u003c()\u003e {\n            self.storage.insert(key, value);\n            Ok(())\n        }\n    }\n}\n","traces":[{"line":18,"address":[],"length":0,"stats":{"Line":0}},{"line":20,"address":[],"length":0,"stats":{"Line":0}},{"line":21,"address":[],"length":0,"stats":{"Line":0}},{"line":22,"address":[],"length":0,"stats":{"Line":0}},{"line":23,"address":[],"length":0,"stats":{"Line":0}},{"line":28,"address":[4636163,4636169,4635312],"length":1,"stats":{"Line":1}},{"line":29,"address":[4635342,4635560],"length":1,"stats":{"Line":2}},{"line":37,"address":[4635624,4635539],"length":1,"stats":{"Line":4}},{"line":38,"address":[4635729,4635802],"length":1,"stats":{"Line":4}},{"line":39,"address":[4635908],"length":1,"stats":{"Line":1}},{"line":46,"address":[4635751],"length":1,"stats":{"Line":1}},{"line":55,"address":[4636641,4636647,4636224],"length":1,"stats":{"Line":1}},{"line":58,"address":[4636254,4636391],"length":1,"stats":{"Line":1}},{"line":65,"address":[4636456,4636374],"length":1,"stats":{"Line":2}},{"line":66,"address":[4636538],"length":1,"stats":{"Line":0}},{"line":67,"address":[4636481],"length":1,"stats":{"Line":0}},{"line":71,"address":[4636514],"length":1,"stats":{"Line":1}},{"line":75,"address":[4637312],"length":1,"stats":{"Line":2}},{"line":76,"address":[4637386,4637371],"length":1,"stats":{"Line":4}},{"line":79,"address":[4637446],"length":1,"stats":{"Line":2}},{"line":80,"address":[4637529],"length":1,"stats":{"Line":1}},{"line":81,"address":[4637501],"length":1,"stats":{"Line":1}},{"line":85,"address":[4637490],"length":1,"stats":{"Line":1}},{"line":86,"address":[4637639],"length":1,"stats":{"Line":0}},{"line":87,"address":[4637608],"length":1,"stats":{"Line":0}},{"line":92,"address":[4637466],"length":1,"stats":{"Line":1}},{"line":96,"address":[4636672],"length":1,"stats":{"Line":1}},{"line":101,"address":[4636717],"length":1,"stats":{"Line":1}},{"line":103,"address":[4636767],"length":1,"stats":{"Line":2}},{"line":104,"address":[4636827],"length":1,"stats":{"Line":1}},{"line":111,"address":[4636804],"length":1,"stats":{"Line":1}},{"line":112,"address":[4637038],"length":1,"stats":{"Line":0}},{"line":119,"address":[4636783],"length":1,"stats":{"Line":1}},{"line":123,"address":[4636192],"length":1,"stats":{"Line":0}},{"line":127,"address":[4636205],"length":1,"stats":{"Line":0}},{"line":147,"address":[],"length":0,"stats":{"Line":0}},{"line":148,"address":[],"length":0,"stats":{"Line":0}},{"line":150,"address":[],"length":0,"stats":{"Line":0}},{"line":299,"address":[4910528],"length":1,"stats":{"Line":0}},{"line":301,"address":[4910542],"length":1,"stats":{"Line":0}},{"line":307,"address":[4910464],"length":1,"stats":{"Line":0}},{"line":308,"address":[4910483],"length":1,"stats":{"Line":0}},{"line":309,"address":[4910514],"length":1,"stats":{"Line":0}}],"covered":23,"coverable":43},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-providers","src","kv_provider.rs"],"content":"use serde_json::Value;\nuse std::collections::HashMap;\nuse std::sync::{Arc, RwLock};\nuse wasmatrix_core::{CapabilityAssignment, CoreError, ProviderType, Result};\n\nuse crate::{CapabilityProvider, ProviderMetadata};\n\n/// Thread-safe KV Provider with in-memory storage and permission validation\npub struct KvProvider {\n    storage: Arc\u003cRwLock\u003cHashMap\u003cString, String\u003e\u003e\u003e,\n    metadata: ProviderMetadata,\n}\n\nimpl KvProvider {\n    pub fn new(provider_id: String) -\u003e Self {\n        Self {\n            storage: Arc::new(RwLock::new(HashMap::new())),\n            metadata: ProviderMetadata {\n                provider_id,\n                provider_type: ProviderType::Kv,\n                version: \"0.1.0\".to_string(),\n            },\n        }\n    }\n\n    /// Validate that the capability assignment has the required permission\n    fn validate_permission(\n        \u0026self,\n        assignment: \u0026CapabilityAssignment,\n        operation: \u0026str,\n    ) -\u003e Result\u003c()\u003e {\n        let required_permission = match operation {\n            \"get\" | \"list\" =\u003e \"kv:read\",\n            \"set\" =\u003e \"kv:write\",\n            \"delete\" =\u003e \"kv:delete\",\n            _ =\u003e {\n                return Err(CoreError::InvalidCapabilityAssignment(format!(\n                    \"Unknown operation: {}\",\n                    operation\n                )))\n            }\n        };\n\n        if !assignment.has_permission(required_permission) {\n            return Err(CoreError::InvalidCapabilityAssignment(format!(\n                \"Permission denied: missing '{}' permission\",\n                required_permission\n            )));\n        }\n\n        Ok(())\n    }\n\n    /// Get a value by key (direct API)\n    pub fn get(\u0026self, key: \u0026str) -\u003e Result\u003cOption\u003cString\u003e\u003e {\n        let storage = self.storage.read().map_err(|_| {\n            CoreError::InvalidCapabilityAssignment(\"Storage lock poisoned\".to_string())\n        })?;\n        Ok(storage.get(key).cloned())\n    }\n\n    /// Set a key-value pair (direct API)\n    pub fn set(\u0026self, key: String, value: String) -\u003e Result\u003c()\u003e {\n        let mut storage = self.storage.write().map_err(|_| {\n            CoreError::InvalidCapabilityAssignment(\"Storage lock poisoned\".to_string())\n        })?;\n        storage.insert(key, value);\n        Ok(())\n    }\n\n    /// Delete a key (direct API)\n    pub fn delete(\u0026self, key: \u0026str) -\u003e Result\u003cbool\u003e {\n        let mut storage = self.storage.write().map_err(|_| {\n            CoreError::InvalidCapabilityAssignment(\"Storage lock poisoned\".to_string())\n        })?;\n        Ok(storage.remove(key).is_some())\n    }\n\n    /// List keys with a prefix (direct API)\n    pub fn list(\u0026self, prefix: \u0026str) -\u003e Result\u003cVec\u003cString\u003e\u003e {\n        let storage = self.storage.read().map_err(|_| {\n            CoreError::InvalidCapabilityAssignment(\"Storage lock poisoned\".to_string())\n        })?;\n        Ok(storage\n            .keys()\n            .filter(|k| k.starts_with(prefix))\n            .cloned()\n            .collect())\n    }\n\n    /// Check if a key exists (direct API)\n    pub fn exists(\u0026self, key: \u0026str) -\u003e Result\u003cbool\u003e {\n        let storage = self.storage.read().map_err(|_| {\n            CoreError::InvalidCapabilityAssignment(\"Storage lock poisoned\".to_string())\n        })?;\n        Ok(storage.contains_key(key))\n    }\n\n    /// Clear all data (direct API)\n    pub fn clear(\u0026self) -\u003e Result\u003c()\u003e {\n        let mut storage = self.storage.write().map_err(|_| {\n            CoreError::InvalidCapabilityAssignment(\"Storage lock poisoned\".to_string())\n        })?;\n        storage.clear();\n        Ok(())\n    }\n}\n\nimpl CapabilityProvider for KvProvider {\n    fn initialize(\u0026mut self, _config: Value) -\u003e Result\u003c()\u003e {\n        // Clear any existing data on initialization\n        self.clear()\n    }\n\n    fn invoke(\u0026self, _instance_id: \u0026str, operation: \u0026str, params: Value) -\u003e Result\u003cValue\u003e {\n        // For now, we assume the caller has already validated permissions\n        // In a real implementation, we'd look up the capability assignment here\n\n        match operation {\n            \"get\" =\u003e {\n                let key = params[\"key\"].as_str().ok_or_else(|| {\n                    CoreError::InvalidCapabilityAssignment(\"Missing 'key' parameter\".to_string())\n                })?;\n                let value = self.get(key)?;\n                Ok(Value::String(value.unwrap_or_default()))\n            }\n            \"set\" =\u003e {\n                let key = params[\"key\"].as_str().ok_or_else(|| {\n                    CoreError::InvalidCapabilityAssignment(\"Missing 'key' parameter\".to_string())\n                })?;\n                let value = params[\"value\"].as_str().ok_or_else(|| {\n                    CoreError::InvalidCapabilityAssignment(\"Missing 'value' parameter\".to_string())\n                })?;\n                self.set(key.to_string(), value.to_string())?;\n                Ok(Value::Bool(true))\n            }\n            \"delete\" =\u003e {\n                let key = params[\"key\"].as_str().ok_or_else(|| {\n                    CoreError::InvalidCapabilityAssignment(\"Missing 'key' parameter\".to_string())\n                })?;\n                let existed = self.delete(key)?;\n                Ok(Value::Bool(existed))\n            }\n            \"list\" =\u003e {\n                let prefix = params[\"prefix\"].as_str().unwrap_or(\"\");\n                let keys = self.list(prefix)?;\n                let values: Vec\u003cValue\u003e = keys.into_iter().map(Value::String).collect();\n                Ok(Value::Array(values))\n            }\n            \"exists\" =\u003e {\n                let key = params[\"key\"].as_str().ok_or_else(|| {\n                    CoreError::InvalidCapabilityAssignment(\"Missing 'key' parameter\".to_string())\n                })?;\n                let exists = self.exists(key)?;\n                Ok(Value::Bool(exists))\n            }\n            _ =\u003e Err(CoreError::InvalidCapabilityAssignment(format!(\n                \"Unknown operation: {}\",\n                operation\n            ))),\n        }\n    }\n\n    fn shutdown(\u0026mut self) -\u003e Result\u003c()\u003e {\n        self.clear()\n    }\n\n    fn get_metadata(\u0026self) -\u003e ProviderMetadata {\n        self.metadata.clone()\n    }\n}\n\n#[cfg(test)]\nmod tests {\n    use super::*;\n\n    fn create_test_provider() -\u003e KvProvider {\n        KvProvider::new(\"test-kv\".to_string())\n    }\n\n    fn create_test_assignment(permissions: Vec\u003c\u0026str\u003e) -\u003e CapabilityAssignment {\n        CapabilityAssignment::new(\n            \"test-instance\".to_string(),\n            \"test-kv\".to_string(),\n            ProviderType::Kv,\n            permissions.into_iter().map(|s| s.to_string()).collect(),\n        )\n    }\n\n    #[test]\n    fn test_kv_provider_basic_operations() {\n        let provider = create_test_provider();\n\n        // Test set and get\n        provider\n            .set(\"key1\".to_string(), \"value1\".to_string())\n            .unwrap();\n        assert_eq!(provider.get(\"key1\").unwrap(), Some(\"value1\".to_string()));\n\n        // Test update\n        provider\n            .set(\"key1\".to_string(), \"value2\".to_string())\n            .unwrap();\n        assert_eq!(provider.get(\"key1\").unwrap(), Some(\"value2\".to_string()));\n\n        // Test non-existent key\n        assert_eq!(provider.get(\"nonexistent\").unwrap(), None);\n    }\n\n    #[test]\n    fn test_kv_provider_delete() {\n        let provider = create_test_provider();\n\n        provider\n            .set(\"key1\".to_string(), \"value1\".to_string())\n            .unwrap();\n        assert!(provider.exists(\"key1\").unwrap());\n\n        let deleted = provider.delete(\"key1\").unwrap();\n        assert!(deleted);\n        assert!(!provider.exists(\"key1\").unwrap());\n\n        // Deleting non-existent key returns false\n        let deleted = provider.delete(\"nonexistent\").unwrap();\n        assert!(!deleted);\n    }\n\n    #[test]\n    fn test_kv_provider_list() {\n        let provider = create_test_provider();\n\n        provider\n            .set(\"app:config:host\".to_string(), \"localhost\".to_string())\n            .unwrap();\n        provider\n            .set(\"app:config:port\".to_string(), \"8080\".to_string())\n            .unwrap();\n        provider\n            .set(\"app:data:users\".to_string(), \"100\".to_string())\n            .unwrap();\n        provider\n            .set(\"other:key\".to_string(), \"value\".to_string())\n            .unwrap();\n\n        // List all keys with \"app:\" prefix\n        let keys = provider.list(\"app:\").unwrap();\n        assert_eq!(keys.len(), 3);\n        assert!(keys.contains(\u0026\"app:config:host\".to_string()));\n        assert!(keys.contains(\u0026\"app:config:port\".to_string()));\n        assert!(keys.contains(\u0026\"app:data:users\".to_string()));\n\n        // List keys with \"app:config:\" prefix\n        let keys = provider.list(\"app:config:\").unwrap();\n        assert_eq!(keys.len(), 2);\n        assert!(keys.contains(\u0026\"app:config:host\".to_string()));\n        assert!(keys.contains(\u0026\"app:config:port\".to_string()));\n\n        // Empty prefix lists all keys\n        let keys = provider.list(\"\").unwrap();\n        assert_eq!(keys.len(), 4);\n    }\n\n    #[test]\n    fn test_kv_provider_clear() {\n        let provider = create_test_provider();\n\n        provider\n            .set(\"key1\".to_string(), \"value1\".to_string())\n            .unwrap();\n        provider\n            .set(\"key2\".to_string(), \"value2\".to_string())\n            .unwrap();\n        assert_eq!(provider.list(\"\").unwrap().len(), 2);\n\n        provider.clear().unwrap();\n        assert_eq!(provider.list(\"\").unwrap().len(), 0);\n    }\n\n    #[test]\n    fn test_permission_validation() {\n        let provider = create_test_provider();\n\n        // Test read permission\n        let read_assignment = create_test_assignment(vec![\"kv:read\"]);\n        assert!(provider\n            .validate_permission(\u0026read_assignment, \"get\")\n            .is_ok());\n        assert!(provider\n            .validate_permission(\u0026read_assignment, \"list\")\n            .is_ok());\n        assert!(provider\n            .validate_permission(\u0026read_assignment, \"set\")\n            .is_err());\n        assert!(provider\n            .validate_permission(\u0026read_assignment, \"delete\")\n            .is_err());\n\n        // Test write permission\n        let write_assignment = create_test_assignment(vec![\"kv:write\"]);\n        assert!(provider\n            .validate_permission(\u0026write_assignment, \"set\")\n            .is_ok());\n        assert!(provider\n            .validate_permission(\u0026write_assignment, \"get\")\n            .is_err());\n        assert!(provider\n            .validate_permission(\u0026write_assignment, \"delete\")\n            .is_err());\n\n        // Test delete permission\n        let delete_assignment = create_test_assignment(vec![\"kv:delete\"]);\n        assert!(provider\n            .validate_permission(\u0026delete_assignment, \"delete\")\n            .is_ok());\n        assert!(provider\n            .validate_permission(\u0026delete_assignment, \"get\")\n            .is_err());\n        assert!(provider\n            .validate_permission(\u0026delete_assignment, \"set\")\n            .is_err());\n\n        // Test combined permissions\n        let combined_assignment = create_test_assignment(vec![\"kv:read\", \"kv:write\", \"kv:delete\"]);\n        assert!(provider\n            .validate_permission(\u0026combined_assignment, \"get\")\n            .is_ok());\n        assert!(provider\n            .validate_permission(\u0026combined_assignment, \"set\")\n            .is_ok());\n        assert!(provider\n            .validate_permission(\u0026combined_assignment, \"delete\")\n            .is_ok());\n\n        // Test unknown operation\n        assert!(provider\n            .validate_permission(\u0026read_assignment, \"unknown\")\n            .is_err());\n    }\n\n    #[test]\n    fn test_capability_provider_invoke_get() {\n        let provider = create_test_provider();\n        provider\n            .set(\"testkey\".to_string(), \"testvalue\".to_string())\n            .unwrap();\n\n        let params = serde_json::json!({\"key\": \"testkey\"});\n        let result = provider.invoke(\"instance-1\", \"get\", params).unwrap();\n\n        assert_eq!(result, Value::String(\"testvalue\".to_string()));\n    }\n\n    #[test]\n    fn test_capability_provider_invoke_set() {\n        let provider = create_test_provider();\n\n        let params = serde_json::json!({\"key\": \"newkey\", \"value\": \"newvalue\"});\n        let result = provider.invoke(\"instance-1\", \"set\", params).unwrap();\n\n        assert_eq!(result, Value::Bool(true));\n        assert_eq!(\n            provider.get(\"newkey\").unwrap(),\n            Some(\"newvalue\".to_string())\n        );\n    }\n\n    #[test]\n    fn test_capability_provider_invoke_delete() {\n        let provider = create_test_provider();\n        provider\n            .set(\"delete_me\".to_string(), \"value\".to_string())\n            .unwrap();\n\n        let params = serde_json::json!({\"key\": \"delete_me\"});\n        let result = provider.invoke(\"instance-1\", \"delete\", params).unwrap();\n\n        assert_eq!(result, Value::Bool(true));\n        assert!(!provider.exists(\"delete_me\").unwrap());\n\n        // Delete non-existent key\n        let params = serde_json::json!({\"key\": \"nonexistent\"});\n        let result = provider.invoke(\"instance-1\", \"delete\", params).unwrap();\n        assert_eq!(result, Value::Bool(false));\n    }\n\n    #[test]\n    fn test_capability_provider_invoke_list() {\n        let provider = create_test_provider();\n        provider\n            .set(\"prefix:key1\".to_string(), \"value1\".to_string())\n            .unwrap();\n        provider\n            .set(\"prefix:key2\".to_string(), \"value2\".to_string())\n            .unwrap();\n        provider\n            .set(\"other:key\".to_string(), \"value3\".to_string())\n            .unwrap();\n\n        let params = serde_json::json!({\"prefix\": \"prefix:\"});\n        let result = provider.invoke(\"instance-1\", \"list\", params).unwrap();\n\n        if let Value::Array(keys) = result {\n            assert_eq!(keys.len(), 2);\n        } else {\n            panic!(\"Expected array result\");\n        }\n    }\n\n    #[test]\n    fn test_capability_provider_invoke_exists() {\n        let provider = create_test_provider();\n        provider\n            .set(\"existing\".to_string(), \"value\".to_string())\n            .unwrap();\n\n        let params = serde_json::json!({\"key\": \"existing\"});\n        let result = provider.invoke(\"instance-1\", \"exists\", params).unwrap();\n        assert_eq!(result, Value::Bool(true));\n\n        let params = serde_json::json!({\"key\": \"nonexistent\"});\n        let result = provider.invoke(\"instance-1\", \"exists\", params).unwrap();\n        assert_eq!(result, Value::Bool(false));\n    }\n\n    #[test]\n    fn test_capability_provider_missing_params() {\n        let provider = create_test_provider();\n\n        // Missing key parameter for get\n        let result = provider.invoke(\"instance-1\", \"get\", Value::Object(Default::default()));\n        assert!(result.is_err());\n\n        // Missing key parameter for set\n        let params = serde_json::json!({\"value\": \"test\"});\n        let result = provider.invoke(\"instance-1\", \"set\", params);\n        assert!(result.is_err());\n\n        // Missing value parameter for set\n        let params = serde_json::json!({\"key\": \"test\"});\n        let result = provider.invoke(\"instance-1\", \"set\", params);\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_capability_provider_unknown_operation() {\n        let provider = create_test_provider();\n\n        let result = provider.invoke(\"instance-1\", \"unknown_op\", Value::Null);\n        assert!(result.is_err());\n    }\n\n    #[test]\n    fn test_provider_shutdown() {\n        let mut provider = create_test_provider();\n        provider\n            .set(\"key1\".to_string(), \"value1\".to_string())\n            .unwrap();\n        provider\n            .set(\"key2\".to_string(), \"value2\".to_string())\n            .unwrap();\n\n        provider.shutdown().unwrap();\n\n        // All data should be cleared\n        assert_eq!(provider.list(\"\").unwrap().len(), 0);\n    }\n\n    #[test]\n    fn test_provider_metadata() {\n        let provider = create_test_provider();\n        let metadata = provider.get_metadata();\n\n        assert_eq!(metadata.provider_id, \"test-kv\");\n        assert_eq!(metadata.provider_type, ProviderType::Kv);\n        assert_eq!(metadata.version, \"0.1.0\");\n    }\n}\n","traces":[{"line":15,"address":[1308125,1308146,1307728],"length":1,"stats":{"Line":14}},{"line":17,"address":[1307833,1307750],"length":1,"stats":{"Line":28}},{"line":18,"address":[1307981],"length":1,"stats":{"Line":14}},{"line":27,"address":[1306480],"length":1,"stats":{"Line":1}},{"line":33,"address":[1306527],"length":1,"stats":{"Line":1}},{"line":34,"address":[1306685,1306617],"length":1,"stats":{"Line":2}},{"line":35,"address":[1306919,1306648],"length":1,"stats":{"Line":2}},{"line":37,"address":[1306711],"length":1,"stats":{"Line":1}},{"line":44,"address":[1306959],"length":1,"stats":{"Line":1}},{"line":45,"address":[1306983],"length":1,"stats":{"Line":1}},{"line":51,"address":[1307241],"length":1,"stats":{"Line":1}},{"line":55,"address":[1307707,1307701,1307264],"length":1,"stats":{"Line":1}},{"line":56,"address":[1307328,1307468],"length":1,"stats":{"Line":1}},{"line":57,"address":[1312085,1312024],"length":1,"stats":{"Line":0}},{"line":59,"address":[1307598,1307534],"length":1,"stats":{"Line":4}},{"line":63,"address":[1308176,1308708,1308793],"length":1,"stats":{"Line":9}},{"line":64,"address":[1308326,1308426,1308224],"length":1,"stats":{"Line":18}},{"line":65,"address":[1312187,1312248],"length":1,"stats":{"Line":0}},{"line":67,"address":[1308493,1308555],"length":1,"stats":{"Line":10}},{"line":68,"address":[1308676],"length":1,"stats":{"Line":9}},{"line":72,"address":[1309680,1310181,1310187],"length":1,"stats":{"Line":1}},{"line":73,"address":[1309884,1309744],"length":1,"stats":{"Line":1}},{"line":74,"address":[1312792,1312731],"length":1,"stats":{"Line":0}},{"line":76,"address":[1309947,1310019,1310088],"length":1,"stats":{"Line":4}},{"line":80,"address":[1309300,1308832,1309306],"length":1,"stats":{"Line":2}},{"line":81,"address":[1309020,1308880],"length":1,"stats":{"Line":2}},{"line":82,"address":[1312405,1312344],"length":1,"stats":{"Line":0}},{"line":84,"address":[1309086,1309234],"length":1,"stats":{"Line":3}},{"line":85,"address":[1309148],"length":1,"stats":{"Line":2}},{"line":86,"address":[1309176],"length":1,"stats":{"Line":6}},{"line":87,"address":[1309199],"length":1,"stats":{"Line":2}},{"line":88,"address":[1309222],"length":1,"stats":{"Line":2}},{"line":92,"address":[1310595,1310601,1310208],"length":1,"stats":{"Line":1}},{"line":93,"address":[1310412,1310272],"length":1,"stats":{"Line":1}},{"line":94,"address":[1312888,1312949],"length":1,"stats":{"Line":0}},{"line":96,"address":[1310539,1310478],"length":1,"stats":{"Line":2}},{"line":100,"address":[1309660,1309654,1309328],"length":1,"stats":{"Line":1}},{"line":101,"address":[1309366,1309500],"length":1,"stats":{"Line":1}},{"line":102,"address":[1312571,1312632],"length":1,"stats":{"Line":0}},{"line":104,"address":[1309612,1309561],"length":1,"stats":{"Line":2}},{"line":105,"address":[1309624],"length":1,"stats":{"Line":1}},{"line":110,"address":[1302208,1302287],"length":1,"stats":{"Line":0}},{"line":112,"address":[1302229],"length":1,"stats":{"Line":0}},{"line":115,"address":[1304368,1302336,1306421],"length":1,"stats":{"Line":3}},{"line":119,"address":[1302423],"length":1,"stats":{"Line":3}},{"line":120,"address":[1302447,1302540],"length":1,"stats":{"Line":6}},{"line":121,"address":[1306416,1302596,1305720,1305861],"length":1,"stats":{"Line":6}},{"line":122,"address":[1311918],"length":1,"stats":{"Line":1}},{"line":124,"address":[1305934],"length":1,"stats":{"Line":1}},{"line":125,"address":[1306129,1306241],"length":1,"stats":{"Line":2}},{"line":127,"address":[1302640,1302546],"length":1,"stats":{"Line":7}},{"line":128,"address":[1304993,1305707,1302696,1304852],"length":1,"stats":{"Line":5}},{"line":129,"address":[1311630],"length":1,"stats":{"Line":1}},{"line":131,"address":[1305068,1305702,1305245],"length":1,"stats":{"Line":4}},{"line":132,"address":[1311534],"length":1,"stats":{"Line":1}},{"line":134,"address":[1305322,1305675],"length":1,"stats":{"Line":1}},{"line":135,"address":[1305599],"length":1,"stats":{"Line":1}},{"line":137,"address":[1302646,1302740],"length":1,"stats":{"Line":8}},{"line":138,"address":[1311808],"length":1,"stats":{"Line":2}},{"line":139,"address":[1311822],"length":1,"stats":{"Line":0}},{"line":141,"address":[1304834,1304609],"length":1,"stats":{"Line":1}},{"line":142,"address":[1304756],"length":1,"stats":{"Line":1}},{"line":144,"address":[1302840,1302746],"length":1,"stats":{"Line":6}},{"line":145,"address":[1303758,1302896],"length":1,"stats":{"Line":2}},{"line":146,"address":[1303869],"length":1,"stats":{"Line":1}},{"line":147,"address":[1304064,1304184],"length":1,"stats":{"Line":2}},{"line":148,"address":[1304222],"length":1,"stats":{"Line":1}},{"line":150,"address":[1302846,1302940],"length":1,"stats":{"Line":4}},{"line":151,"address":[1303276,1302989,1303429,1303748],"length":1,"stats":{"Line":2}},{"line":152,"address":[1311726],"length":1,"stats":{"Line":0}},{"line":154,"address":[1303727,1303502],"length":1,"stats":{"Line":1}},{"line":155,"address":[1303649],"length":1,"stats":{"Line":1}},{"line":157,"address":[1303026,1302954],"length":1,"stats":{"Line":2}},{"line":164,"address":[1306448],"length":1,"stats":{"Line":1}},{"line":165,"address":[1306465],"length":1,"stats":{"Line":1}},{"line":168,"address":[1302304],"length":1,"stats":{"Line":1}},{"line":169,"address":[1302321],"length":1,"stats":{"Line":1}}],"covered":67,"coverable":77},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-providers","src","lib.rs"],"content":"pub mod kv_provider;\n\nuse wasmatrix_core::{CapabilityAssignment, Result};\n\npub trait CapabilityProvider {\n    fn initialize(\u0026mut self, config: serde_json::Value) -\u003e Result\u003c()\u003e;\n    fn invoke(\n        \u0026self,\n        instance_id: \u0026str,\n        operation: \u0026str,\n        params: serde_json::Value,\n    ) -\u003e Result\u003cserde_json::Value\u003e;\n    fn shutdown(\u0026mut self) -\u003e Result\u003c()\u003e;\n    fn get_metadata(\u0026self) -\u003e ProviderMetadata;\n}\n\n#[derive(Debug, Clone)]\npub struct ProviderMetadata {\n    pub provider_id: String,\n    pub provider_type: wasmatrix_core::ProviderType,\n    pub version: String,\n}\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-runtime","src","capabilities.rs"],"content":"pub struct CapabilityManager;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-runtime","src","lib.rs"],"content":"pub mod runtime;\npub mod capabilities;\npub mod security;\n\npub use runtime::WasmRuntime;\n","traces":[],"covered":0,"coverable":0},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-runtime","src","main.rs"],"content":"use tracing::{info, Level};\nuse tracing_subscriber::FmtSubscriber;\n\nfn main() -\u003e Result\u003c(), Box\u003cdyn std::error::Error\u003e\u003e {\n    let subscriber = FmtSubscriber::builder()\n        .with_max_level(Level::INFO)\n        .finish();\n    tracing::subscriber::set_global_default(subscriber)?;\n\n    info!(\"Starting Wasmatrix Runtime\");\n\n    Ok(())\n}\n","traces":[{"line":4,"address":[1907488],"length":1,"stats":{"Line":0}},{"line":5,"address":[1907495],"length":1,"stats":{"Line":0}},{"line":6,"address":[1907509],"length":1,"stats":{"Line":0}},{"line":8,"address":[1907554],"length":1,"stats":{"Line":0}},{"line":10,"address":[1907615,1908036],"length":1,"stats":{"Line":0}},{"line":12,"address":[1908022],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":6},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-runtime","src","runtime.rs"],"content":"pub struct WasmRuntime;\n\nimpl WasmRuntime {\n    pub fn new() -\u003e Self {\n        Self\n    }\n}\n\nimpl Default for WasmRuntime {\n    fn default() -\u003e Self {\n        Self::new()\n    }\n}\n","traces":[{"line":10,"address":[401744],"length":1,"stats":{"Line":0}},{"line":11,"address":[401745],"length":1,"stats":{"Line":0}}],"covered":0,"coverable":2},{"path":["/","home","mo","repo","wasmatrix","crates","wasmatrix-runtime","src","security.rs"],"content":"pub struct SecurityManager;\n","traces":[],"covered":0,"coverable":0}]};
        var previousData = null;
    </script>
    <script crossorigin>/** @license React v16.13.1
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
'use strict';(function(d,r){"object"===typeof exports&&"undefined"!==typeof module?r(exports):"function"===typeof define&&define.amd?define(["exports"],r):(d=d||self,r(d.React={}))})(this,function(d){function r(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function w(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function da(){}function L(a,b,c){this.props=a;this.context=b;this.refs=ba;this.updater=c||ca}function ea(a,b,c){var g,e={},fa=null,d=null;if(null!=b)for(g in void 0!==b.ref&&(d=b.ref),void 0!==b.key&&(fa=""+b.key),b)ha.call(b,g)&&!ia.hasOwnProperty(g)&&(e[g]=b[g]);var h=arguments.length-2;if(1===h)e.children=c;else if(1<h){for(var k=Array(h),f=0;f<h;f++)k[f]=arguments[f+2];e.children=k}if(a&&a.defaultProps)for(g in h=a.defaultProps,
h)void 0===e[g]&&(e[g]=h[g]);return{$$typeof:x,type:a,key:fa,ref:d,props:e,_owner:M.current}}function va(a,b){return{$$typeof:x,type:a.type,key:b,ref:a.ref,props:a.props,_owner:a._owner}}function N(a){return"object"===typeof a&&null!==a&&a.$$typeof===x}function wa(a){var b={"=":"=0",":":"=2"};return"$"+(""+a).replace(/[=:]/g,function(a){return b[a]})}function ja(a,b,c,g){if(C.length){var e=C.pop();e.result=a;e.keyPrefix=b;e.func=c;e.context=g;e.count=0;return e}return{result:a,keyPrefix:b,func:c,
context:g,count:0}}function ka(a){a.result=null;a.keyPrefix=null;a.func=null;a.context=null;a.count=0;10>C.length&&C.push(a)}function O(a,b,c,g){var e=typeof a;if("undefined"===e||"boolean"===e)a=null;var d=!1;if(null===a)d=!0;else switch(e){case "string":case "number":d=!0;break;case "object":switch(a.$$typeof){case x:case xa:d=!0}}if(d)return c(g,a,""===b?"."+P(a,0):b),1;d=0;b=""===b?".":b+":";if(Array.isArray(a))for(var f=0;f<a.length;f++){e=a[f];var h=b+P(e,f);d+=O(e,h,c,g)}else if(null===a||
"object"!==typeof a?h=null:(h=la&&a[la]||a["@@iterator"],h="function"===typeof h?h:null),"function"===typeof h)for(a=h.call(a),f=0;!(e=a.next()).done;)e=e.value,h=b+P(e,f++),d+=O(e,h,c,g);else if("object"===e)throw c=""+a,Error(r(31,"[object Object]"===c?"object with keys {"+Object.keys(a).join(", ")+"}":c,""));return d}function Q(a,b,c){return null==a?0:O(a,"",b,c)}function P(a,b){return"object"===typeof a&&null!==a&&null!=a.key?wa(a.key):b.toString(36)}function ya(a,b,c){a.func.call(a.context,b,
a.count++)}function za(a,b,c){var g=a.result,e=a.keyPrefix;a=a.func.call(a.context,b,a.count++);Array.isArray(a)?R(a,g,c,function(a){return a}):null!=a&&(N(a)&&(a=va(a,e+(!a.key||b&&b.key===a.key?"":(""+a.key).replace(ma,"$&/")+"/")+c)),g.push(a))}function R(a,b,c,g,e){var d="";null!=c&&(d=(""+c).replace(ma,"$&/")+"/");b=ja(b,d,g,e);Q(a,za,b);ka(b)}function t(){var a=na.current;if(null===a)throw Error(r(321));return a}function S(a,b){var c=a.length;a.push(b);a:for(;;){var g=c-1>>>1,e=a[g];if(void 0!==
e&&0<D(e,b))a[g]=b,a[c]=e,c=g;else break a}}function n(a){a=a[0];return void 0===a?null:a}function E(a){var b=a[0];if(void 0!==b){var c=a.pop();if(c!==b){a[0]=c;a:for(var g=0,e=a.length;g<e;){var d=2*(g+1)-1,f=a[d],h=d+1,k=a[h];if(void 0!==f&&0>D(f,c))void 0!==k&&0>D(k,f)?(a[g]=k,a[h]=c,g=h):(a[g]=f,a[d]=c,g=d);else if(void 0!==k&&0>D(k,c))a[g]=k,a[h]=c,g=h;else break a}}return b}return null}function D(a,b){var c=a.sortIndex-b.sortIndex;return 0!==c?c:a.id-b.id}function F(a){for(var b=n(u);null!==
b;){if(null===b.callback)E(u);else if(b.startTime<=a)E(u),b.sortIndex=b.expirationTime,S(p,b);else break;b=n(u)}}function T(a){y=!1;F(a);if(!v)if(null!==n(p))v=!0,z(U);else{var b=n(u);null!==b&&G(T,b.startTime-a)}}function U(a,b){v=!1;y&&(y=!1,V());H=!0;var c=m;try{F(b);for(l=n(p);null!==l&&(!(l.expirationTime>b)||a&&!W());){var g=l.callback;if(null!==g){l.callback=null;m=l.priorityLevel;var e=g(l.expirationTime<=b);b=q();"function"===typeof e?l.callback=e:l===n(p)&&E(p);F(b)}else E(p);l=n(p)}if(null!==
l)var d=!0;else{var f=n(u);null!==f&&G(T,f.startTime-b);d=!1}return d}finally{l=null,m=c,H=!1}}function oa(a){switch(a){case 1:return-1;case 2:return 250;case 5:return 1073741823;case 4:return 1E4;default:return 5E3}}var f="function"===typeof Symbol&&Symbol.for,x=f?Symbol.for("react.element"):60103,xa=f?Symbol.for("react.portal"):60106,Aa=f?Symbol.for("react.fragment"):60107,Ba=f?Symbol.for("react.strict_mode"):60108,Ca=f?Symbol.for("react.profiler"):60114,Da=f?Symbol.for("react.provider"):60109,
Ea=f?Symbol.for("react.context"):60110,Fa=f?Symbol.for("react.forward_ref"):60112,Ga=f?Symbol.for("react.suspense"):60113,Ha=f?Symbol.for("react.memo"):60115,Ia=f?Symbol.for("react.lazy"):60116,la="function"===typeof Symbol&&Symbol.iterator,pa=Object.getOwnPropertySymbols,Ja=Object.prototype.hasOwnProperty,Ka=Object.prototype.propertyIsEnumerable,I=function(){try{if(!Object.assign)return!1;var a=new String("abc");a[5]="de";if("5"===Object.getOwnPropertyNames(a)[0])return!1;var b={};for(a=0;10>a;a++)b["_"+
String.fromCharCode(a)]=a;if("0123456789"!==Object.getOwnPropertyNames(b).map(function(a){return b[a]}).join(""))return!1;var c={};"abcdefghijklmnopqrst".split("").forEach(function(a){c[a]=a});return"abcdefghijklmnopqrst"!==Object.keys(Object.assign({},c)).join("")?!1:!0}catch(g){return!1}}()?Object.assign:function(a,b){if(null===a||void 0===a)throw new TypeError("Object.assign cannot be called with null or undefined");var c=Object(a);for(var g,e=1;e<arguments.length;e++){var d=Object(arguments[e]);
for(var f in d)Ja.call(d,f)&&(c[f]=d[f]);if(pa){g=pa(d);for(var h=0;h<g.length;h++)Ka.call(d,g[h])&&(c[g[h]]=d[g[h]])}}return c},ca={isMounted:function(a){return!1},enqueueForceUpdate:function(a,b,c){},enqueueReplaceState:function(a,b,c,d){},enqueueSetState:function(a,b,c,d){}},ba={};w.prototype.isReactComponent={};w.prototype.setState=function(a,b){if("object"!==typeof a&&"function"!==typeof a&&null!=a)throw Error(r(85));this.updater.enqueueSetState(this,a,b,"setState")};w.prototype.forceUpdate=
function(a){this.updater.enqueueForceUpdate(this,a,"forceUpdate")};da.prototype=w.prototype;f=L.prototype=new da;f.constructor=L;I(f,w.prototype);f.isPureReactComponent=!0;var M={current:null},ha=Object.prototype.hasOwnProperty,ia={key:!0,ref:!0,__self:!0,__source:!0},ma=/\/+/g,C=[],na={current:null},X;if("undefined"===typeof window||"function"!==typeof MessageChannel){var A=null,qa=null,ra=function(){if(null!==A)try{var a=q();A(!0,a);A=null}catch(b){throw setTimeout(ra,0),b;}},La=Date.now();var q=
function(){return Date.now()-La};var z=function(a){null!==A?setTimeout(z,0,a):(A=a,setTimeout(ra,0))};var G=function(a,b){qa=setTimeout(a,b)};var V=function(){clearTimeout(qa)};var W=function(){return!1};f=X=function(){}}else{var Y=window.performance,sa=window.Date,Ma=window.setTimeout,Na=window.clearTimeout;"undefined"!==typeof console&&(f=window.cancelAnimationFrame,"function"!==typeof window.requestAnimationFrame&&console.error("This browser doesn't support requestAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"),
"function"!==typeof f&&console.error("This browser doesn't support cancelAnimationFrame. Make sure that you load a polyfill in older browsers. https://fb.me/react-polyfills"));if("object"===typeof Y&&"function"===typeof Y.now)q=function(){return Y.now()};else{var Oa=sa.now();q=function(){return sa.now()-Oa}}var J=!1,K=null,Z=-1,ta=5,ua=0;W=function(){return q()>=ua};f=function(){};X=function(a){0>a||125<a?console.error("forceFrameRate takes a positive int between 0 and 125, forcing framerates higher than 125 fps is not unsupported"):
ta=0<a?Math.floor(1E3/a):5};var B=new MessageChannel,aa=B.port2;B.port1.onmessage=function(){if(null!==K){var a=q();ua=a+ta;try{K(!0,a)?aa.postMessage(null):(J=!1,K=null)}catch(b){throw aa.postMessage(null),b;}}else J=!1};z=function(a){K=a;J||(J=!0,aa.postMessage(null))};G=function(a,b){Z=Ma(function(){a(q())},b)};V=function(){Na(Z);Z=-1}}var p=[],u=[],Pa=1,l=null,m=3,H=!1,v=!1,y=!1,Qa=0;B={ReactCurrentDispatcher:na,ReactCurrentOwner:M,IsSomeRendererActing:{current:!1},assign:I};I(B,{Scheduler:{__proto__:null,
unstable_ImmediatePriority:1,unstable_UserBlockingPriority:2,unstable_NormalPriority:3,unstable_IdlePriority:5,unstable_LowPriority:4,unstable_runWithPriority:function(a,b){switch(a){case 1:case 2:case 3:case 4:case 5:break;default:a=3}var c=m;m=a;try{return b()}finally{m=c}},unstable_next:function(a){switch(m){case 1:case 2:case 3:var b=3;break;default:b=m}var c=m;m=b;try{return a()}finally{m=c}},unstable_scheduleCallback:function(a,b,c){var d=q();if("object"===typeof c&&null!==c){var e=c.delay;
e="number"===typeof e&&0<e?d+e:d;c="number"===typeof c.timeout?c.timeout:oa(a)}else c=oa(a),e=d;c=e+c;a={id:Pa++,callback:b,priorityLevel:a,startTime:e,expirationTime:c,sortIndex:-1};e>d?(a.sortIndex=e,S(u,a),null===n(p)&&a===n(u)&&(y?V():y=!0,G(T,e-d))):(a.sortIndex=c,S(p,a),v||H||(v=!0,z(U)));return a},unstable_cancelCallback:function(a){a.callback=null},unstable_wrapCallback:function(a){var b=m;return function(){var c=m;m=b;try{return a.apply(this,arguments)}finally{m=c}}},unstable_getCurrentPriorityLevel:function(){return m},
unstable_shouldYield:function(){var a=q();F(a);var b=n(p);return b!==l&&null!==l&&null!==b&&null!==b.callback&&b.startTime<=a&&b.expirationTime<l.expirationTime||W()},unstable_requestPaint:f,unstable_continueExecution:function(){v||H||(v=!0,z(U))},unstable_pauseExecution:function(){},unstable_getFirstCallbackNode:function(){return n(p)},get unstable_now(){return q},get unstable_forceFrameRate(){return X},unstable_Profiling:null},SchedulerTracing:{__proto__:null,__interactionsRef:null,__subscriberRef:null,
unstable_clear:function(a){return a()},unstable_getCurrent:function(){return null},unstable_getThreadID:function(){return++Qa},unstable_trace:function(a,b,c){return c()},unstable_wrap:function(a){return a},unstable_subscribe:function(a){},unstable_unsubscribe:function(a){}}});d.Children={map:function(a,b,c){if(null==a)return a;var d=[];R(a,d,null,b,c);return d},forEach:function(a,b,c){if(null==a)return a;b=ja(null,null,b,c);Q(a,ya,b);ka(b)},count:function(a){return Q(a,function(){return null},null)},
toArray:function(a){var b=[];R(a,b,null,function(a){return a});return b},only:function(a){if(!N(a))throw Error(r(143));return a}};d.Component=w;d.Fragment=Aa;d.Profiler=Ca;d.PureComponent=L;d.StrictMode=Ba;d.Suspense=Ga;d.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=B;d.cloneElement=function(a,b,c){if(null===a||void 0===a)throw Error(r(267,a));var d=I({},a.props),e=a.key,f=a.ref,m=a._owner;if(null!=b){void 0!==b.ref&&(f=b.ref,m=M.current);void 0!==b.key&&(e=""+b.key);if(a.type&&a.type.defaultProps)var h=
a.type.defaultProps;for(k in b)ha.call(b,k)&&!ia.hasOwnProperty(k)&&(d[k]=void 0===b[k]&&void 0!==h?h[k]:b[k])}var k=arguments.length-2;if(1===k)d.children=c;else if(1<k){h=Array(k);for(var l=0;l<k;l++)h[l]=arguments[l+2];d.children=h}return{$$typeof:x,type:a.type,key:e,ref:f,props:d,_owner:m}};d.createContext=function(a,b){void 0===b&&(b=null);a={$$typeof:Ea,_calculateChangedBits:b,_currentValue:a,_currentValue2:a,_threadCount:0,Provider:null,Consumer:null};a.Provider={$$typeof:Da,_context:a};return a.Consumer=
a};d.createElement=ea;d.createFactory=function(a){var b=ea.bind(null,a);b.type=a;return b};d.createRef=function(){return{current:null}};d.forwardRef=function(a){return{$$typeof:Fa,render:a}};d.isValidElement=N;d.lazy=function(a){return{$$typeof:Ia,_ctor:a,_status:-1,_result:null}};d.memo=function(a,b){return{$$typeof:Ha,type:a,compare:void 0===b?null:b}};d.useCallback=function(a,b){return t().useCallback(a,b)};d.useContext=function(a,b){return t().useContext(a,b)};d.useDebugValue=function(a,b){};
d.useEffect=function(a,b){return t().useEffect(a,b)};d.useImperativeHandle=function(a,b,c){return t().useImperativeHandle(a,b,c)};d.useLayoutEffect=function(a,b){return t().useLayoutEffect(a,b)};d.useMemo=function(a,b){return t().useMemo(a,b)};d.useReducer=function(a,b,c){return t().useReducer(a,b,c)};d.useRef=function(a){return t().useRef(a)};d.useState=function(a){return t().useState(a)};d.version="16.13.1"});
</script>
    <script crossorigin>/** @license React v16.13.1
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */
/*
 Modernizr 3.0.0pre (Custom Build) | MIT
*/
'use strict';(function(I,ea){"object"===typeof exports&&"undefined"!==typeof module?ea(exports,require("react")):"function"===typeof define&&define.amd?define(["exports","react"],ea):(I=I||self,ea(I.ReactDOM={},I.React))})(this,function(I,ea){function k(a){for(var b="https://reactjs.org/docs/error-decoder.html?invariant="+a,c=1;c<arguments.length;c++)b+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+a+"; visit "+b+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}
function ji(a,b,c,d,e,f,g,h,m){yb=!1;gc=null;ki.apply(li,arguments)}function mi(a,b,c,d,e,f,g,h,m){ji.apply(this,arguments);if(yb){if(yb){var n=gc;yb=!1;gc=null}else throw Error(k(198));hc||(hc=!0,pd=n)}}function lf(a,b,c){var d=a.type||"unknown-event";a.currentTarget=mf(c);mi(d,b,void 0,a);a.currentTarget=null}function nf(){if(ic)for(var a in cb){var b=cb[a],c=ic.indexOf(a);if(!(-1<c))throw Error(k(96,a));if(!jc[c]){if(!b.extractEvents)throw Error(k(97,a));jc[c]=b;c=b.eventTypes;for(var d in c){var e=
void 0;var f=c[d],g=b,h=d;if(qd.hasOwnProperty(h))throw Error(k(99,h));qd[h]=f;var m=f.phasedRegistrationNames;if(m){for(e in m)m.hasOwnProperty(e)&&of(m[e],g,h);e=!0}else f.registrationName?(of(f.registrationName,g,h),e=!0):e=!1;if(!e)throw Error(k(98,d,a));}}}}function of(a,b,c){if(db[a])throw Error(k(100,a));db[a]=b;rd[a]=b.eventTypes[c].dependencies}function pf(a){var b=!1,c;for(c in a)if(a.hasOwnProperty(c)){var d=a[c];if(!cb.hasOwnProperty(c)||cb[c]!==d){if(cb[c])throw Error(k(102,c));cb[c]=
d;b=!0}}b&&nf()}function qf(a){if(a=rf(a)){if("function"!==typeof sd)throw Error(k(280));var b=a.stateNode;b&&(b=td(b),sd(a.stateNode,a.type,b))}}function sf(a){eb?fb?fb.push(a):fb=[a]:eb=a}function tf(){if(eb){var a=eb,b=fb;fb=eb=null;qf(a);if(b)for(a=0;a<b.length;a++)qf(b[a])}}function ud(){if(null!==eb||null!==fb)vd(),tf()}function uf(a,b,c){if(wd)return a(b,c);wd=!0;try{return vf(a,b,c)}finally{wd=!1,ud()}}function ni(a){if(wf.call(xf,a))return!0;if(wf.call(yf,a))return!1;if(oi.test(a))return xf[a]=
!0;yf[a]=!0;return!1}function pi(a,b,c,d){if(null!==c&&0===c.type)return!1;switch(typeof b){case "function":case "symbol":return!0;case "boolean":if(d)return!1;if(null!==c)return!c.acceptsBooleans;a=a.toLowerCase().slice(0,5);return"data-"!==a&&"aria-"!==a;default:return!1}}function qi(a,b,c,d){if(null===b||"undefined"===typeof b||pi(a,b,c,d))return!0;if(d)return!1;if(null!==c)switch(c.type){case 3:return!b;case 4:return!1===b;case 5:return isNaN(b);case 6:return isNaN(b)||1>b}return!1}function L(a,
b,c,d,e,f){this.acceptsBooleans=2===b||3===b||4===b;this.attributeName=d;this.attributeNamespace=e;this.mustUseProperty=c;this.propertyName=a;this.type=b;this.sanitizeURL=f}function xd(a,b,c,d){var e=E.hasOwnProperty(b)?E[b]:null;var f=null!==e?0===e.type:d?!1:!(2<b.length)||"o"!==b[0]&&"O"!==b[0]||"n"!==b[1]&&"N"!==b[1]?!1:!0;f||(qi(b,c,e,d)&&(c=null),d||null===e?ni(b)&&(null===c?a.removeAttribute(b):a.setAttribute(b,""+c)):e.mustUseProperty?a[e.propertyName]=null===c?3===e.type?!1:"":c:(b=e.attributeName,
d=e.attributeNamespace,null===c?a.removeAttribute(b):(e=e.type,c=3===e||4===e&&!0===c?"":""+c,d?a.setAttributeNS(d,b,c):a.setAttribute(b,c))))}function zb(a){if(null===a||"object"!==typeof a)return null;a=zf&&a[zf]||a["@@iterator"];return"function"===typeof a?a:null}function ri(a){if(-1===a._status){a._status=0;var b=a._ctor;b=b();a._result=b;b.then(function(b){0===a._status&&(b=b.default,a._status=1,a._result=b)},function(b){0===a._status&&(a._status=2,a._result=b)})}}function na(a){if(null==a)return null;
if("function"===typeof a)return a.displayName||a.name||null;if("string"===typeof a)return a;switch(a){case Ma:return"Fragment";case gb:return"Portal";case kc:return"Profiler";case Af:return"StrictMode";case lc:return"Suspense";case yd:return"SuspenseList"}if("object"===typeof a)switch(a.$$typeof){case Bf:return"Context.Consumer";case Cf:return"Context.Provider";case zd:var b=a.render;b=b.displayName||b.name||"";return a.displayName||(""!==b?"ForwardRef("+b+")":"ForwardRef");case Ad:return na(a.type);
case Df:return na(a.render);case Ef:if(a=1===a._status?a._result:null)return na(a)}return null}function Bd(a){var b="";do{a:switch(a.tag){case 3:case 4:case 6:case 7:case 10:case 9:var c="";break a;default:var d=a._debugOwner,e=a._debugSource,f=na(a.type);c=null;d&&(c=na(d.type));d=f;f="";e?f=" (at "+e.fileName.replace(si,"")+":"+e.lineNumber+")":c&&(f=" (created by "+c+")");c="\n    in "+(d||"Unknown")+f}b+=c;a=a.return}while(a);return b}function va(a){switch(typeof a){case "boolean":case "number":case "object":case "string":case "undefined":return a;
default:return""}}function Ff(a){var b=a.type;return(a=a.nodeName)&&"input"===a.toLowerCase()&&("checkbox"===b||"radio"===b)}function ti(a){var b=Ff(a)?"checked":"value",c=Object.getOwnPropertyDescriptor(a.constructor.prototype,b),d=""+a[b];if(!a.hasOwnProperty(b)&&"undefined"!==typeof c&&"function"===typeof c.get&&"function"===typeof c.set){var e=c.get,f=c.set;Object.defineProperty(a,b,{configurable:!0,get:function(){return e.call(this)},set:function(a){d=""+a;f.call(this,a)}});Object.defineProperty(a,
b,{enumerable:c.enumerable});return{getValue:function(){return d},setValue:function(a){d=""+a},stopTracking:function(){a._valueTracker=null;delete a[b]}}}}function mc(a){a._valueTracker||(a._valueTracker=ti(a))}function Gf(a){if(!a)return!1;var b=a._valueTracker;if(!b)return!0;var c=b.getValue();var d="";a&&(d=Ff(a)?a.checked?"true":"false":a.value);a=d;return a!==c?(b.setValue(a),!0):!1}function Cd(a,b){var c=b.checked;return M({},b,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:null!=
c?c:a._wrapperState.initialChecked})}function Hf(a,b){var c=null==b.defaultValue?"":b.defaultValue,d=null!=b.checked?b.checked:b.defaultChecked;c=va(null!=b.value?b.value:c);a._wrapperState={initialChecked:d,initialValue:c,controlled:"checkbox"===b.type||"radio"===b.type?null!=b.checked:null!=b.value}}function If(a,b){b=b.checked;null!=b&&xd(a,"checked",b,!1)}function Dd(a,b){If(a,b);var c=va(b.value),d=b.type;if(null!=c)if("number"===d){if(0===c&&""===a.value||a.value!=c)a.value=""+c}else a.value!==
""+c&&(a.value=""+c);else if("submit"===d||"reset"===d){a.removeAttribute("value");return}b.hasOwnProperty("value")?Ed(a,b.type,c):b.hasOwnProperty("defaultValue")&&Ed(a,b.type,va(b.defaultValue));null==b.checked&&null!=b.defaultChecked&&(a.defaultChecked=!!b.defaultChecked)}function Jf(a,b,c){if(b.hasOwnProperty("value")||b.hasOwnProperty("defaultValue")){var d=b.type;if(!("submit"!==d&&"reset"!==d||void 0!==b.value&&null!==b.value))return;b=""+a._wrapperState.initialValue;c||b===a.value||(a.value=
b);a.defaultValue=b}c=a.name;""!==c&&(a.name="");a.defaultChecked=!!a._wrapperState.initialChecked;""!==c&&(a.name=c)}function Ed(a,b,c){if("number"!==b||a.ownerDocument.activeElement!==a)null==c?a.defaultValue=""+a._wrapperState.initialValue:a.defaultValue!==""+c&&(a.defaultValue=""+c)}function ui(a){var b="";ea.Children.forEach(a,function(a){null!=a&&(b+=a)});return b}function Fd(a,b){a=M({children:void 0},b);if(b=ui(b.children))a.children=b;return a}function hb(a,b,c,d){a=a.options;if(b){b={};
for(var e=0;e<c.length;e++)b["$"+c[e]]=!0;for(c=0;c<a.length;c++)e=b.hasOwnProperty("$"+a[c].value),a[c].selected!==e&&(a[c].selected=e),e&&d&&(a[c].defaultSelected=!0)}else{c=""+va(c);b=null;for(e=0;e<a.length;e++){if(a[e].value===c){a[e].selected=!0;d&&(a[e].defaultSelected=!0);return}null!==b||a[e].disabled||(b=a[e])}null!==b&&(b.selected=!0)}}function Gd(a,b){if(null!=b.dangerouslySetInnerHTML)throw Error(k(91));return M({},b,{value:void 0,defaultValue:void 0,children:""+a._wrapperState.initialValue})}
function Kf(a,b){var c=b.value;if(null==c){c=b.children;b=b.defaultValue;if(null!=c){if(null!=b)throw Error(k(92));if(Array.isArray(c)){if(!(1>=c.length))throw Error(k(93));c=c[0]}b=c}null==b&&(b="");c=b}a._wrapperState={initialValue:va(c)}}function Lf(a,b){var c=va(b.value),d=va(b.defaultValue);null!=c&&(c=""+c,c!==a.value&&(a.value=c),null==b.defaultValue&&a.defaultValue!==c&&(a.defaultValue=c));null!=d&&(a.defaultValue=""+d)}function Mf(a,b){b=a.textContent;b===a._wrapperState.initialValue&&""!==
b&&null!==b&&(a.value=b)}function Nf(a){switch(a){case "svg":return"http://www.w3.org/2000/svg";case "math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Hd(a,b){return null==a||"http://www.w3.org/1999/xhtml"===a?Nf(b):"http://www.w3.org/2000/svg"===a&&"foreignObject"===b?"http://www.w3.org/1999/xhtml":a}function nc(a,b){var c={};c[a.toLowerCase()]=b.toLowerCase();c["Webkit"+a]="webkit"+b;c["Moz"+a]="moz"+b;return c}function oc(a){if(Id[a])return Id[a];
if(!ib[a])return a;var b=ib[a],c;for(c in b)if(b.hasOwnProperty(c)&&c in Of)return Id[a]=b[c];return a}function Jd(a){var b=Pf.get(a);void 0===b&&(b=new Map,Pf.set(a,b));return b}function Na(a){var b=a,c=a;if(a.alternate)for(;b.return;)b=b.return;else{a=b;do b=a,0!==(b.effectTag&1026)&&(c=b.return),a=b.return;while(a)}return 3===b.tag?c:null}function Qf(a){if(13===a.tag){var b=a.memoizedState;null===b&&(a=a.alternate,null!==a&&(b=a.memoizedState));if(null!==b)return b.dehydrated}return null}function Rf(a){if(Na(a)!==
a)throw Error(k(188));}function vi(a){var b=a.alternate;if(!b){b=Na(a);if(null===b)throw Error(k(188));return b!==a?null:a}for(var c=a,d=b;;){var e=c.return;if(null===e)break;var f=e.alternate;if(null===f){d=e.return;if(null!==d){c=d;continue}break}if(e.child===f.child){for(f=e.child;f;){if(f===c)return Rf(e),a;if(f===d)return Rf(e),b;f=f.sibling}throw Error(k(188));}if(c.return!==d.return)c=e,d=f;else{for(var g=!1,h=e.child;h;){if(h===c){g=!0;c=e;d=f;break}if(h===d){g=!0;d=e;c=f;break}h=h.sibling}if(!g){for(h=
f.child;h;){if(h===c){g=!0;c=f;d=e;break}if(h===d){g=!0;d=f;c=e;break}h=h.sibling}if(!g)throw Error(k(189));}}if(c.alternate!==d)throw Error(k(190));}if(3!==c.tag)throw Error(k(188));return c.stateNode.current===c?a:b}function Sf(a){a=vi(a);if(!a)return null;for(var b=a;;){if(5===b.tag||6===b.tag)return b;if(b.child)b.child.return=b,b=b.child;else{if(b===a)break;for(;!b.sibling;){if(!b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}}return null}function jb(a,b){if(null==
b)throw Error(k(30));if(null==a)return b;if(Array.isArray(a)){if(Array.isArray(b))return a.push.apply(a,b),a;a.push(b);return a}return Array.isArray(b)?[a].concat(b):[a,b]}function Kd(a,b,c){Array.isArray(a)?a.forEach(b,c):a&&b.call(c,a)}function pc(a){null!==a&&(Ab=jb(Ab,a));a=Ab;Ab=null;if(a){Kd(a,wi);if(Ab)throw Error(k(95));if(hc)throw a=pd,hc=!1,pd=null,a;}}function Ld(a){a=a.target||a.srcElement||window;a.correspondingUseElement&&(a=a.correspondingUseElement);return 3===a.nodeType?a.parentNode:
a}function Tf(a){if(!wa)return!1;a="on"+a;var b=a in document;b||(b=document.createElement("div"),b.setAttribute(a,"return;"),b="function"===typeof b[a]);return b}function Uf(a){a.topLevelType=null;a.nativeEvent=null;a.targetInst=null;a.ancestors.length=0;10>qc.length&&qc.push(a)}function Vf(a,b,c,d){if(qc.length){var e=qc.pop();e.topLevelType=a;e.eventSystemFlags=d;e.nativeEvent=b;e.targetInst=c;return e}return{topLevelType:a,eventSystemFlags:d,nativeEvent:b,targetInst:c,ancestors:[]}}function Wf(a){var b=
a.targetInst,c=b;do{if(!c){a.ancestors.push(c);break}var d=c;if(3===d.tag)d=d.stateNode.containerInfo;else{for(;d.return;)d=d.return;d=3!==d.tag?null:d.stateNode.containerInfo}if(!d)break;b=c.tag;5!==b&&6!==b||a.ancestors.push(c);c=Bb(d)}while(c);for(c=0;c<a.ancestors.length;c++){b=a.ancestors[c];var e=Ld(a.nativeEvent);d=a.topLevelType;var f=a.nativeEvent,g=a.eventSystemFlags;0===c&&(g|=64);for(var h=null,m=0;m<jc.length;m++){var n=jc[m];n&&(n=n.extractEvents(d,b,f,e,g))&&(h=jb(h,n))}pc(h)}}function Md(a,
b,c){if(!c.has(a)){switch(a){case "scroll":Cb(b,"scroll",!0);break;case "focus":case "blur":Cb(b,"focus",!0);Cb(b,"blur",!0);c.set("blur",null);c.set("focus",null);break;case "cancel":case "close":Tf(a)&&Cb(b,a,!0);break;case "invalid":case "submit":case "reset":break;default:-1===Db.indexOf(a)&&w(a,b)}c.set(a,null)}}function xi(a,b){var c=Jd(b);Nd.forEach(function(a){Md(a,b,c)});yi.forEach(function(a){Md(a,b,c)})}function Od(a,b,c,d,e){return{blockedOn:a,topLevelType:b,eventSystemFlags:c|32,nativeEvent:e,
container:d}}function Xf(a,b){switch(a){case "focus":case "blur":xa=null;break;case "dragenter":case "dragleave":ya=null;break;case "mouseover":case "mouseout":za=null;break;case "pointerover":case "pointerout":Eb.delete(b.pointerId);break;case "gotpointercapture":case "lostpointercapture":Fb.delete(b.pointerId)}}function Gb(a,b,c,d,e,f){if(null===a||a.nativeEvent!==f)return a=Od(b,c,d,e,f),null!==b&&(b=Hb(b),null!==b&&Yf(b)),a;a.eventSystemFlags|=d;return a}function zi(a,b,c,d,e){switch(b){case "focus":return xa=
Gb(xa,a,b,c,d,e),!0;case "dragenter":return ya=Gb(ya,a,b,c,d,e),!0;case "mouseover":return za=Gb(za,a,b,c,d,e),!0;case "pointerover":var f=e.pointerId;Eb.set(f,Gb(Eb.get(f)||null,a,b,c,d,e));return!0;case "gotpointercapture":return f=e.pointerId,Fb.set(f,Gb(Fb.get(f)||null,a,b,c,d,e)),!0}return!1}function Ai(a){var b=Bb(a.target);if(null!==b){var c=Na(b);if(null!==c)if(b=c.tag,13===b){if(b=Qf(c),null!==b){a.blockedOn=b;Pd(a.priority,function(){Bi(c)});return}}else if(3===b&&c.stateNode.hydrate){a.blockedOn=
3===c.tag?c.stateNode.containerInfo:null;return}}a.blockedOn=null}function rc(a){if(null!==a.blockedOn)return!1;var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);if(null!==b){var c=Hb(b);null!==c&&Yf(c);a.blockedOn=b;return!1}return!0}function Zf(a,b,c){rc(a)&&c.delete(b)}function Ci(){for(Rd=!1;0<fa.length;){var a=fa[0];if(null!==a.blockedOn){a=Hb(a.blockedOn);null!==a&&Di(a);break}var b=Qd(a.topLevelType,a.eventSystemFlags,a.container,a.nativeEvent);null!==b?a.blockedOn=b:fa.shift()}null!==
xa&&rc(xa)&&(xa=null);null!==ya&&rc(ya)&&(ya=null);null!==za&&rc(za)&&(za=null);Eb.forEach(Zf);Fb.forEach(Zf)}function Ib(a,b){a.blockedOn===b&&(a.blockedOn=null,Rd||(Rd=!0,$f(ag,Ci)))}function bg(a){if(0<fa.length){Ib(fa[0],a);for(var b=1;b<fa.length;b++){var c=fa[b];c.blockedOn===a&&(c.blockedOn=null)}}null!==xa&&Ib(xa,a);null!==ya&&Ib(ya,a);null!==za&&Ib(za,a);b=function(b){return Ib(b,a)};Eb.forEach(b);Fb.forEach(b);for(b=0;b<Jb.length;b++)c=Jb[b],c.blockedOn===a&&(c.blockedOn=null);for(;0<Jb.length&&
(b=Jb[0],null===b.blockedOn);)Ai(b),null===b.blockedOn&&Jb.shift()}function Sd(a,b){for(var c=0;c<a.length;c+=2){var d=a[c],e=a[c+1],f="on"+(e[0].toUpperCase()+e.slice(1));f={phasedRegistrationNames:{bubbled:f,captured:f+"Capture"},dependencies:[d],eventPriority:b};Td.set(d,b);cg.set(d,f);dg[e]=f}}function w(a,b){Cb(b,a,!1)}function Cb(a,b,c){var d=Td.get(b);switch(void 0===d?2:d){case 0:d=Ei.bind(null,b,1,a);break;case 1:d=Fi.bind(null,b,1,a);break;default:d=sc.bind(null,b,1,a)}c?a.addEventListener(b,
d,!0):a.addEventListener(b,d,!1)}function Ei(a,b,c,d){Oa||vd();var e=sc,f=Oa;Oa=!0;try{eg(e,a,b,c,d)}finally{(Oa=f)||ud()}}function Fi(a,b,c,d){Gi(Hi,sc.bind(null,a,b,c,d))}function sc(a,b,c,d){if(tc)if(0<fa.length&&-1<Nd.indexOf(a))a=Od(null,a,b,c,d),fa.push(a);else{var e=Qd(a,b,c,d);if(null===e)Xf(a,d);else if(-1<Nd.indexOf(a))a=Od(e,a,b,c,d),fa.push(a);else if(!zi(e,a,b,c,d)){Xf(a,d);a=Vf(a,d,null,b);try{uf(Wf,a)}finally{Uf(a)}}}}function Qd(a,b,c,d){c=Ld(d);c=Bb(c);if(null!==c){var e=Na(c);if(null===
e)c=null;else{var f=e.tag;if(13===f){c=Qf(e);if(null!==c)return c;c=null}else if(3===f){if(e.stateNode.hydrate)return 3===e.tag?e.stateNode.containerInfo:null;c=null}else e!==c&&(c=null)}}a=Vf(a,d,c,b);try{uf(Wf,a)}finally{Uf(a)}return null}function fg(a,b,c){return null==b||"boolean"===typeof b||""===b?"":c||"number"!==typeof b||0===b||Kb.hasOwnProperty(a)&&Kb[a]?(""+b).trim():b+"px"}function gg(a,b){a=a.style;for(var c in b)if(b.hasOwnProperty(c)){var d=0===c.indexOf("--"),e=fg(c,b[c],d);"float"===
c&&(c="cssFloat");d?a.setProperty(c,e):a[c]=e}}function Ud(a,b){if(b){if(Ii[a]&&(null!=b.children||null!=b.dangerouslySetInnerHTML))throw Error(k(137,a,""));if(null!=b.dangerouslySetInnerHTML){if(null!=b.children)throw Error(k(60));if(!("object"===typeof b.dangerouslySetInnerHTML&&"__html"in b.dangerouslySetInnerHTML))throw Error(k(61));}if(null!=b.style&&"object"!==typeof b.style)throw Error(k(62,""));}}function Vd(a,b){if(-1===a.indexOf("-"))return"string"===typeof b.is;switch(a){case "annotation-xml":case "color-profile":case "font-face":case "font-face-src":case "font-face-uri":case "font-face-format":case "font-face-name":case "missing-glyph":return!1;
default:return!0}}function oa(a,b){a=9===a.nodeType||11===a.nodeType?a:a.ownerDocument;var c=Jd(a);b=rd[b];for(var d=0;d<b.length;d++)Md(b[d],a,c)}function uc(){}function Wd(a){a=a||("undefined"!==typeof document?document:void 0);if("undefined"===typeof a)return null;try{return a.activeElement||a.body}catch(b){return a.body}}function hg(a){for(;a&&a.firstChild;)a=a.firstChild;return a}function ig(a,b){var c=hg(a);a=0;for(var d;c;){if(3===c.nodeType){d=a+c.textContent.length;if(a<=b&&d>=b)return{node:c,
offset:b-a};a=d}a:{for(;c;){if(c.nextSibling){c=c.nextSibling;break a}c=c.parentNode}c=void 0}c=hg(c)}}function jg(a,b){return a&&b?a===b?!0:a&&3===a.nodeType?!1:b&&3===b.nodeType?jg(a,b.parentNode):"contains"in a?a.contains(b):a.compareDocumentPosition?!!(a.compareDocumentPosition(b)&16):!1:!1}function kg(){for(var a=window,b=Wd();b instanceof a.HTMLIFrameElement;){try{var c="string"===typeof b.contentWindow.location.href}catch(d){c=!1}if(c)a=b.contentWindow;else break;b=Wd(a.document)}return b}
function Xd(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return b&&("input"===b&&("text"===a.type||"search"===a.type||"tel"===a.type||"url"===a.type||"password"===a.type)||"textarea"===b||"true"===a.contentEditable)}function lg(a,b){switch(a){case "button":case "input":case "select":case "textarea":return!!b.autoFocus}return!1}function Yd(a,b){return"textarea"===a||"option"===a||"noscript"===a||"string"===typeof b.children||"number"===typeof b.children||"object"===typeof b.dangerouslySetInnerHTML&&
null!==b.dangerouslySetInnerHTML&&null!=b.dangerouslySetInnerHTML.__html}function kb(a){for(;null!=a;a=a.nextSibling){var b=a.nodeType;if(1===b||3===b)break}return a}function mg(a){a=a.previousSibling;for(var b=0;a;){if(8===a.nodeType){var c=a.data;if(c===ng||c===Zd||c===$d){if(0===b)return a;b--}else c===og&&b++}a=a.previousSibling}return null}function Bb(a){var b=a[Aa];if(b)return b;for(var c=a.parentNode;c;){if(b=c[Lb]||c[Aa]){c=b.alternate;if(null!==b.child||null!==c&&null!==c.child)for(a=mg(a);null!==
a;){if(c=a[Aa])return c;a=mg(a)}return b}a=c;c=a.parentNode}return null}function Hb(a){a=a[Aa]||a[Lb];return!a||5!==a.tag&&6!==a.tag&&13!==a.tag&&3!==a.tag?null:a}function Pa(a){if(5===a.tag||6===a.tag)return a.stateNode;throw Error(k(33));}function ae(a){return a[vc]||null}function pa(a){do a=a.return;while(a&&5!==a.tag);return a?a:null}function pg(a,b){var c=a.stateNode;if(!c)return null;var d=td(c);if(!d)return null;c=d[b];a:switch(b){case "onClick":case "onClickCapture":case "onDoubleClick":case "onDoubleClickCapture":case "onMouseDown":case "onMouseDownCapture":case "onMouseMove":case "onMouseMoveCapture":case "onMouseUp":case "onMouseUpCapture":case "onMouseEnter":(d=
!d.disabled)||(a=a.type,d=!("button"===a||"input"===a||"select"===a||"textarea"===a));a=!d;break a;default:a=!1}if(a)return null;if(c&&"function"!==typeof c)throw Error(k(231,b,typeof c));return c}function qg(a,b,c){if(b=pg(a,c.dispatchConfig.phasedRegistrationNames[b]))c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a)}function Ji(a){if(a&&a.dispatchConfig.phasedRegistrationNames){for(var b=a._targetInst,c=[];b;)c.push(b),b=pa(b);for(b=c.length;0<b--;)qg(c[b],
"captured",a);for(b=0;b<c.length;b++)qg(c[b],"bubbled",a)}}function be(a,b,c){a&&c&&c.dispatchConfig.registrationName&&(b=pg(a,c.dispatchConfig.registrationName))&&(c._dispatchListeners=jb(c._dispatchListeners,b),c._dispatchInstances=jb(c._dispatchInstances,a))}function Ki(a){a&&a.dispatchConfig.registrationName&&be(a._targetInst,null,a)}function lb(a){Kd(a,Ji)}function rg(){if(wc)return wc;var a,b=ce,c=b.length,d,e="value"in Ba?Ba.value:Ba.textContent,f=e.length;for(a=0;a<c&&b[a]===e[a];a++);var g=
c-a;for(d=1;d<=g&&b[c-d]===e[f-d];d++);return wc=e.slice(a,1<d?1-d:void 0)}function xc(){return!0}function yc(){return!1}function R(a,b,c,d){this.dispatchConfig=a;this._targetInst=b;this.nativeEvent=c;a=this.constructor.Interface;for(var e in a)a.hasOwnProperty(e)&&((b=a[e])?this[e]=b(c):"target"===e?this.target=d:this[e]=c[e]);this.isDefaultPrevented=(null!=c.defaultPrevented?c.defaultPrevented:!1===c.returnValue)?xc:yc;this.isPropagationStopped=yc;return this}function Li(a,b,c,d){if(this.eventPool.length){var e=
this.eventPool.pop();this.call(e,a,b,c,d);return e}return new this(a,b,c,d)}function Mi(a){if(!(a instanceof this))throw Error(k(279));a.destructor();10>this.eventPool.length&&this.eventPool.push(a)}function sg(a){a.eventPool=[];a.getPooled=Li;a.release=Mi}function tg(a,b){switch(a){case "keyup":return-1!==Ni.indexOf(b.keyCode);case "keydown":return 229!==b.keyCode;case "keypress":case "mousedown":case "blur":return!0;default:return!1}}function ug(a){a=a.detail;return"object"===typeof a&&"data"in
a?a.data:null}function Oi(a,b){switch(a){case "compositionend":return ug(b);case "keypress":if(32!==b.which)return null;vg=!0;return wg;case "textInput":return a=b.data,a===wg&&vg?null:a;default:return null}}function Pi(a,b){if(mb)return"compositionend"===a||!de&&tg(a,b)?(a=rg(),wc=ce=Ba=null,mb=!1,a):null;switch(a){case "paste":return null;case "keypress":if(!(b.ctrlKey||b.altKey||b.metaKey)||b.ctrlKey&&b.altKey){if(b.char&&1<b.char.length)return b.char;if(b.which)return String.fromCharCode(b.which)}return null;
case "compositionend":return xg&&"ko"!==b.locale?null:b.data;default:return null}}function yg(a){var b=a&&a.nodeName&&a.nodeName.toLowerCase();return"input"===b?!!Qi[a.type]:"textarea"===b?!0:!1}function zg(a,b,c){a=R.getPooled(Ag.change,a,b,c);a.type="change";sf(c);lb(a);return a}function Ri(a){pc(a)}function zc(a){var b=Pa(a);if(Gf(b))return a}function Si(a,b){if("change"===a)return b}function Bg(){Mb&&(Mb.detachEvent("onpropertychange",Cg),Nb=Mb=null)}function Cg(a){if("value"===a.propertyName&&
zc(Nb))if(a=zg(Nb,a,Ld(a)),Oa)pc(a);else{Oa=!0;try{ee(Ri,a)}finally{Oa=!1,ud()}}}function Ti(a,b,c){"focus"===a?(Bg(),Mb=b,Nb=c,Mb.attachEvent("onpropertychange",Cg)):"blur"===a&&Bg()}function Ui(a,b){if("selectionchange"===a||"keyup"===a||"keydown"===a)return zc(Nb)}function Vi(a,b){if("click"===a)return zc(b)}function Wi(a,b){if("input"===a||"change"===a)return zc(b)}function Xi(a){var b=this.nativeEvent;return b.getModifierState?b.getModifierState(a):(a=Yi[a])?!!b[a]:!1}function fe(a){return Xi}
function Zi(a,b){return a===b&&(0!==a||1/a===1/b)||a!==a&&b!==b}function Ob(a,b){if(Qa(a,b))return!0;if("object"!==typeof a||null===a||"object"!==typeof b||null===b)return!1;var c=Object.keys(a),d=Object.keys(b);if(c.length!==d.length)return!1;for(d=0;d<c.length;d++)if(!$i.call(b,c[d])||!Qa(a[c[d]],b[c[d]]))return!1;return!0}function Dg(a,b){var c=b.window===b?b.document:9===b.nodeType?b:b.ownerDocument;if(ge||null==nb||nb!==Wd(c))return null;c=nb;"selectionStart"in c&&Xd(c)?c={start:c.selectionStart,
end:c.selectionEnd}:(c=(c.ownerDocument&&c.ownerDocument.defaultView||window).getSelection(),c={anchorNode:c.anchorNode,anchorOffset:c.anchorOffset,focusNode:c.focusNode,focusOffset:c.focusOffset});return Pb&&Ob(Pb,c)?null:(Pb=c,a=R.getPooled(Eg.select,he,a,b),a.type="select",a.target=nb,lb(a),a)}function Ac(a){var b=a.keyCode;"charCode"in a?(a=a.charCode,0===a&&13===b&&(a=13)):a=b;10===a&&(a=13);return 32<=a||13===a?a:0}function q(a,b){0>ob||(a.current=ie[ob],ie[ob]=null,ob--)}function y(a,b,c){ob++;
ie[ob]=a.current;a.current=b}function pb(a,b){var c=a.type.contextTypes;if(!c)return Ca;var d=a.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===b)return d.__reactInternalMemoizedMaskedChildContext;var e={},f;for(f in c)e[f]=b[f];d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=b,a.__reactInternalMemoizedMaskedChildContext=e);return e}function N(a){a=a.childContextTypes;return null!==a&&void 0!==a}function Fg(a,b,c){if(B.current!==Ca)throw Error(k(168));y(B,b);y(G,c)}
function Gg(a,b,c){var d=a.stateNode;a=b.childContextTypes;if("function"!==typeof d.getChildContext)return c;d=d.getChildContext();for(var e in d)if(!(e in a))throw Error(k(108,na(b)||"Unknown",e));return M({},c,{},d)}function Bc(a){a=(a=a.stateNode)&&a.__reactInternalMemoizedMergedChildContext||Ca;Ra=B.current;y(B,a);y(G,G.current);return!0}function Hg(a,b,c){var d=a.stateNode;if(!d)throw Error(k(169));c?(a=Gg(a,b,Ra),d.__reactInternalMemoizedMergedChildContext=a,q(G),q(B),y(B,a)):q(G);y(G,c)}function Cc(){switch(aj()){case Dc:return 99;
case Ig:return 98;case Jg:return 97;case Kg:return 96;case Lg:return 95;default:throw Error(k(332));}}function Mg(a){switch(a){case 99:return Dc;case 98:return Ig;case 97:return Jg;case 96:return Kg;case 95:return Lg;default:throw Error(k(332));}}function Da(a,b){a=Mg(a);return bj(a,b)}function Ng(a,b,c){a=Mg(a);return je(a,b,c)}function Og(a){null===qa?(qa=[a],Ec=je(Dc,Pg)):qa.push(a);return Qg}function ha(){if(null!==Ec){var a=Ec;Ec=null;Rg(a)}Pg()}function Pg(){if(!ke&&null!==qa){ke=!0;var a=0;
try{var b=qa;Da(99,function(){for(;a<b.length;a++){var c=b[a];do c=c(!0);while(null!==c)}});qa=null}catch(c){throw null!==qa&&(qa=qa.slice(a+1)),je(Dc,ha),c;}finally{ke=!1}}}function Fc(a,b,c){c/=10;return 1073741821-(((1073741821-a+b/10)/c|0)+1)*c}function aa(a,b){if(a&&a.defaultProps){b=M({},b);a=a.defaultProps;for(var c in a)void 0===b[c]&&(b[c]=a[c])}return b}function le(){Gc=qb=Hc=null}function me(a){var b=Ic.current;q(Ic);a.type._context._currentValue=b}function Sg(a,b){for(;null!==a;){var c=
a.alternate;if(a.childExpirationTime<b)a.childExpirationTime=b,null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);else if(null!==c&&c.childExpirationTime<b)c.childExpirationTime=b;else break;a=a.return}}function rb(a,b){Hc=a;Gc=qb=null;a=a.dependencies;null!==a&&null!==a.firstContext&&(a.expirationTime>=b&&(ia=!0),a.firstContext=null)}function W(a,b){if(Gc!==a&&!1!==b&&0!==b){if("number"!==typeof b||1073741823===b)Gc=a,b=1073741823;b={context:a,observedBits:b,next:null};if(null===qb){if(null===
Hc)throw Error(k(308));qb=b;Hc.dependencies={expirationTime:0,firstContext:b,responders:null}}else qb=qb.next=b}return a._currentValue}function ne(a){a.updateQueue={baseState:a.memoizedState,baseQueue:null,shared:{pending:null},effects:null}}function oe(a,b){a=a.updateQueue;b.updateQueue===a&&(b.updateQueue={baseState:a.baseState,baseQueue:a.baseQueue,shared:a.shared,effects:a.effects})}function Ea(a,b){a={expirationTime:a,suspenseConfig:b,tag:Tg,payload:null,callback:null,next:null};return a.next=
a}function Fa(a,b){a=a.updateQueue;if(null!==a){a=a.shared;var c=a.pending;null===c?b.next=b:(b.next=c.next,c.next=b);a.pending=b}}function Ug(a,b){var c=a.alternate;null!==c&&oe(c,a);a=a.updateQueue;c=a.baseQueue;null===c?(a.baseQueue=b.next=b,b.next=b):(b.next=c.next,c.next=b)}function Qb(a,b,c,d){var e=a.updateQueue;Ga=!1;var f=e.baseQueue,g=e.shared.pending;if(null!==g){if(null!==f){var h=f.next;f.next=g.next;g.next=h}f=g;e.shared.pending=null;h=a.alternate;null!==h&&(h=h.updateQueue,null!==h&&
(h.baseQueue=g))}if(null!==f){h=f.next;var m=e.baseState,n=0,k=null,ba=null,l=null;if(null!==h){var p=h;do{g=p.expirationTime;if(g<d){var t={expirationTime:p.expirationTime,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null};null===l?(ba=l=t,k=m):l=l.next=t;g>n&&(n=g)}else{null!==l&&(l=l.next={expirationTime:1073741823,suspenseConfig:p.suspenseConfig,tag:p.tag,payload:p.payload,callback:p.callback,next:null});Vg(g,p.suspenseConfig);a:{var q=a,r=p;g=b;t=c;switch(r.tag){case 1:q=
r.payload;if("function"===typeof q){m=q.call(t,m,g);break a}m=q;break a;case 3:q.effectTag=q.effectTag&-4097|64;case Tg:q=r.payload;g="function"===typeof q?q.call(t,m,g):q;if(null===g||void 0===g)break a;m=M({},m,g);break a;case Jc:Ga=!0}}null!==p.callback&&(a.effectTag|=32,g=e.effects,null===g?e.effects=[p]:g.push(p))}p=p.next;if(null===p||p===h)if(g=e.shared.pending,null===g)break;else p=f.next=g.next,g.next=h,e.baseQueue=f=g,e.shared.pending=null}while(1)}null===l?k=m:l.next=ba;e.baseState=k;e.baseQueue=
l;Kc(n);a.expirationTime=n;a.memoizedState=m}}function Wg(a,b,c){a=b.effects;b.effects=null;if(null!==a)for(b=0;b<a.length;b++){var d=a[b],e=d.callback;if(null!==e){d.callback=null;d=e;e=c;if("function"!==typeof d)throw Error(k(191,d));d.call(e)}}}function Lc(a,b,c,d){b=a.memoizedState;c=c(d,b);c=null===c||void 0===c?b:M({},b,c);a.memoizedState=c;0===a.expirationTime&&(a.updateQueue.baseState=c)}function Xg(a,b,c,d,e,f,g){a=a.stateNode;return"function"===typeof a.shouldComponentUpdate?a.shouldComponentUpdate(d,
f,g):b.prototype&&b.prototype.isPureReactComponent?!Ob(c,d)||!Ob(e,f):!0}function Yg(a,b,c){var d=!1,e=Ca;var f=b.contextType;"object"===typeof f&&null!==f?f=W(f):(e=N(b)?Ra:B.current,d=b.contextTypes,f=(d=null!==d&&void 0!==d)?pb(a,e):Ca);b=new b(c,f);a.memoizedState=null!==b.state&&void 0!==b.state?b.state:null;b.updater=Mc;a.stateNode=b;b._reactInternalFiber=a;d&&(a=a.stateNode,a.__reactInternalMemoizedUnmaskedChildContext=e,a.__reactInternalMemoizedMaskedChildContext=f);return b}function Zg(a,
b,c,d){a=b.state;"function"===typeof b.componentWillReceiveProps&&b.componentWillReceiveProps(c,d);"function"===typeof b.UNSAFE_componentWillReceiveProps&&b.UNSAFE_componentWillReceiveProps(c,d);b.state!==a&&Mc.enqueueReplaceState(b,b.state,null)}function pe(a,b,c,d){var e=a.stateNode;e.props=c;e.state=a.memoizedState;e.refs=$g;ne(a);var f=b.contextType;"object"===typeof f&&null!==f?e.context=W(f):(f=N(b)?Ra:B.current,e.context=pb(a,f));Qb(a,c,e,d);e.state=a.memoizedState;f=b.getDerivedStateFromProps;
"function"===typeof f&&(Lc(a,b,f,c),e.state=a.memoizedState);"function"===typeof b.getDerivedStateFromProps||"function"===typeof e.getSnapshotBeforeUpdate||"function"!==typeof e.UNSAFE_componentWillMount&&"function"!==typeof e.componentWillMount||(b=e.state,"function"===typeof e.componentWillMount&&e.componentWillMount(),"function"===typeof e.UNSAFE_componentWillMount&&e.UNSAFE_componentWillMount(),b!==e.state&&Mc.enqueueReplaceState(e,e.state,null),Qb(a,c,e,d),e.state=a.memoizedState);"function"===
typeof e.componentDidMount&&(a.effectTag|=4)}function Rb(a,b,c){a=c.ref;if(null!==a&&"function"!==typeof a&&"object"!==typeof a){if(c._owner){c=c._owner;if(c){if(1!==c.tag)throw Error(k(309));var d=c.stateNode}if(!d)throw Error(k(147,a));var e=""+a;if(null!==b&&null!==b.ref&&"function"===typeof b.ref&&b.ref._stringRef===e)return b.ref;b=function(a){var b=d.refs;b===$g&&(b=d.refs={});null===a?delete b[e]:b[e]=a};b._stringRef=e;return b}if("string"!==typeof a)throw Error(k(284));if(!c._owner)throw Error(k(290,
a));}return a}function Nc(a,b){if("textarea"!==a.type)throw Error(k(31,"[object Object]"===Object.prototype.toString.call(b)?"object with keys {"+Object.keys(b).join(", ")+"}":b,""));}function ah(a){function b(b,c){if(a){var d=b.lastEffect;null!==d?(d.nextEffect=c,b.lastEffect=c):b.firstEffect=b.lastEffect=c;c.nextEffect=null;c.effectTag=8}}function c(c,d){if(!a)return null;for(;null!==d;)b(c,d),d=d.sibling;return null}function d(a,b){for(a=new Map;null!==b;)null!==b.key?a.set(b.key,b):a.set(b.index,
b),b=b.sibling;return a}function e(a,b){a=Sa(a,b);a.index=0;a.sibling=null;return a}function f(b,c,d){b.index=d;if(!a)return c;d=b.alternate;if(null!==d)return d=d.index,d<c?(b.effectTag=2,c):d;b.effectTag=2;return c}function g(b){a&&null===b.alternate&&(b.effectTag=2);return b}function h(a,b,c,d){if(null===b||6!==b.tag)return b=qe(c,a.mode,d),b.return=a,b;b=e(b,c);b.return=a;return b}function m(a,b,c,d){if(null!==b&&b.elementType===c.type)return d=e(b,c.props),d.ref=Rb(a,b,c),d.return=a,d;d=Oc(c.type,
c.key,c.props,null,a.mode,d);d.ref=Rb(a,b,c);d.return=a;return d}function n(a,b,c,d){if(null===b||4!==b.tag||b.stateNode.containerInfo!==c.containerInfo||b.stateNode.implementation!==c.implementation)return b=re(c,a.mode,d),b.return=a,b;b=e(b,c.children||[]);b.return=a;return b}function l(a,b,c,d,f){if(null===b||7!==b.tag)return b=Ha(c,a.mode,d,f),b.return=a,b;b=e(b,c);b.return=a;return b}function ba(a,b,c){if("string"===typeof b||"number"===typeof b)return b=qe(""+b,a.mode,c),b.return=a,b;if("object"===
typeof b&&null!==b){switch(b.$$typeof){case Pc:return c=Oc(b.type,b.key,b.props,null,a.mode,c),c.ref=Rb(a,null,b),c.return=a,c;case gb:return b=re(b,a.mode,c),b.return=a,b}if(Qc(b)||zb(b))return b=Ha(b,a.mode,c,null),b.return=a,b;Nc(a,b)}return null}function p(a,b,c,d){var e=null!==b?b.key:null;if("string"===typeof c||"number"===typeof c)return null!==e?null:h(a,b,""+c,d);if("object"===typeof c&&null!==c){switch(c.$$typeof){case Pc:return c.key===e?c.type===Ma?l(a,b,c.props.children,d,e):m(a,b,c,
d):null;case gb:return c.key===e?n(a,b,c,d):null}if(Qc(c)||zb(c))return null!==e?null:l(a,b,c,d,null);Nc(a,c)}return null}function t(a,b,c,d,e){if("string"===typeof d||"number"===typeof d)return a=a.get(c)||null,h(b,a,""+d,e);if("object"===typeof d&&null!==d){switch(d.$$typeof){case Pc:return a=a.get(null===d.key?c:d.key)||null,d.type===Ma?l(b,a,d.props.children,e,d.key):m(b,a,d,e);case gb:return a=a.get(null===d.key?c:d.key)||null,n(b,a,d,e)}if(Qc(d)||zb(d))return a=a.get(c)||null,l(b,a,d,e,null);
Nc(b,d)}return null}function q(e,g,h,m){for(var n=null,k=null,l=g,r=g=0,C=null;null!==l&&r<h.length;r++){l.index>r?(C=l,l=null):C=l.sibling;var O=p(e,l,h[r],m);if(null===O){null===l&&(l=C);break}a&&l&&null===O.alternate&&b(e,l);g=f(O,g,r);null===k?n=O:k.sibling=O;k=O;l=C}if(r===h.length)return c(e,l),n;if(null===l){for(;r<h.length;r++)l=ba(e,h[r],m),null!==l&&(g=f(l,g,r),null===k?n=l:k.sibling=l,k=l);return n}for(l=d(e,l);r<h.length;r++)C=t(l,e,r,h[r],m),null!==C&&(a&&null!==C.alternate&&l.delete(null===
C.key?r:C.key),g=f(C,g,r),null===k?n=C:k.sibling=C,k=C);a&&l.forEach(function(a){return b(e,a)});return n}function w(e,g,h,n){var m=zb(h);if("function"!==typeof m)throw Error(k(150));h=m.call(h);if(null==h)throw Error(k(151));for(var l=m=null,r=g,C=g=0,O=null,v=h.next();null!==r&&!v.done;C++,v=h.next()){r.index>C?(O=r,r=null):O=r.sibling;var q=p(e,r,v.value,n);if(null===q){null===r&&(r=O);break}a&&r&&null===q.alternate&&b(e,r);g=f(q,g,C);null===l?m=q:l.sibling=q;l=q;r=O}if(v.done)return c(e,r),m;
if(null===r){for(;!v.done;C++,v=h.next())v=ba(e,v.value,n),null!==v&&(g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);return m}for(r=d(e,r);!v.done;C++,v=h.next())v=t(r,e,C,v.value,n),null!==v&&(a&&null!==v.alternate&&r.delete(null===v.key?C:v.key),g=f(v,g,C),null===l?m=v:l.sibling=v,l=v);a&&r.forEach(function(a){return b(e,a)});return m}return function(a,d,f,h){var m="object"===typeof f&&null!==f&&f.type===Ma&&null===f.key;m&&(f=f.props.children);var n="object"===typeof f&&null!==f;if(n)switch(f.$$typeof){case Pc:a:{n=
f.key;for(m=d;null!==m;){if(m.key===n){switch(m.tag){case 7:if(f.type===Ma){c(a,m.sibling);d=e(m,f.props.children);d.return=a;a=d;break a}break;default:if(m.elementType===f.type){c(a,m.sibling);d=e(m,f.props);d.ref=Rb(a,m,f);d.return=a;a=d;break a}}c(a,m);break}else b(a,m);m=m.sibling}f.type===Ma?(d=Ha(f.props.children,a.mode,h,f.key),d.return=a,a=d):(h=Oc(f.type,f.key,f.props,null,a.mode,h),h.ref=Rb(a,d,f),h.return=a,a=h)}return g(a);case gb:a:{for(m=f.key;null!==d;){if(d.key===m)if(4===d.tag&&d.stateNode.containerInfo===
f.containerInfo&&d.stateNode.implementation===f.implementation){c(a,d.sibling);d=e(d,f.children||[]);d.return=a;a=d;break a}else{c(a,d);break}else b(a,d);d=d.sibling}d=re(f,a.mode,h);d.return=a;a=d}return g(a)}if("string"===typeof f||"number"===typeof f)return f=""+f,null!==d&&6===d.tag?(c(a,d.sibling),d=e(d,f),d.return=a,a=d):(c(a,d),d=qe(f,a.mode,h),d.return=a,a=d),g(a);if(Qc(f))return q(a,d,f,h);if(zb(f))return w(a,d,f,h);n&&Nc(a,f);if("undefined"===typeof f&&!m)switch(a.tag){case 1:case 0:throw a=
a.type,Error(k(152,a.displayName||a.name||"Component"));}return c(a,d)}}function Ta(a){if(a===Sb)throw Error(k(174));return a}function se(a,b){y(Tb,b);y(Ub,a);y(ja,Sb);a=b.nodeType;switch(a){case 9:case 11:b=(b=b.documentElement)?b.namespaceURI:Hd(null,"");break;default:a=8===a?b.parentNode:b,b=a.namespaceURI||null,a=a.tagName,b=Hd(b,a)}q(ja);y(ja,b)}function tb(a){q(ja);q(Ub);q(Tb)}function bh(a){Ta(Tb.current);var b=Ta(ja.current);var c=Hd(b,a.type);b!==c&&(y(Ub,a),y(ja,c))}function te(a){Ub.current===
a&&(q(ja),q(Ub))}function Rc(a){for(var b=a;null!==b;){if(13===b.tag){var c=b.memoizedState;if(null!==c&&(c=c.dehydrated,null===c||c.data===$d||c.data===Zd))return b}else if(19===b.tag&&void 0!==b.memoizedProps.revealOrder){if(0!==(b.effectTag&64))return b}else if(null!==b.child){b.child.return=b;b=b.child;continue}if(b===a)break;for(;null===b.sibling;){if(null===b.return||b.return===a)return null;b=b.return}b.sibling.return=b.return;b=b.sibling}return null}function ue(a,b){return{responder:a,props:b}}
function S(){throw Error(k(321));}function ve(a,b){if(null===b)return!1;for(var c=0;c<b.length&&c<a.length;c++)if(!Qa(a[c],b[c]))return!1;return!0}function we(a,b,c,d,e,f){Ia=f;z=b;b.memoizedState=null;b.updateQueue=null;b.expirationTime=0;Sc.current=null===a||null===a.memoizedState?dj:ej;a=c(d,e);if(b.expirationTime===Ia){f=0;do{b.expirationTime=0;if(!(25>f))throw Error(k(301));f+=1;J=K=null;b.updateQueue=null;Sc.current=fj;a=c(d,e)}while(b.expirationTime===Ia)}Sc.current=Tc;b=null!==K&&null!==K.next;
Ia=0;J=K=z=null;Uc=!1;if(b)throw Error(k(300));return a}function ub(){var a={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};null===J?z.memoizedState=J=a:J=J.next=a;return J}function vb(){if(null===K){var a=z.alternate;a=null!==a?a.memoizedState:null}else a=K.next;var b=null===J?z.memoizedState:J.next;if(null!==b)J=b,K=a;else{if(null===a)throw Error(k(310));K=a;a={memoizedState:K.memoizedState,baseState:K.baseState,baseQueue:K.baseQueue,queue:K.queue,next:null};null===J?z.memoizedState=
J=a:J=J.next=a}return J}function Ua(a,b){return"function"===typeof b?b(a):b}function Vc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=K,e=d.baseQueue,f=c.pending;if(null!==f){if(null!==e){var g=e.next;e.next=f.next;f.next=g}d.baseQueue=e=f;c.pending=null}if(null!==e){e=e.next;d=d.baseState;var h=g=f=null,m=e;do{var n=m.expirationTime;if(n<Ia){var l={expirationTime:m.expirationTime,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,
next:null};null===h?(g=h=l,f=d):h=h.next=l;n>z.expirationTime&&(z.expirationTime=n,Kc(n))}else null!==h&&(h=h.next={expirationTime:1073741823,suspenseConfig:m.suspenseConfig,action:m.action,eagerReducer:m.eagerReducer,eagerState:m.eagerState,next:null}),Vg(n,m.suspenseConfig),d=m.eagerReducer===a?m.eagerState:a(d,m.action);m=m.next}while(null!==m&&m!==e);null===h?f=d:h.next=g;Qa(d,b.memoizedState)||(ia=!0);b.memoizedState=d;b.baseState=f;b.baseQueue=h;c.lastRenderedState=d}return[b.memoizedState,
c.dispatch]}function Wc(a,b,c){b=vb();c=b.queue;if(null===c)throw Error(k(311));c.lastRenderedReducer=a;var d=c.dispatch,e=c.pending,f=b.memoizedState;if(null!==e){c.pending=null;var g=e=e.next;do f=a(f,g.action),g=g.next;while(g!==e);Qa(f,b.memoizedState)||(ia=!0);b.memoizedState=f;null===b.baseQueue&&(b.baseState=f);c.lastRenderedState=f}return[f,d]}function xe(a){var b=ub();"function"===typeof a&&(a=a());b.memoizedState=b.baseState=a;a=b.queue={pending:null,dispatch:null,lastRenderedReducer:Ua,
lastRenderedState:a};a=a.dispatch=ch.bind(null,z,a);return[b.memoizedState,a]}function ye(a,b,c,d){a={tag:a,create:b,destroy:c,deps:d,next:null};b=z.updateQueue;null===b?(b={lastEffect:null},z.updateQueue=b,b.lastEffect=a.next=a):(c=b.lastEffect,null===c?b.lastEffect=a.next=a:(d=c.next,c.next=a,a.next=d,b.lastEffect=a));return a}function dh(a){return vb().memoizedState}function ze(a,b,c,d){var e=ub();z.effectTag|=a;e.memoizedState=ye(1|b,c,void 0,void 0===d?null:d)}function Ae(a,b,c,d){var e=vb();
d=void 0===d?null:d;var f=void 0;if(null!==K){var g=K.memoizedState;f=g.destroy;if(null!==d&&ve(d,g.deps)){ye(b,c,f,d);return}}z.effectTag|=a;e.memoizedState=ye(1|b,c,f,d)}function eh(a,b){return ze(516,4,a,b)}function Xc(a,b){return Ae(516,4,a,b)}function fh(a,b){return Ae(4,2,a,b)}function gh(a,b){if("function"===typeof b)return a=a(),b(a),function(){b(null)};if(null!==b&&void 0!==b)return a=a(),b.current=a,function(){b.current=null}}function hh(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;
return Ae(4,2,gh.bind(null,b,a),c)}function Be(a,b){}function ih(a,b){ub().memoizedState=[a,void 0===b?null:b];return a}function Yc(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];c.memoizedState=[a,b];return a}function jh(a,b){var c=vb();b=void 0===b?null:b;var d=c.memoizedState;if(null!==d&&null!==b&&ve(b,d[1]))return d[0];a=a();c.memoizedState=[a,b];return a}function Ce(a,b,c){var d=Cc();Da(98>d?98:d,function(){a(!0)});Da(97<d?97:d,function(){var d=
X.suspense;X.suspense=void 0===b?null:b;try{a(!1),c()}finally{X.suspense=d}})}function ch(a,b,c){var d=ka(),e=Vb.suspense;d=Va(d,a,e);e={expirationTime:d,suspenseConfig:e,action:c,eagerReducer:null,eagerState:null,next:null};var f=b.pending;null===f?e.next=e:(e.next=f.next,f.next=e);b.pending=e;f=a.alternate;if(a===z||null!==f&&f===z)Uc=!0,e.expirationTime=Ia,z.expirationTime=Ia;else{if(0===a.expirationTime&&(null===f||0===f.expirationTime)&&(f=b.lastRenderedReducer,null!==f))try{var g=b.lastRenderedState,
h=f(g,c);e.eagerReducer=f;e.eagerState=h;if(Qa(h,g))return}catch(m){}finally{}Ja(a,d)}}function kh(a,b){var c=la(5,null,null,0);c.elementType="DELETED";c.type="DELETED";c.stateNode=b;c.return=a;c.effectTag=8;null!==a.lastEffect?(a.lastEffect.nextEffect=c,a.lastEffect=c):a.firstEffect=a.lastEffect=c}function lh(a,b){switch(a.tag){case 5:var c=a.type;b=1!==b.nodeType||c.toLowerCase()!==b.nodeName.toLowerCase()?null:b;return null!==b?(a.stateNode=b,!0):!1;case 6:return b=""===a.pendingProps||3!==b.nodeType?
null:b,null!==b?(a.stateNode=b,!0):!1;case 13:return!1;default:return!1}}function De(a){if(Wa){var b=Ka;if(b){var c=b;if(!lh(a,b)){b=kb(c.nextSibling);if(!b||!lh(a,b)){a.effectTag=a.effectTag&-1025|2;Wa=!1;ra=a;return}kh(ra,c)}ra=a;Ka=kb(b.firstChild)}else a.effectTag=a.effectTag&-1025|2,Wa=!1,ra=a}}function mh(a){for(a=a.return;null!==a&&5!==a.tag&&3!==a.tag&&13!==a.tag;)a=a.return;ra=a}function Zc(a){if(a!==ra)return!1;if(!Wa)return mh(a),Wa=!0,!1;var b=a.type;if(5!==a.tag||"head"!==b&&"body"!==
b&&!Yd(b,a.memoizedProps))for(b=Ka;b;)kh(a,b),b=kb(b.nextSibling);mh(a);if(13===a.tag){a=a.memoizedState;a=null!==a?a.dehydrated:null;if(!a)throw Error(k(317));a:{a=a.nextSibling;for(b=0;a;){if(8===a.nodeType){var c=a.data;if(c===og){if(0===b){Ka=kb(a.nextSibling);break a}b--}else c!==ng&&c!==Zd&&c!==$d||b++}a=a.nextSibling}Ka=null}}else Ka=ra?kb(a.stateNode.nextSibling):null;return!0}function Ee(){Ka=ra=null;Wa=!1}function T(a,b,c,d){b.child=null===a?Fe(b,null,c,d):wb(b,a.child,c,d)}function nh(a,
b,c,d,e){c=c.render;var f=b.ref;rb(b,e);d=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,d,e);return b.child}function oh(a,b,c,d,e,f){if(null===a){var g=c.type;if("function"===typeof g&&!Ge(g)&&void 0===g.defaultProps&&null===c.compare&&void 0===c.defaultProps)return b.tag=15,b.type=g,ph(a,b,g,d,e,f);a=Oc(c.type,null,d,null,b.mode,f);a.ref=b.ref;a.return=b;return b.child=a}g=a.child;if(e<
f&&(e=g.memoizedProps,c=c.compare,c=null!==c?c:Ob,c(e,d)&&a.ref===b.ref))return sa(a,b,f);b.effectTag|=1;a=Sa(g,d);a.ref=b.ref;a.return=b;return b.child=a}function ph(a,b,c,d,e,f){return null!==a&&Ob(a.memoizedProps,d)&&a.ref===b.ref&&(ia=!1,e<f)?(b.expirationTime=a.expirationTime,sa(a,b,f)):He(a,b,c,d,f)}function qh(a,b){var c=b.ref;if(null===a&&null!==c||null!==a&&a.ref!==c)b.effectTag|=128}function He(a,b,c,d,e){var f=N(c)?Ra:B.current;f=pb(b,f);rb(b,e);c=we(a,b,c,d,f,e);if(null!==a&&!ia)return b.updateQueue=
a.updateQueue,b.effectTag&=-517,a.expirationTime<=e&&(a.expirationTime=0),sa(a,b,e);b.effectTag|=1;T(a,b,c,e);return b.child}function rh(a,b,c,d,e){if(N(c)){var f=!0;Bc(b)}else f=!1;rb(b,e);if(null===b.stateNode)null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),Yg(b,c,d),pe(b,c,d,e),d=!0;else if(null===a){var g=b.stateNode,h=b.memoizedProps;g.props=h;var m=g.context,n=c.contextType;"object"===typeof n&&null!==n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n));var l=c.getDerivedStateFromProps,k="function"===
typeof l||"function"===typeof g.getSnapshotBeforeUpdate;k||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n);Ga=!1;var p=b.memoizedState;g.state=p;Qb(b,d,g,e);m=b.memoizedState;h!==d||p!==m||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),m=b.memoizedState),(h=Ga||Xg(b,c,h,d,p,m,n))?(k||"function"!==typeof g.UNSAFE_componentWillMount&&"function"!==typeof g.componentWillMount||("function"===typeof g.componentWillMount&&
g.componentWillMount(),"function"===typeof g.UNSAFE_componentWillMount&&g.UNSAFE_componentWillMount()),"function"===typeof g.componentDidMount&&(b.effectTag|=4)):("function"===typeof g.componentDidMount&&(b.effectTag|=4),b.memoizedProps=d,b.memoizedState=m),g.props=d,g.state=m,g.context=n,d=h):("function"===typeof g.componentDidMount&&(b.effectTag|=4),d=!1)}else g=b.stateNode,oe(a,b),h=b.memoizedProps,g.props=b.type===b.elementType?h:aa(b.type,h),m=g.context,n=c.contextType,"object"===typeof n&&null!==
n?n=W(n):(n=N(c)?Ra:B.current,n=pb(b,n)),l=c.getDerivedStateFromProps,(k="function"===typeof l||"function"===typeof g.getSnapshotBeforeUpdate)||"function"!==typeof g.UNSAFE_componentWillReceiveProps&&"function"!==typeof g.componentWillReceiveProps||(h!==d||m!==n)&&Zg(b,g,d,n),Ga=!1,m=b.memoizedState,g.state=m,Qb(b,d,g,e),p=b.memoizedState,h!==d||m!==p||G.current||Ga?("function"===typeof l&&(Lc(b,c,l,d),p=b.memoizedState),(l=Ga||Xg(b,c,h,d,m,p,n))?(k||"function"!==typeof g.UNSAFE_componentWillUpdate&&
"function"!==typeof g.componentWillUpdate||("function"===typeof g.componentWillUpdate&&g.componentWillUpdate(d,p,n),"function"===typeof g.UNSAFE_componentWillUpdate&&g.UNSAFE_componentWillUpdate(d,p,n)),"function"===typeof g.componentDidUpdate&&(b.effectTag|=4),"function"===typeof g.getSnapshotBeforeUpdate&&(b.effectTag|=256)):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===
a.memoizedState||(b.effectTag|=256),b.memoizedProps=d,b.memoizedState=p),g.props=d,g.state=p,g.context=n,d=l):("function"!==typeof g.componentDidUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=4),"function"!==typeof g.getSnapshotBeforeUpdate||h===a.memoizedProps&&m===a.memoizedState||(b.effectTag|=256),d=!1);return Ie(a,b,c,d,f,e)}function Ie(a,b,c,d,e,f){qh(a,b);var g=0!==(b.effectTag&64);if(!d&&!g)return e&&Hg(b,c,!1),sa(a,b,f);d=b.stateNode;gj.current=b;var h=g&&"function"!==typeof c.getDerivedStateFromError?
null:d.render();b.effectTag|=1;null!==a&&g?(b.child=wb(b,a.child,null,f),b.child=wb(b,null,h,f)):T(a,b,h,f);b.memoizedState=d.state;e&&Hg(b,c,!0);return b.child}function sh(a){var b=a.stateNode;b.pendingContext?Fg(a,b.pendingContext,b.pendingContext!==b.context):b.context&&Fg(a,b.context,!1);se(a,b.containerInfo)}function th(a,b,c){var d=b.mode,e=b.pendingProps,f=D.current,g=!1,h;(h=0!==(b.effectTag&64))||(h=0!==(f&2)&&(null===a||null!==a.memoizedState));h?(g=!0,b.effectTag&=-65):null!==a&&null===
a.memoizedState||void 0===e.fallback||!0===e.unstable_avoidThisFallback||(f|=1);y(D,f&1);if(null===a){void 0!==e.fallback&&De(b);if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;b.memoizedState=Je;b.child=e;return c}d=e.children;b.memoizedState=null;return b.child=Fe(b,null,d,c)}if(null!==a.memoizedState){a=a.child;d=a.sibling;if(g){e=e.fallback;
c=Sa(a,a.pendingProps);c.return=b;if(0===(b.mode&2)&&(g=null!==b.memoizedState?b.child.child:b.child,g!==a.child))for(c.child=g;null!==g;)g.return=c,g=g.sibling;d=Sa(d,e);d.return=b;c.sibling=d;c.childExpirationTime=0;b.memoizedState=Je;b.child=c;return d}c=wb(b,a.child,e.children,c);b.memoizedState=null;return b.child=c}a=a.child;if(g){g=e.fallback;e=Ha(null,d,0,null);e.return=b;e.child=a;null!==a&&(a.return=e);if(0===(b.mode&2))for(a=null!==b.memoizedState?b.child.child:b.child,e.child=a;null!==
a;)a.return=e,a=a.sibling;c=Ha(g,d,c,null);c.return=b;e.sibling=c;c.effectTag|=2;e.childExpirationTime=0;b.memoizedState=Je;b.child=e;return c}b.memoizedState=null;return b.child=wb(b,a,e.children,c)}function uh(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);Sg(a.return,b)}function Ke(a,b,c,d,e,f){var g=a.memoizedState;null===g?a.memoizedState={isBackwards:b,rendering:null,renderingStartTime:0,last:d,tail:c,tailExpiration:0,tailMode:e,
lastEffect:f}:(g.isBackwards=b,g.rendering=null,g.renderingStartTime=0,g.last=d,g.tail=c,g.tailExpiration=0,g.tailMode=e,g.lastEffect=f)}function vh(a,b,c){var d=b.pendingProps,e=d.revealOrder,f=d.tail;T(a,b,d.children,c);d=D.current;if(0!==(d&2))d=d&1|2,b.effectTag|=64;else{if(null!==a&&0!==(a.effectTag&64))a:for(a=b.child;null!==a;){if(13===a.tag)null!==a.memoizedState&&uh(a,c);else if(19===a.tag)uh(a,c);else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===b)break a;for(;null===a.sibling;){if(null===
a.return||a.return===b)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}d&=1}y(D,d);if(0===(b.mode&2))b.memoizedState=null;else switch(e){case "forwards":c=b.child;for(e=null;null!==c;)a=c.alternate,null!==a&&null===Rc(a)&&(e=c),c=c.sibling;c=e;null===c?(e=b.child,b.child=null):(e=c.sibling,c.sibling=null);Ke(b,!1,e,c,f,b.lastEffect);break;case "backwards":c=null;e=b.child;for(b.child=null;null!==e;){a=e.alternate;if(null!==a&&null===Rc(a)){b.child=e;break}a=e.sibling;e.sibling=c;c=e;e=a}Ke(b,
!0,c,null,f,b.lastEffect);break;case "together":Ke(b,!1,null,null,void 0,b.lastEffect);break;default:b.memoizedState=null}return b.child}function sa(a,b,c){null!==a&&(b.dependencies=a.dependencies);var d=b.expirationTime;0!==d&&Kc(d);if(b.childExpirationTime<c)return null;if(null!==a&&b.child!==a.child)throw Error(k(153));if(null!==b.child){a=b.child;c=Sa(a,a.pendingProps);b.child=c;for(c.return=b;null!==a.sibling;)a=a.sibling,c=c.sibling=Sa(a,a.pendingProps),c.return=b;c.sibling=null}return b.child}
function $c(a,b){switch(a.tailMode){case "hidden":b=a.tail;for(var c=null;null!==b;)null!==b.alternate&&(c=b),b=b.sibling;null===c?a.tail=null:c.sibling=null;break;case "collapsed":c=a.tail;for(var d=null;null!==c;)null!==c.alternate&&(d=c),c=c.sibling;null===d?b||null===a.tail?a.tail=null:a.tail.sibling=null:d.sibling=null}}function hj(a,b,c){var d=b.pendingProps;switch(b.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return null;case 1:return N(b.type)&&(q(G),q(B)),
null;case 3:return tb(),q(G),q(B),c=b.stateNode,c.pendingContext&&(c.context=c.pendingContext,c.pendingContext=null),null!==a&&null!==a.child||!Zc(b)||(b.effectTag|=4),wh(b),null;case 5:te(b);c=Ta(Tb.current);var e=b.type;if(null!==a&&null!=b.stateNode)ij(a,b,e,d,c),a.ref!==b.ref&&(b.effectTag|=128);else{if(!d){if(null===b.stateNode)throw Error(k(166));return null}a=Ta(ja.current);if(Zc(b)){d=b.stateNode;e=b.type;var f=b.memoizedProps;d[Aa]=b;d[vc]=f;switch(e){case "iframe":case "object":case "embed":w("load",
d);break;case "video":case "audio":for(a=0;a<Db.length;a++)w(Db[a],d);break;case "source":w("error",d);break;case "img":case "image":case "link":w("error",d);w("load",d);break;case "form":w("reset",d);w("submit",d);break;case "details":w("toggle",d);break;case "input":Hf(d,f);w("invalid",d);oa(c,"onChange");break;case "select":d._wrapperState={wasMultiple:!!f.multiple};w("invalid",d);oa(c,"onChange");break;case "textarea":Kf(d,f),w("invalid",d),oa(c,"onChange")}Ud(e,f);a=null;for(var g in f)if(f.hasOwnProperty(g)){var h=
f[g];"children"===g?"string"===typeof h?d.textContent!==h&&(a=["children",h]):"number"===typeof h&&d.textContent!==""+h&&(a=["children",""+h]):db.hasOwnProperty(g)&&null!=h&&oa(c,g)}switch(e){case "input":mc(d);Jf(d,f,!0);break;case "textarea":mc(d);Mf(d);break;case "select":case "option":break;default:"function"===typeof f.onClick&&(d.onclick=uc)}c=a;b.updateQueue=c;null!==c&&(b.effectTag|=4)}else{g=9===c.nodeType?c:c.ownerDocument;"http://www.w3.org/1999/xhtml"===a&&(a=Nf(e));"http://www.w3.org/1999/xhtml"===
a?"script"===e?(a=g.createElement("div"),a.innerHTML="<script>\x3c/script>",a=a.removeChild(a.firstChild)):"string"===typeof d.is?a=g.createElement(e,{is:d.is}):(a=g.createElement(e),"select"===e&&(g=a,d.multiple?g.multiple=!0:d.size&&(g.size=d.size))):a=g.createElementNS(a,e);a[Aa]=b;a[vc]=d;jj(a,b,!1,!1);b.stateNode=a;g=Vd(e,d);switch(e){case "iframe":case "object":case "embed":w("load",a);h=d;break;case "video":case "audio":for(h=0;h<Db.length;h++)w(Db[h],a);h=d;break;case "source":w("error",a);
h=d;break;case "img":case "image":case "link":w("error",a);w("load",a);h=d;break;case "form":w("reset",a);w("submit",a);h=d;break;case "details":w("toggle",a);h=d;break;case "input":Hf(a,d);h=Cd(a,d);w("invalid",a);oa(c,"onChange");break;case "option":h=Fd(a,d);break;case "select":a._wrapperState={wasMultiple:!!d.multiple};h=M({},d,{value:void 0});w("invalid",a);oa(c,"onChange");break;case "textarea":Kf(a,d);h=Gd(a,d);w("invalid",a);oa(c,"onChange");break;default:h=d}Ud(e,h);var m=h;for(f in m)if(m.hasOwnProperty(f)){var n=
m[f];"style"===f?gg(a,n):"dangerouslySetInnerHTML"===f?(n=n?n.__html:void 0,null!=n&&xh(a,n)):"children"===f?"string"===typeof n?("textarea"!==e||""!==n)&&Wb(a,n):"number"===typeof n&&Wb(a,""+n):"suppressContentEditableWarning"!==f&&"suppressHydrationWarning"!==f&&"autoFocus"!==f&&(db.hasOwnProperty(f)?null!=n&&oa(c,f):null!=n&&xd(a,f,n,g))}switch(e){case "input":mc(a);Jf(a,d,!1);break;case "textarea":mc(a);Mf(a);break;case "option":null!=d.value&&a.setAttribute("value",""+va(d.value));break;case "select":a.multiple=
!!d.multiple;c=d.value;null!=c?hb(a,!!d.multiple,c,!1):null!=d.defaultValue&&hb(a,!!d.multiple,d.defaultValue,!0);break;default:"function"===typeof h.onClick&&(a.onclick=uc)}lg(e,d)&&(b.effectTag|=4)}null!==b.ref&&(b.effectTag|=128)}return null;case 6:if(a&&null!=b.stateNode)kj(a,b,a.memoizedProps,d);else{if("string"!==typeof d&&null===b.stateNode)throw Error(k(166));c=Ta(Tb.current);Ta(ja.current);Zc(b)?(c=b.stateNode,d=b.memoizedProps,c[Aa]=b,c.nodeValue!==d&&(b.effectTag|=4)):(c=(9===c.nodeType?
c:c.ownerDocument).createTextNode(d),c[Aa]=b,b.stateNode=c)}return null;case 13:q(D);d=b.memoizedState;if(0!==(b.effectTag&64))return b.expirationTime=c,b;c=null!==d;d=!1;null===a?void 0!==b.memoizedProps.fallback&&Zc(b):(e=a.memoizedState,d=null!==e,c||null===e||(e=a.child.sibling,null!==e&&(f=b.firstEffect,null!==f?(b.firstEffect=e,e.nextEffect=f):(b.firstEffect=b.lastEffect=e,e.nextEffect=null),e.effectTag=8)));if(c&&!d&&0!==(b.mode&2))if(null===a&&!0!==b.memoizedProps.unstable_avoidThisFallback||
0!==(D.current&1))F===Xa&&(F=ad);else{if(F===Xa||F===ad)F=bd;0!==Xb&&null!==U&&(Ya(U,P),yh(U,Xb))}if(c||d)b.effectTag|=4;return null;case 4:return tb(),wh(b),null;case 10:return me(b),null;case 17:return N(b.type)&&(q(G),q(B)),null;case 19:q(D);d=b.memoizedState;if(null===d)return null;e=0!==(b.effectTag&64);f=d.rendering;if(null===f)if(e)$c(d,!1);else{if(F!==Xa||null!==a&&0!==(a.effectTag&64))for(f=b.child;null!==f;){a=Rc(f);if(null!==a){b.effectTag|=64;$c(d,!1);e=a.updateQueue;null!==e&&(b.updateQueue=
e,b.effectTag|=4);null===d.lastEffect&&(b.firstEffect=null);b.lastEffect=d.lastEffect;for(d=b.child;null!==d;)e=d,f=c,e.effectTag&=2,e.nextEffect=null,e.firstEffect=null,e.lastEffect=null,a=e.alternate,null===a?(e.childExpirationTime=0,e.expirationTime=f,e.child=null,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null):(e.childExpirationTime=a.childExpirationTime,e.expirationTime=a.expirationTime,e.child=a.child,e.memoizedProps=a.memoizedProps,e.memoizedState=a.memoizedState,
e.updateQueue=a.updateQueue,f=a.dependencies,e.dependencies=null===f?null:{expirationTime:f.expirationTime,firstContext:f.firstContext,responders:f.responders}),d=d.sibling;y(D,D.current&1|2);return b.child}f=f.sibling}}else{if(!e)if(a=Rc(f),null!==a){if(b.effectTag|=64,e=!0,c=a.updateQueue,null!==c&&(b.updateQueue=c,b.effectTag|=4),$c(d,!0),null===d.tail&&"hidden"===d.tailMode&&!f.alternate)return b=b.lastEffect=d.lastEffect,null!==b&&(b.nextEffect=null),null}else 2*Y()-d.renderingStartTime>d.tailExpiration&&
1<c&&(b.effectTag|=64,e=!0,$c(d,!1),b.expirationTime=b.childExpirationTime=c-1);d.isBackwards?(f.sibling=b.child,b.child=f):(c=d.last,null!==c?c.sibling=f:b.child=f,d.last=f)}return null!==d.tail?(0===d.tailExpiration&&(d.tailExpiration=Y()+500),c=d.tail,d.rendering=c,d.tail=c.sibling,d.lastEffect=b.lastEffect,d.renderingStartTime=Y(),c.sibling=null,b=D.current,y(D,e?b&1|2:b&1),c):null}throw Error(k(156,b.tag));}function lj(a,b){switch(a.tag){case 1:return N(a.type)&&(q(G),q(B)),b=a.effectTag,b&4096?
(a.effectTag=b&-4097|64,a):null;case 3:tb();q(G);q(B);b=a.effectTag;if(0!==(b&64))throw Error(k(285));a.effectTag=b&-4097|64;return a;case 5:return te(a),null;case 13:return q(D),b=a.effectTag,b&4096?(a.effectTag=b&-4097|64,a):null;case 19:return q(D),null;case 4:return tb(),null;case 10:return me(a),null;default:return null}}function Le(a,b){return{value:a,source:b,stack:Bd(b)}}function Me(a,b){var c=b.source,d=b.stack;null===d&&null!==c&&(d=Bd(c));null!==c&&na(c.type);b=b.value;null!==a&&1===a.tag&&
na(a.type);try{console.error(b)}catch(e){setTimeout(function(){throw e;})}}function mj(a,b){try{b.props=a.memoizedProps,b.state=a.memoizedState,b.componentWillUnmount()}catch(c){Za(a,c)}}function zh(a){var b=a.ref;if(null!==b)if("function"===typeof b)try{b(null)}catch(c){Za(a,c)}else b.current=null}function nj(a,b){switch(b.tag){case 0:case 11:case 15:case 22:return;case 1:if(b.effectTag&256&&null!==a){var c=a.memoizedProps,d=a.memoizedState;a=b.stateNode;b=a.getSnapshotBeforeUpdate(b.elementType===
b.type?c:aa(b.type,c),d);a.__reactInternalSnapshotBeforeUpdate=b}return;case 3:case 5:case 6:case 4:case 17:return}throw Error(k(163));}function Ah(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.destroy;c.destroy=void 0;void 0!==d&&d()}c=c.next}while(c!==b)}}function Bh(a,b){b=b.updateQueue;b=null!==b?b.lastEffect:null;if(null!==b){var c=b=b.next;do{if((c.tag&a)===a){var d=c.create;c.destroy=d()}c=c.next}while(c!==b)}}function oj(a,b,c,d){switch(c.tag){case 0:case 11:case 15:case 22:Bh(3,
c);return;case 1:a=c.stateNode;c.effectTag&4&&(null===b?a.componentDidMount():(d=c.elementType===c.type?b.memoizedProps:aa(c.type,b.memoizedProps),a.componentDidUpdate(d,b.memoizedState,a.__reactInternalSnapshotBeforeUpdate)));b=c.updateQueue;null!==b&&Wg(c,b,a);return;case 3:b=c.updateQueue;if(null!==b){a=null;if(null!==c.child)switch(c.child.tag){case 5:a=c.child.stateNode;break;case 1:a=c.child.stateNode}Wg(c,b,a)}return;case 5:a=c.stateNode;null===b&&c.effectTag&4&&lg(c.type,c.memoizedProps)&&
a.focus();return;case 6:return;case 4:return;case 12:return;case 13:null===c.memoizedState&&(c=c.alternate,null!==c&&(c=c.memoizedState,null!==c&&(c=c.dehydrated,null!==c&&bg(c))));return;case 19:case 17:case 20:case 21:return}throw Error(k(163));}function Ch(a,b,c){"function"===typeof Ne&&Ne(b);switch(b.tag){case 0:case 11:case 14:case 15:case 22:a=b.updateQueue;if(null!==a&&(a=a.lastEffect,null!==a)){var d=a.next;Da(97<c?97:c,function(){var a=d;do{var c=a.destroy;if(void 0!==c){var g=b;try{c()}catch(h){Za(g,
h)}}a=a.next}while(a!==d)})}break;case 1:zh(b);c=b.stateNode;"function"===typeof c.componentWillUnmount&&mj(b,c);break;case 5:zh(b);break;case 4:Dh(a,b,c)}}function Eh(a){var b=a.alternate;a.return=null;a.child=null;a.memoizedState=null;a.updateQueue=null;a.dependencies=null;a.alternate=null;a.firstEffect=null;a.lastEffect=null;a.pendingProps=null;a.memoizedProps=null;a.stateNode=null;null!==b&&Eh(b)}function Fh(a){return 5===a.tag||3===a.tag||4===a.tag}function Gh(a){a:{for(var b=a.return;null!==
b;){if(Fh(b)){var c=b;break a}b=b.return}throw Error(k(160));}b=c.stateNode;switch(c.tag){case 5:var d=!1;break;case 3:b=b.containerInfo;d=!0;break;case 4:b=b.containerInfo;d=!0;break;default:throw Error(k(161));}c.effectTag&16&&(Wb(b,""),c.effectTag&=-17);a:b:for(c=a;;){for(;null===c.sibling;){if(null===c.return||Fh(c.return)){c=null;break a}c=c.return}c.sibling.return=c.return;for(c=c.sibling;5!==c.tag&&6!==c.tag&&18!==c.tag;){if(c.effectTag&2)continue b;if(null===c.child||4===c.tag)continue b;
else c.child.return=c,c=c.child}if(!(c.effectTag&2)){c=c.stateNode;break a}}d?Oe(a,c,b):Pe(a,c,b)}function Oe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?8===c.nodeType?c.parentNode.insertBefore(a,b):c.insertBefore(a,b):(8===c.nodeType?(b=c.parentNode,b.insertBefore(a,c)):(b=c,b.appendChild(a)),c=c._reactRootContainer,null!==c&&void 0!==c||null!==b.onclick||(b.onclick=uc));else if(4!==d&&(a=a.child,null!==a))for(Oe(a,b,c),a=a.sibling;null!==a;)Oe(a,b,c),a=a.sibling}
function Pe(a,b,c){var d=a.tag,e=5===d||6===d;if(e)a=e?a.stateNode:a.stateNode.instance,b?c.insertBefore(a,b):c.appendChild(a);else if(4!==d&&(a=a.child,null!==a))for(Pe(a,b,c),a=a.sibling;null!==a;)Pe(a,b,c),a=a.sibling}function Dh(a,b,c){for(var d=b,e=!1,f,g;;){if(!e){e=d.return;a:for(;;){if(null===e)throw Error(k(160));f=e.stateNode;switch(e.tag){case 5:g=!1;break a;case 3:f=f.containerInfo;g=!0;break a;case 4:f=f.containerInfo;g=!0;break a}e=e.return}e=!0}if(5===d.tag||6===d.tag){a:for(var h=
a,m=d,n=c,l=m;;)if(Ch(h,l,n),null!==l.child&&4!==l.tag)l.child.return=l,l=l.child;else{if(l===m)break a;for(;null===l.sibling;){if(null===l.return||l.return===m)break a;l=l.return}l.sibling.return=l.return;l=l.sibling}g?(h=f,m=d.stateNode,8===h.nodeType?h.parentNode.removeChild(m):h.removeChild(m)):f.removeChild(d.stateNode)}else if(4===d.tag){if(null!==d.child){f=d.stateNode.containerInfo;g=!0;d.child.return=d;d=d.child;continue}}else if(Ch(a,d,c),null!==d.child){d.child.return=d;d=d.child;continue}if(d===
b)break;for(;null===d.sibling;){if(null===d.return||d.return===b)return;d=d.return;4===d.tag&&(e=!1)}d.sibling.return=d.return;d=d.sibling}}function Qe(a,b){switch(b.tag){case 0:case 11:case 14:case 15:case 22:Ah(3,b);return;case 1:return;case 5:var c=b.stateNode;if(null!=c){var d=b.memoizedProps,e=null!==a?a.memoizedProps:d;a=b.type;var f=b.updateQueue;b.updateQueue=null;if(null!==f){c[vc]=d;"input"===a&&"radio"===d.type&&null!=d.name&&If(c,d);Vd(a,e);b=Vd(a,d);for(e=0;e<f.length;e+=2){var g=f[e],
h=f[e+1];"style"===g?gg(c,h):"dangerouslySetInnerHTML"===g?xh(c,h):"children"===g?Wb(c,h):xd(c,g,h,b)}switch(a){case "input":Dd(c,d);break;case "textarea":Lf(c,d);break;case "select":b=c._wrapperState.wasMultiple,c._wrapperState.wasMultiple=!!d.multiple,a=d.value,null!=a?hb(c,!!d.multiple,a,!1):b!==!!d.multiple&&(null!=d.defaultValue?hb(c,!!d.multiple,d.defaultValue,!0):hb(c,!!d.multiple,d.multiple?[]:"",!1))}}}return;case 6:if(null===b.stateNode)throw Error(k(162));b.stateNode.nodeValue=b.memoizedProps;
return;case 3:b=b.stateNode;b.hydrate&&(b.hydrate=!1,bg(b.containerInfo));return;case 12:return;case 13:c=b;null===b.memoizedState?d=!1:(d=!0,c=b.child,Re=Y());if(null!==c)a:for(a=c;;){if(5===a.tag)f=a.stateNode,d?(f=f.style,"function"===typeof f.setProperty?f.setProperty("display","none","important"):f.display="none"):(f=a.stateNode,e=a.memoizedProps.style,e=void 0!==e&&null!==e&&e.hasOwnProperty("display")?e.display:null,f.style.display=fg("display",e));else if(6===a.tag)a.stateNode.nodeValue=d?
"":a.memoizedProps;else if(13===a.tag&&null!==a.memoizedState&&null===a.memoizedState.dehydrated){f=a.child.sibling;f.return=a;a=f;continue}else if(null!==a.child){a.child.return=a;a=a.child;continue}if(a===c)break;for(;null===a.sibling;){if(null===a.return||a.return===c)break a;a=a.return}a.sibling.return=a.return;a=a.sibling}Hh(b);return;case 19:Hh(b);return;case 17:return}throw Error(k(163));}function Hh(a){var b=a.updateQueue;if(null!==b){a.updateQueue=null;var c=a.stateNode;null===c&&(c=a.stateNode=
new pj);b.forEach(function(b){var d=qj.bind(null,a,b);c.has(b)||(c.add(b),b.then(d,d))})}}function Ih(a,b,c){c=Ea(c,null);c.tag=3;c.payload={element:null};var d=b.value;c.callback=function(){cd||(cd=!0,Se=d);Me(a,b)};return c}function Jh(a,b,c){c=Ea(c,null);c.tag=3;var d=a.type.getDerivedStateFromError;if("function"===typeof d){var e=b.value;c.payload=function(){Me(a,b);return d(e)}}var f=a.stateNode;null!==f&&"function"===typeof f.componentDidCatch&&(c.callback=function(){"function"!==typeof d&&
(null===La?La=new Set([this]):La.add(this),Me(a,b));var c=b.stack;this.componentDidCatch(b.value,{componentStack:null!==c?c:""})});return c}function ka(){return(p&(ca|ma))!==H?1073741821-(Y()/10|0):0!==dd?dd:dd=1073741821-(Y()/10|0)}function Va(a,b,c){b=b.mode;if(0===(b&2))return 1073741823;var d=Cc();if(0===(b&4))return 99===d?1073741823:1073741822;if((p&ca)!==H)return P;if(null!==c)a=Fc(a,c.timeoutMs|0||5E3,250);else switch(d){case 99:a=1073741823;break;case 98:a=Fc(a,150,100);break;case 97:case 96:a=
Fc(a,5E3,250);break;case 95:a=2;break;default:throw Error(k(326));}null!==U&&a===P&&--a;return a}function ed(a,b){a.expirationTime<b&&(a.expirationTime=b);var c=a.alternate;null!==c&&c.expirationTime<b&&(c.expirationTime=b);var d=a.return,e=null;if(null===d&&3===a.tag)e=a.stateNode;else for(;null!==d;){c=d.alternate;d.childExpirationTime<b&&(d.childExpirationTime=b);null!==c&&c.childExpirationTime<b&&(c.childExpirationTime=b);if(null===d.return&&3===d.tag){e=d.stateNode;break}d=d.return}null!==e&&
(U===e&&(Kc(b),F===bd&&Ya(e,P)),yh(e,b));return e}function fd(a){var b=a.lastExpiredTime;if(0!==b)return b;b=a.firstPendingTime;if(!Kh(a,b))return b;var c=a.lastPingedTime;a=a.nextKnownPendingLevel;a=c>a?c:a;return 2>=a&&b!==a?0:a}function V(a){if(0!==a.lastExpiredTime)a.callbackExpirationTime=1073741823,a.callbackPriority=99,a.callbackNode=Og(Te.bind(null,a));else{var b=fd(a),c=a.callbackNode;if(0===b)null!==c&&(a.callbackNode=null,a.callbackExpirationTime=0,a.callbackPriority=90);else{var d=ka();
1073741823===b?d=99:1===b||2===b?d=95:(d=10*(1073741821-b)-10*(1073741821-d),d=0>=d?99:250>=d?98:5250>=d?97:95);if(null!==c){var e=a.callbackPriority;if(a.callbackExpirationTime===b&&e>=d)return;c!==Qg&&Rg(c)}a.callbackExpirationTime=b;a.callbackPriority=d;b=1073741823===b?Og(Te.bind(null,a)):Ng(d,Lh.bind(null,a),{timeout:10*(1073741821-b)-Y()});a.callbackNode=b}}}function Lh(a,b){dd=0;if(b)return b=ka(),Ue(a,b),V(a),null;var c=fd(a);if(0!==c){b=a.callbackNode;if((p&(ca|ma))!==H)throw Error(k(327));
xb();a===U&&c===P||$a(a,c);if(null!==t){var d=p;p|=ca;var e=Mh();do try{rj();break}catch(h){Nh(a,h)}while(1);le();p=d;gd.current=e;if(F===hd)throw b=id,$a(a,c),Ya(a,c),V(a),b;if(null===t)switch(e=a.finishedWork=a.current.alternate,a.finishedExpirationTime=c,d=F,U=null,d){case Xa:case hd:throw Error(k(345));case Oh:Ue(a,2<c?2:c);break;case ad:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(1073741823===ta&&(e=Re+Ph-Y(),10<e)){if(jd){var f=a.lastPingedTime;if(0===f||f>=c){a.lastPingedTime=
c;$a(a,c);break}}f=fd(a);if(0!==f&&f!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}a.timeoutHandle=We(ab.bind(null,a),e);break}ab(a);break;case bd:Ya(a,c);d=a.lastSuspendedTime;c===d&&(a.nextKnownPendingLevel=Ve(e));if(jd&&(e=a.lastPingedTime,0===e||e>=c)){a.lastPingedTime=c;$a(a,c);break}e=fd(a);if(0!==e&&e!==c)break;if(0!==d&&d!==c){a.lastPingedTime=d;break}1073741823!==Yb?d=10*(1073741821-Yb)-Y():1073741823===ta?d=0:(d=10*(1073741821-ta)-5E3,e=Y(),c=10*(1073741821-c)-e,d=e-d,0>d&&(d=0),d=
(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3E3>d?3E3:4320>d?4320:1960*sj(d/1960))-d,c<d&&(d=c));if(10<d){a.timeoutHandle=We(ab.bind(null,a),d);break}ab(a);break;case Xe:if(1073741823!==ta&&null!==kd){f=ta;var g=kd;d=g.busyMinDurationMs|0;0>=d?d=0:(e=g.busyDelayMs|0,f=Y()-(10*(1073741821-f)-(g.timeoutMs|0||5E3)),d=f<=e?0:e+d-f);if(10<d){Ya(a,c);a.timeoutHandle=We(ab.bind(null,a),d);break}}ab(a);break;default:throw Error(k(329));}V(a);if(a.callbackNode===b)return Lh.bind(null,a)}}return null}function Te(a){var b=
a.lastExpiredTime;b=0!==b?b:1073741823;if((p&(ca|ma))!==H)throw Error(k(327));xb();a===U&&b===P||$a(a,b);if(null!==t){var c=p;p|=ca;var d=Mh();do try{tj();break}catch(e){Nh(a,e)}while(1);le();p=c;gd.current=d;if(F===hd)throw c=id,$a(a,b),Ya(a,b),V(a),c;if(null!==t)throw Error(k(261));a.finishedWork=a.current.alternate;a.finishedExpirationTime=b;U=null;ab(a);V(a)}return null}function uj(){if(null!==bb){var a=bb;bb=null;a.forEach(function(a,c){Ue(c,a);V(c)});ha()}}function Qh(a,b){var c=p;p|=1;try{return a(b)}finally{p=
c,p===H&&ha()}}function Rh(a,b){var c=p;p&=-2;p|=Ye;try{return a(b)}finally{p=c,p===H&&ha()}}function $a(a,b){a.finishedWork=null;a.finishedExpirationTime=0;var c=a.timeoutHandle;-1!==c&&(a.timeoutHandle=-1,vj(c));if(null!==t)for(c=t.return;null!==c;){var d=c;switch(d.tag){case 1:d=d.type.childContextTypes;null!==d&&void 0!==d&&(q(G),q(B));break;case 3:tb();q(G);q(B);break;case 5:te(d);break;case 4:tb();break;case 13:q(D);break;case 19:q(D);break;case 10:me(d)}c=c.return}U=a;t=Sa(a.current,null);
P=b;F=Xa;id=null;Yb=ta=1073741823;kd=null;Xb=0;jd=!1}function Nh(a,b){do{try{le();Sc.current=Tc;if(Uc)for(var c=z.memoizedState;null!==c;){var d=c.queue;null!==d&&(d.pending=null);c=c.next}Ia=0;J=K=z=null;Uc=!1;if(null===t||null===t.return)return F=hd,id=b,t=null;a:{var e=a,f=t.return,g=t,h=b;b=P;g.effectTag|=2048;g.firstEffect=g.lastEffect=null;if(null!==h&&"object"===typeof h&&"function"===typeof h.then){var m=h;if(0===(g.mode&2)){var n=g.alternate;n?(g.updateQueue=n.updateQueue,g.memoizedState=
n.memoizedState,g.expirationTime=n.expirationTime):(g.updateQueue=null,g.memoizedState=null)}var l=0!==(D.current&1),k=f;do{var p;if(p=13===k.tag){var q=k.memoizedState;if(null!==q)p=null!==q.dehydrated?!0:!1;else{var w=k.memoizedProps;p=void 0===w.fallback?!1:!0!==w.unstable_avoidThisFallback?!0:l?!1:!0}}if(p){var y=k.updateQueue;if(null===y){var r=new Set;r.add(m);k.updateQueue=r}else y.add(m);if(0===(k.mode&2)){k.effectTag|=64;g.effectTag&=-2981;if(1===g.tag)if(null===g.alternate)g.tag=17;else{var O=
Ea(1073741823,null);O.tag=Jc;Fa(g,O)}g.expirationTime=1073741823;break a}h=void 0;g=b;var v=e.pingCache;null===v?(v=e.pingCache=new wj,h=new Set,v.set(m,h)):(h=v.get(m),void 0===h&&(h=new Set,v.set(m,h)));if(!h.has(g)){h.add(g);var x=xj.bind(null,e,m,g);m.then(x,x)}k.effectTag|=4096;k.expirationTime=b;break a}k=k.return}while(null!==k);h=Error((na(g.type)||"A React component")+" suspended while rendering, but no fallback UI was specified.\n\nAdd a <Suspense fallback=...> component higher in the tree to provide a loading indicator or placeholder to display."+
Bd(g))}F!==Xe&&(F=Oh);h=Le(h,g);k=f;do{switch(k.tag){case 3:m=h;k.effectTag|=4096;k.expirationTime=b;var A=Ih(k,m,b);Ug(k,A);break a;case 1:m=h;var u=k.type,B=k.stateNode;if(0===(k.effectTag&64)&&("function"===typeof u.getDerivedStateFromError||null!==B&&"function"===typeof B.componentDidCatch&&(null===La||!La.has(B)))){k.effectTag|=4096;k.expirationTime=b;var H=Jh(k,m,b);Ug(k,H);break a}}k=k.return}while(null!==k)}t=Sh(t)}catch(cj){b=cj;continue}break}while(1)}function Mh(a){a=gd.current;gd.current=
Tc;return null===a?Tc:a}function Vg(a,b){a<ta&&2<a&&(ta=a);null!==b&&a<Yb&&2<a&&(Yb=a,kd=b)}function Kc(a){a>Xb&&(Xb=a)}function tj(){for(;null!==t;)t=Th(t)}function rj(){for(;null!==t&&!yj();)t=Th(t)}function Th(a){var b=zj(a.alternate,a,P);a.memoizedProps=a.pendingProps;null===b&&(b=Sh(a));Uh.current=null;return b}function Sh(a){t=a;do{var b=t.alternate;a=t.return;if(0===(t.effectTag&2048)){b=hj(b,t,P);if(1===P||1!==t.childExpirationTime){for(var c=0,d=t.child;null!==d;){var e=d.expirationTime,
f=d.childExpirationTime;e>c&&(c=e);f>c&&(c=f);d=d.sibling}t.childExpirationTime=c}if(null!==b)return b;null!==a&&0===(a.effectTag&2048)&&(null===a.firstEffect&&(a.firstEffect=t.firstEffect),null!==t.lastEffect&&(null!==a.lastEffect&&(a.lastEffect.nextEffect=t.firstEffect),a.lastEffect=t.lastEffect),1<t.effectTag&&(null!==a.lastEffect?a.lastEffect.nextEffect=t:a.firstEffect=t,a.lastEffect=t))}else{b=lj(t);if(null!==b)return b.effectTag&=2047,b;null!==a&&(a.firstEffect=a.lastEffect=null,a.effectTag|=
2048)}b=t.sibling;if(null!==b)return b;t=a}while(null!==t);F===Xa&&(F=Xe);return null}function Ve(a){var b=a.expirationTime;a=a.childExpirationTime;return b>a?b:a}function ab(a){var b=Cc();Da(99,Aj.bind(null,a,b));return null}function Aj(a,b){do xb();while(null!==Zb);if((p&(ca|ma))!==H)throw Error(k(327));var c=a.finishedWork,d=a.finishedExpirationTime;if(null===c)return null;a.finishedWork=null;a.finishedExpirationTime=0;if(c===a.current)throw Error(k(177));a.callbackNode=null;a.callbackExpirationTime=
0;a.callbackPriority=90;a.nextKnownPendingLevel=0;var e=Ve(c);a.firstPendingTime=e;d<=a.lastSuspendedTime?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:d<=a.firstSuspendedTime&&(a.firstSuspendedTime=d-1);d<=a.lastPingedTime&&(a.lastPingedTime=0);d<=a.lastExpiredTime&&(a.lastExpiredTime=0);a===U&&(t=U=null,P=0);1<c.effectTag?null!==c.lastEffect?(c.lastEffect.nextEffect=c,e=c.firstEffect):e=c:e=c.firstEffect;if(null!==e){var f=p;p|=ma;Uh.current=null;Ze=tc;var g=kg();if(Xd(g)){if("selectionStart"in
g)var h={start:g.selectionStart,end:g.selectionEnd};else a:{h=(h=g.ownerDocument)&&h.defaultView||window;var m=h.getSelection&&h.getSelection();if(m&&0!==m.rangeCount){h=m.anchorNode;var n=m.anchorOffset,q=m.focusNode;m=m.focusOffset;try{h.nodeType,q.nodeType}catch(sb){h=null;break a}var ba=0,w=-1,y=-1,B=0,D=0,r=g,z=null;b:for(;;){for(var v;;){r!==h||0!==n&&3!==r.nodeType||(w=ba+n);r!==q||0!==m&&3!==r.nodeType||(y=ba+m);3===r.nodeType&&(ba+=r.nodeValue.length);if(null===(v=r.firstChild))break;z=r;
r=v}for(;;){if(r===g)break b;z===h&&++B===n&&(w=ba);z===q&&++D===m&&(y=ba);if(null!==(v=r.nextSibling))break;r=z;z=r.parentNode}r=v}h=-1===w||-1===y?null:{start:w,end:y}}else h=null}h=h||{start:0,end:0}}else h=null;$e={activeElementDetached:null,focusedElem:g,selectionRange:h};tc=!1;l=e;do try{Bj()}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=e;do try{for(g=a,h=b;null!==l;){var x=l.effectTag;x&16&&Wb(l.stateNode,"");if(x&128){var A=l.alternate;if(null!==A){var u=
A.ref;null!==u&&("function"===typeof u?u(null):u.current=null)}}switch(x&1038){case 2:Gh(l);l.effectTag&=-3;break;case 6:Gh(l);l.effectTag&=-3;Qe(l.alternate,l);break;case 1024:l.effectTag&=-1025;break;case 1028:l.effectTag&=-1025;Qe(l.alternate,l);break;case 4:Qe(l.alternate,l);break;case 8:n=l,Dh(g,n,h),Eh(n)}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);u=$e;A=kg();x=u.focusedElem;h=u.selectionRange;if(A!==x&&x&&x.ownerDocument&&jg(x.ownerDocument.documentElement,
x)){null!==h&&Xd(x)&&(A=h.start,u=h.end,void 0===u&&(u=A),"selectionStart"in x?(x.selectionStart=A,x.selectionEnd=Math.min(u,x.value.length)):(u=(A=x.ownerDocument||document)&&A.defaultView||window,u.getSelection&&(u=u.getSelection(),n=x.textContent.length,g=Math.min(h.start,n),h=void 0===h.end?g:Math.min(h.end,n),!u.extend&&g>h&&(n=h,h=g,g=n),n=ig(x,g),q=ig(x,h),n&&q&&(1!==u.rangeCount||u.anchorNode!==n.node||u.anchorOffset!==n.offset||u.focusNode!==q.node||u.focusOffset!==q.offset)&&(A=A.createRange(),
A.setStart(n.node,n.offset),u.removeAllRanges(),g>h?(u.addRange(A),u.extend(q.node,q.offset)):(A.setEnd(q.node,q.offset),u.addRange(A))))));A=[];for(u=x;u=u.parentNode;)1===u.nodeType&&A.push({element:u,left:u.scrollLeft,top:u.scrollTop});"function"===typeof x.focus&&x.focus();for(x=0;x<A.length;x++)u=A[x],u.element.scrollLeft=u.left,u.element.scrollTop=u.top}tc=!!Ze;$e=Ze=null;a.current=c;l=e;do try{for(x=a;null!==l;){var F=l.effectTag;F&36&&oj(x,l.alternate,l);if(F&128){A=void 0;var E=l.ref;if(null!==
E){var G=l.stateNode;switch(l.tag){case 5:A=G;break;default:A=G}"function"===typeof E?E(A):E.current=A}}l=l.nextEffect}}catch(sb){if(null===l)throw Error(k(330));Za(l,sb);l=l.nextEffect}while(null!==l);l=null;Cj();p=f}else a.current=c;if(ld)ld=!1,Zb=a,$b=b;else for(l=e;null!==l;)b=l.nextEffect,l.nextEffect=null,l=b;b=a.firstPendingTime;0===b&&(La=null);1073741823===b?a===af?ac++:(ac=0,af=a):ac=0;"function"===typeof bf&&bf(c.stateNode,d);V(a);if(cd)throw cd=!1,a=Se,Se=null,a;if((p&Ye)!==H)return null;
ha();return null}function Bj(){for(;null!==l;){var a=l.effectTag;0!==(a&256)&&nj(l.alternate,l);0===(a&512)||ld||(ld=!0,Ng(97,function(){xb();return null}));l=l.nextEffect}}function xb(){if(90!==$b){var a=97<$b?97:$b;$b=90;return Da(a,Dj)}}function Dj(){if(null===Zb)return!1;var a=Zb;Zb=null;if((p&(ca|ma))!==H)throw Error(k(331));var b=p;p|=ma;for(a=a.current.firstEffect;null!==a;){try{var c=a;if(0!==(c.effectTag&512))switch(c.tag){case 0:case 11:case 15:case 22:Ah(5,c),Bh(5,c)}}catch(d){if(null===
a)throw Error(k(330));Za(a,d)}c=a.nextEffect;a.nextEffect=null;a=c}p=b;ha();return!0}function Vh(a,b,c){b=Le(c,b);b=Ih(a,b,1073741823);Fa(a,b);a=ed(a,1073741823);null!==a&&V(a)}function Za(a,b){if(3===a.tag)Vh(a,a,b);else for(var c=a.return;null!==c;){if(3===c.tag){Vh(c,a,b);break}else if(1===c.tag){var d=c.stateNode;if("function"===typeof c.type.getDerivedStateFromError||"function"===typeof d.componentDidCatch&&(null===La||!La.has(d))){a=Le(b,a);a=Jh(c,a,1073741823);Fa(c,a);c=ed(c,1073741823);null!==
c&&V(c);break}}c=c.return}}function xj(a,b,c){var d=a.pingCache;null!==d&&d.delete(b);U===a&&P===c?F===bd||F===ad&&1073741823===ta&&Y()-Re<Ph?$a(a,P):jd=!0:Kh(a,c)&&(b=a.lastPingedTime,0!==b&&b<c||(a.lastPingedTime=c,V(a)))}function qj(a,b){var c=a.stateNode;null!==c&&c.delete(b);b=0;0===b&&(b=ka(),b=Va(b,a,null));a=ed(a,b);null!==a&&V(a)}function Ej(a){if("undefined"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__)return!1;var b=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(b.isDisabled||!b.supportsFiber)return!0;try{var c=
b.inject(a);bf=function(a,e){try{b.onCommitFiberRoot(c,a,void 0,64===(a.current.effectTag&64))}catch(f){}};Ne=function(a){try{b.onCommitFiberUnmount(c,a)}catch(e){}}}catch(d){}return!0}function Fj(a,b,c,d){this.tag=a;this.key=c;this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null;this.index=0;this.ref=null;this.pendingProps=b;this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null;this.mode=d;this.effectTag=0;this.lastEffect=this.firstEffect=this.nextEffect=
null;this.childExpirationTime=this.expirationTime=0;this.alternate=null}function Ge(a){a=a.prototype;return!(!a||!a.isReactComponent)}function Gj(a){if("function"===typeof a)return Ge(a)?1:0;if(void 0!==a&&null!==a){a=a.$$typeof;if(a===zd)return 11;if(a===Ad)return 14}return 2}function Sa(a,b){var c=a.alternate;null===c?(c=la(a.tag,b,a.key,a.mode),c.elementType=a.elementType,c.type=a.type,c.stateNode=a.stateNode,c.alternate=a,a.alternate=c):(c.pendingProps=b,c.effectTag=0,c.nextEffect=null,c.firstEffect=
null,c.lastEffect=null);c.childExpirationTime=a.childExpirationTime;c.expirationTime=a.expirationTime;c.child=a.child;c.memoizedProps=a.memoizedProps;c.memoizedState=a.memoizedState;c.updateQueue=a.updateQueue;b=a.dependencies;c.dependencies=null===b?null:{expirationTime:b.expirationTime,firstContext:b.firstContext,responders:b.responders};c.sibling=a.sibling;c.index=a.index;c.ref=a.ref;return c}function Oc(a,b,c,d,e,f){var g=2;d=a;if("function"===typeof a)Ge(a)&&(g=1);else if("string"===typeof a)g=
5;else a:switch(a){case Ma:return Ha(c.children,e,f,b);case Hj:g=8;e|=7;break;case Af:g=8;e|=1;break;case kc:return a=la(12,c,b,e|8),a.elementType=kc,a.type=kc,a.expirationTime=f,a;case lc:return a=la(13,c,b,e),a.type=lc,a.elementType=lc,a.expirationTime=f,a;case yd:return a=la(19,c,b,e),a.elementType=yd,a.expirationTime=f,a;default:if("object"===typeof a&&null!==a)switch(a.$$typeof){case Cf:g=10;break a;case Bf:g=9;break a;case zd:g=11;break a;case Ad:g=14;break a;case Ef:g=16;d=null;break a;case Df:g=
22;break a}throw Error(k(130,null==a?a:typeof a,""));}b=la(g,c,b,e);b.elementType=a;b.type=d;b.expirationTime=f;return b}function Ha(a,b,c,d){a=la(7,a,d,b);a.expirationTime=c;return a}function qe(a,b,c){a=la(6,a,null,b);a.expirationTime=c;return a}function re(a,b,c){b=la(4,null!==a.children?a.children:[],a.key,b);b.expirationTime=c;b.stateNode={containerInfo:a.containerInfo,pendingChildren:null,implementation:a.implementation};return b}function Ij(a,b,c){this.tag=b;this.current=null;this.containerInfo=
a;this.pingCache=this.pendingChildren=null;this.finishedExpirationTime=0;this.finishedWork=null;this.timeoutHandle=-1;this.pendingContext=this.context=null;this.hydrate=c;this.callbackNode=null;this.callbackPriority=90;this.lastExpiredTime=this.lastPingedTime=this.nextKnownPendingLevel=this.lastSuspendedTime=this.firstSuspendedTime=this.firstPendingTime=0}function Kh(a,b){var c=a.firstSuspendedTime;a=a.lastSuspendedTime;return 0!==c&&c>=b&&a<=b}function Ya(a,b){var c=a.firstSuspendedTime,d=a.lastSuspendedTime;
c<b&&(a.firstSuspendedTime=b);if(d>b||0===c)a.lastSuspendedTime=b;b<=a.lastPingedTime&&(a.lastPingedTime=0);b<=a.lastExpiredTime&&(a.lastExpiredTime=0)}function yh(a,b){b>a.firstPendingTime&&(a.firstPendingTime=b);var c=a.firstSuspendedTime;0!==c&&(b>=c?a.firstSuspendedTime=a.lastSuspendedTime=a.nextKnownPendingLevel=0:b>=a.lastSuspendedTime&&(a.lastSuspendedTime=b+1),b>a.nextKnownPendingLevel&&(a.nextKnownPendingLevel=b))}function Ue(a,b){var c=a.lastExpiredTime;if(0===c||c>b)a.lastExpiredTime=b}
function md(a,b,c,d){var e=b.current,f=ka(),g=Vb.suspense;f=Va(f,e,g);a:if(c){c=c._reactInternalFiber;b:{if(Na(c)!==c||1!==c.tag)throw Error(k(170));var h=c;do{switch(h.tag){case 3:h=h.stateNode.context;break b;case 1:if(N(h.type)){h=h.stateNode.__reactInternalMemoizedMergedChildContext;break b}}h=h.return}while(null!==h);throw Error(k(171));}if(1===c.tag){var m=c.type;if(N(m)){c=Gg(c,m,h);break a}}c=h}else c=Ca;null===b.context?b.context=c:b.pendingContext=c;b=Ea(f,g);b.payload={element:a};d=void 0===
d?null:d;null!==d&&(b.callback=d);Fa(e,b);Ja(e,f);return f}function cf(a){a=a.current;if(!a.child)return null;switch(a.child.tag){case 5:return a.child.stateNode;default:return a.child.stateNode}}function Wh(a,b){a=a.memoizedState;null!==a&&null!==a.dehydrated&&a.retryTime<b&&(a.retryTime=b)}function df(a,b){Wh(a,b);(a=a.alternate)&&Wh(a,b)}function ef(a,b,c){c=null!=c&&!0===c.hydrate;var d=new Ij(a,b,c),e=la(3,null,null,2===b?7:1===b?3:0);d.current=e;e.stateNode=d;ne(e);a[Lb]=d.current;c&&0!==b&&
xi(a,9===a.nodeType?a:a.ownerDocument);this._internalRoot=d}function bc(a){return!(!a||1!==a.nodeType&&9!==a.nodeType&&11!==a.nodeType&&(8!==a.nodeType||" react-mount-point-unstable "!==a.nodeValue))}function Jj(a,b){b||(b=a?9===a.nodeType?a.documentElement:a.firstChild:null,b=!(!b||1!==b.nodeType||!b.hasAttribute("data-reactroot")));if(!b)for(var c;c=a.lastChild;)a.removeChild(c);return new ef(a,0,b?{hydrate:!0}:void 0)}function nd(a,b,c,d,e){var f=c._reactRootContainer;if(f){var g=f._internalRoot;
if("function"===typeof e){var h=e;e=function(){var a=cf(g);h.call(a)}}md(b,g,a,e)}else{f=c._reactRootContainer=Jj(c,d);g=f._internalRoot;if("function"===typeof e){var m=e;e=function(){var a=cf(g);m.call(a)}}Rh(function(){md(b,g,a,e)})}return cf(g)}function Kj(a,b,c){var d=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:gb,key:null==d?null:""+d,children:a,containerInfo:b,implementation:c}}function Xh(a,b){var c=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;
if(!bc(b))throw Error(k(200));return Kj(a,b,null,c)}if(!ea)throw Error(k(227));var ki=function(a,b,c,d,e,f,g,h,m){var n=Array.prototype.slice.call(arguments,3);try{b.apply(c,n)}catch(C){this.onError(C)}},yb=!1,gc=null,hc=!1,pd=null,li={onError:function(a){yb=!0;gc=a}},td=null,rf=null,mf=null,ic=null,cb={},jc=[],qd={},db={},rd={},wa=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),M=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.assign,
sd=null,eb=null,fb=null,ee=function(a,b){return a(b)},eg=function(a,b,c,d,e){return a(b,c,d,e)},vd=function(){},vf=ee,Oa=!1,wd=!1,Z=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.Scheduler,Lj=Z.unstable_cancelCallback,ff=Z.unstable_now,$f=Z.unstable_scheduleCallback,Mj=Z.unstable_shouldYield,Yh=Z.unstable_requestPaint,Pd=Z.unstable_runWithPriority,Nj=Z.unstable_getCurrentPriorityLevel,Oj=Z.unstable_ImmediatePriority,Zh=Z.unstable_UserBlockingPriority,ag=Z.unstable_NormalPriority,Pj=Z.unstable_LowPriority,
Qj=Z.unstable_IdlePriority,oi=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,wf=Object.prototype.hasOwnProperty,yf={},xf={},E={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(a){E[a]=
new L(a,0,!1,a,null,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(a){var b=a[0];E[b]=new L(b,1,!1,a[1],null,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(a){E[a]=new L(a,2,!1,a.toLowerCase(),null,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(a){E[a]=new L(a,2,!1,a,null,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(a){E[a]=
new L(a,3,!1,a.toLowerCase(),null,!1)});["checked","multiple","muted","selected"].forEach(function(a){E[a]=new L(a,3,!0,a,null,!1)});["capture","download"].forEach(function(a){E[a]=new L(a,4,!1,a,null,!1)});["cols","rows","size","span"].forEach(function(a){E[a]=new L(a,6,!1,a,null,!1)});["rowSpan","start"].forEach(function(a){E[a]=new L(a,5,!1,a.toLowerCase(),null,!1)});var gf=/[\-:]([a-z])/g,hf=function(a){return a[1].toUpperCase()};"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(a){var b=
a.replace(gf,hf);E[b]=new L(b,1,!1,a,null,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/1999/xlink",!1)});["xml:base","xml:lang","xml:space"].forEach(function(a){var b=a.replace(gf,hf);E[b]=new L(b,1,!1,a,"http://www.w3.org/XML/1998/namespace",!1)});["tabIndex","crossOrigin"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!1)});E.xlinkHref=new L("xlinkHref",1,
!1,"xlink:href","http://www.w3.org/1999/xlink",!0);["src","href","action","formAction"].forEach(function(a){E[a]=new L(a,1,!1,a.toLowerCase(),null,!0)});var da=ea.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;da.hasOwnProperty("ReactCurrentDispatcher")||(da.ReactCurrentDispatcher={current:null});da.hasOwnProperty("ReactCurrentBatchConfig")||(da.ReactCurrentBatchConfig={suspense:null});var si=/^(.*)[\\\/]/,Q="function"===typeof Symbol&&Symbol.for,Pc=Q?Symbol.for("react.element"):60103,gb=Q?Symbol.for("react.portal"):
60106,Ma=Q?Symbol.for("react.fragment"):60107,Af=Q?Symbol.for("react.strict_mode"):60108,kc=Q?Symbol.for("react.profiler"):60114,Cf=Q?Symbol.for("react.provider"):60109,Bf=Q?Symbol.for("react.context"):60110,Hj=Q?Symbol.for("react.concurrent_mode"):60111,zd=Q?Symbol.for("react.forward_ref"):60112,lc=Q?Symbol.for("react.suspense"):60113,yd=Q?Symbol.for("react.suspense_list"):60120,Ad=Q?Symbol.for("react.memo"):60115,Ef=Q?Symbol.for("react.lazy"):60116,Df=Q?Symbol.for("react.block"):60121,zf="function"===
typeof Symbol&&Symbol.iterator,od,xh=function(a){return"undefined"!==typeof MSApp&&MSApp.execUnsafeLocalFunction?function(b,c,d,e){MSApp.execUnsafeLocalFunction(function(){return a(b,c,d,e)})}:a}(function(a,b){if("http://www.w3.org/2000/svg"!==a.namespaceURI||"innerHTML"in a)a.innerHTML=b;else{od=od||document.createElement("div");od.innerHTML="<svg>"+b.valueOf().toString()+"</svg>";for(b=od.firstChild;a.firstChild;)a.removeChild(a.firstChild);for(;b.firstChild;)a.appendChild(b.firstChild)}}),Wb=function(a,
b){if(b){var c=a.firstChild;if(c&&c===a.lastChild&&3===c.nodeType){c.nodeValue=b;return}}a.textContent=b},ib={animationend:nc("Animation","AnimationEnd"),animationiteration:nc("Animation","AnimationIteration"),animationstart:nc("Animation","AnimationStart"),transitionend:nc("Transition","TransitionEnd")},Id={},Of={};wa&&(Of=document.createElement("div").style,"AnimationEvent"in window||(delete ib.animationend.animation,delete ib.animationiteration.animation,delete ib.animationstart.animation),"TransitionEvent"in
window||delete ib.transitionend.transition);var $h=oc("animationend"),ai=oc("animationiteration"),bi=oc("animationstart"),ci=oc("transitionend"),Db="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Pf=new ("function"===typeof WeakMap?WeakMap:Map),Ab=null,wi=function(a){if(a){var b=a._dispatchListeners,c=a._dispatchInstances;
if(Array.isArray(b))for(var d=0;d<b.length&&!a.isPropagationStopped();d++)lf(a,b[d],c[d]);else b&&lf(a,b,c);a._dispatchListeners=null;a._dispatchInstances=null;a.isPersistent()||a.constructor.release(a)}},qc=[],Rd=!1,fa=[],xa=null,ya=null,za=null,Eb=new Map,Fb=new Map,Jb=[],Nd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput close cancel copy cut paste click change contextmenu reset submit".split(" "),
yi="focus blur dragenter dragleave mouseover mouseout pointerover pointerout gotpointercapture lostpointercapture".split(" "),dg={},cg=new Map,Td=new Map,Rj=["abort","abort",$h,"animationEnd",ai,"animationIteration",bi,"animationStart","canplay","canPlay","canplaythrough","canPlayThrough","durationchange","durationChange","emptied","emptied","encrypted","encrypted","ended","ended","error","error","gotpointercapture","gotPointerCapture","load","load","loadeddata","loadedData","loadedmetadata","loadedMetadata",
"loadstart","loadStart","lostpointercapture","lostPointerCapture","playing","playing","progress","progress","seeking","seeking","stalled","stalled","suspend","suspend","timeupdate","timeUpdate",ci,"transitionEnd","waiting","waiting"];Sd("blur blur cancel cancel click click close close contextmenu contextMenu copy copy cut cut auxclick auxClick dblclick doubleClick dragend dragEnd dragstart dragStart drop drop focus focus input input invalid invalid keydown keyDown keypress keyPress keyup keyUp mousedown mouseDown mouseup mouseUp paste paste pause pause play play pointercancel pointerCancel pointerdown pointerDown pointerup pointerUp ratechange rateChange reset reset seeked seeked submit submit touchcancel touchCancel touchend touchEnd touchstart touchStart volumechange volumeChange".split(" "),
0);Sd("drag drag dragenter dragEnter dragexit dragExit dragleave dragLeave dragover dragOver mousemove mouseMove mouseout mouseOut mouseover mouseOver pointermove pointerMove pointerout pointerOut pointerover pointerOver scroll scroll toggle toggle touchmove touchMove wheel wheel".split(" "),1);Sd(Rj,2);(function(a,b){for(var c=0;c<a.length;c++)Td.set(a[c],b)})("change selectionchange textInput compositionstart compositionend compositionupdate".split(" "),0);var Hi=Zh,Gi=Pd,tc=!0,Kb={animationIterationCount:!0,
borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,
strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Sj=["Webkit","ms","Moz","O"];Object.keys(Kb).forEach(function(a){Sj.forEach(function(b){b=b+a.charAt(0).toUpperCase()+a.substring(1);Kb[b]=Kb[a]})});var Ii=M({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0}),ng="$",og="/$",$d="$?",Zd="$!",Ze=null,$e=null,We="function"===typeof setTimeout?setTimeout:void 0,vj="function"===
typeof clearTimeout?clearTimeout:void 0,jf=Math.random().toString(36).slice(2),Aa="__reactInternalInstance$"+jf,vc="__reactEventHandlers$"+jf,Lb="__reactContainere$"+jf,Ba=null,ce=null,wc=null;M(R.prototype,{preventDefault:function(){this.defaultPrevented=!0;var a=this.nativeEvent;a&&(a.preventDefault?a.preventDefault():"unknown"!==typeof a.returnValue&&(a.returnValue=!1),this.isDefaultPrevented=xc)},stopPropagation:function(){var a=this.nativeEvent;a&&(a.stopPropagation?a.stopPropagation():"unknown"!==
typeof a.cancelBubble&&(a.cancelBubble=!0),this.isPropagationStopped=xc)},persist:function(){this.isPersistent=xc},isPersistent:yc,destructor:function(){var a=this.constructor.Interface,b;for(b in a)this[b]=null;this.nativeEvent=this._targetInst=this.dispatchConfig=null;this.isPropagationStopped=this.isDefaultPrevented=yc;this._dispatchInstances=this._dispatchListeners=null}});R.Interface={type:null,target:null,currentTarget:function(){return null},eventPhase:null,bubbles:null,cancelable:null,timeStamp:function(a){return a.timeStamp||
Date.now()},defaultPrevented:null,isTrusted:null};R.extend=function(a){function b(){return c.apply(this,arguments)}var c=this,d=function(){};d.prototype=c.prototype;d=new d;M(d,b.prototype);b.prototype=d;b.prototype.constructor=b;b.Interface=M({},c.Interface,a);b.extend=c.extend;sg(b);return b};sg(R);var Tj=R.extend({data:null}),Uj=R.extend({data:null}),Ni=[9,13,27,32],de=wa&&"CompositionEvent"in window,cc=null;wa&&"documentMode"in document&&(cc=document.documentMode);var Vj=wa&&"TextEvent"in window&&
!cc,xg=wa&&(!de||cc&&8<cc&&11>=cc),wg=String.fromCharCode(32),ua={beforeInput:{phasedRegistrationNames:{bubbled:"onBeforeInput",captured:"onBeforeInputCapture"},dependencies:["compositionend","keypress","textInput","paste"]},compositionEnd:{phasedRegistrationNames:{bubbled:"onCompositionEnd",captured:"onCompositionEndCapture"},dependencies:"blur compositionend keydown keypress keyup mousedown".split(" ")},compositionStart:{phasedRegistrationNames:{bubbled:"onCompositionStart",captured:"onCompositionStartCapture"},
dependencies:"blur compositionstart keydown keypress keyup mousedown".split(" ")},compositionUpdate:{phasedRegistrationNames:{bubbled:"onCompositionUpdate",captured:"onCompositionUpdateCapture"},dependencies:"blur compositionupdate keydown keypress keyup mousedown".split(" ")}},vg=!1,mb=!1,Wj={eventTypes:ua,extractEvents:function(a,b,c,d,e){var f;if(de)b:{switch(a){case "compositionstart":var g=ua.compositionStart;break b;case "compositionend":g=ua.compositionEnd;break b;case "compositionupdate":g=
ua.compositionUpdate;break b}g=void 0}else mb?tg(a,c)&&(g=ua.compositionEnd):"keydown"===a&&229===c.keyCode&&(g=ua.compositionStart);g?(xg&&"ko"!==c.locale&&(mb||g!==ua.compositionStart?g===ua.compositionEnd&&mb&&(f=rg()):(Ba=d,ce="value"in Ba?Ba.value:Ba.textContent,mb=!0)),e=Tj.getPooled(g,b,c,d),f?e.data=f:(f=ug(c),null!==f&&(e.data=f)),lb(e),f=e):f=null;(a=Vj?Oi(a,c):Pi(a,c))?(b=Uj.getPooled(ua.beforeInput,b,c,d),b.data=a,lb(b)):b=null;return null===f?b:null===b?f:[f,b]}},Qi={color:!0,date:!0,
datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0},Ag={change:{phasedRegistrationNames:{bubbled:"onChange",captured:"onChangeCapture"},dependencies:"blur change click focus input keydown keyup selectionchange".split(" ")}},Mb=null,Nb=null,kf=!1;wa&&(kf=Tf("input")&&(!document.documentMode||9<document.documentMode));var Xj={eventTypes:Ag,_isInputEventSupported:kf,extractEvents:function(a,b,c,d,e){e=b?Pa(b):window;var f=
e.nodeName&&e.nodeName.toLowerCase();if("select"===f||"input"===f&&"file"===e.type)var g=Si;else if(yg(e))if(kf)g=Wi;else{g=Ui;var h=Ti}else(f=e.nodeName)&&"input"===f.toLowerCase()&&("checkbox"===e.type||"radio"===e.type)&&(g=Vi);if(g&&(g=g(a,b)))return zg(g,c,d);h&&h(a,e,b);"blur"===a&&(a=e._wrapperState)&&a.controlled&&"number"===e.type&&Ed(e,"number",e.value)}},dc=R.extend({view:null,detail:null}),Yi={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"},di=0,ei=0,fi=!1,gi=!1,ec=dc.extend({screenX:null,
screenY:null,clientX:null,clientY:null,pageX:null,pageY:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,getModifierState:fe,button:null,buttons:null,relatedTarget:function(a){return a.relatedTarget||(a.fromElement===a.srcElement?a.toElement:a.fromElement)},movementX:function(a){if("movementX"in a)return a.movementX;var b=di;di=a.screenX;return fi?"mousemove"===a.type?a.screenX-b:0:(fi=!0,0)},movementY:function(a){if("movementY"in a)return a.movementY;var b=ei;ei=a.screenY;return gi?"mousemove"===
a.type?a.screenY-b:0:(gi=!0,0)}}),hi=ec.extend({pointerId:null,width:null,height:null,pressure:null,tangentialPressure:null,tiltX:null,tiltY:null,twist:null,pointerType:null,isPrimary:null}),fc={mouseEnter:{registrationName:"onMouseEnter",dependencies:["mouseout","mouseover"]},mouseLeave:{registrationName:"onMouseLeave",dependencies:["mouseout","mouseover"]},pointerEnter:{registrationName:"onPointerEnter",dependencies:["pointerout","pointerover"]},pointerLeave:{registrationName:"onPointerLeave",dependencies:["pointerout",
"pointerover"]}},Yj={eventTypes:fc,extractEvents:function(a,b,c,d,e){var f="mouseover"===a||"pointerover"===a,g="mouseout"===a||"pointerout"===a;if(f&&0===(e&32)&&(c.relatedTarget||c.fromElement)||!g&&!f)return null;f=d.window===d?d:(f=d.ownerDocument)?f.defaultView||f.parentWindow:window;if(g){if(g=b,b=(b=c.relatedTarget||c.toElement)?Bb(b):null,null!==b){var h=Na(b);if(b!==h||5!==b.tag&&6!==b.tag)b=null}}else g=null;if(g===b)return null;if("mouseout"===a||"mouseover"===a){var m=ec;var n=fc.mouseLeave;
var l=fc.mouseEnter;var k="mouse"}else if("pointerout"===a||"pointerover"===a)m=hi,n=fc.pointerLeave,l=fc.pointerEnter,k="pointer";a=null==g?f:Pa(g);f=null==b?f:Pa(b);n=m.getPooled(n,g,c,d);n.type=k+"leave";n.target=a;n.relatedTarget=f;c=m.getPooled(l,b,c,d);c.type=k+"enter";c.target=f;c.relatedTarget=a;d=g;k=b;if(d&&k)a:{m=d;l=k;g=0;for(a=m;a;a=pa(a))g++;a=0;for(b=l;b;b=pa(b))a++;for(;0<g-a;)m=pa(m),g--;for(;0<a-g;)l=pa(l),a--;for(;g--;){if(m===l||m===l.alternate)break a;m=pa(m);l=pa(l)}m=null}else m=
null;l=m;for(m=[];d&&d!==l;){g=d.alternate;if(null!==g&&g===l)break;m.push(d);d=pa(d)}for(d=[];k&&k!==l;){g=k.alternate;if(null!==g&&g===l)break;d.push(k);k=pa(k)}for(k=0;k<m.length;k++)be(m[k],"bubbled",n);for(k=d.length;0<k--;)be(d[k],"captured",c);return 0===(e&64)?[n]:[n,c]}},Qa="function"===typeof Object.is?Object.is:Zi,$i=Object.prototype.hasOwnProperty,Zj=wa&&"documentMode"in document&&11>=document.documentMode,Eg={select:{phasedRegistrationNames:{bubbled:"onSelect",captured:"onSelectCapture"},
dependencies:"blur contextmenu dragend focus keydown keyup mousedown mouseup selectionchange".split(" ")}},nb=null,he=null,Pb=null,ge=!1,ak={eventTypes:Eg,extractEvents:function(a,b,c,d,e,f){e=f||(d.window===d?d.document:9===d.nodeType?d:d.ownerDocument);if(!(f=!e)){a:{e=Jd(e);f=rd.onSelect;for(var g=0;g<f.length;g++)if(!e.has(f[g])){e=!1;break a}e=!0}f=!e}if(f)return null;e=b?Pa(b):window;switch(a){case "focus":if(yg(e)||"true"===e.contentEditable)nb=e,he=b,Pb=null;break;case "blur":Pb=he=nb=null;
break;case "mousedown":ge=!0;break;case "contextmenu":case "mouseup":case "dragend":return ge=!1,Dg(c,d);case "selectionchange":if(Zj)break;case "keydown":case "keyup":return Dg(c,d)}return null}},bk=R.extend({animationName:null,elapsedTime:null,pseudoElement:null}),ck=R.extend({clipboardData:function(a){return"clipboardData"in a?a.clipboardData:window.clipboardData}}),dk=dc.extend({relatedTarget:null}),ek={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",
Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},fk={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",
224:"Meta"},gk=dc.extend({key:function(a){if(a.key){var b=ek[a.key]||a.key;if("Unidentified"!==b)return b}return"keypress"===a.type?(a=Ac(a),13===a?"Enter":String.fromCharCode(a)):"keydown"===a.type||"keyup"===a.type?fk[a.keyCode]||"Unidentified":""},location:null,ctrlKey:null,shiftKey:null,altKey:null,metaKey:null,repeat:null,locale:null,getModifierState:fe,charCode:function(a){return"keypress"===a.type?Ac(a):0},keyCode:function(a){return"keydown"===a.type||"keyup"===a.type?a.keyCode:0},which:function(a){return"keypress"===
a.type?Ac(a):"keydown"===a.type||"keyup"===a.type?a.keyCode:0}}),hk=ec.extend({dataTransfer:null}),ik=dc.extend({touches:null,targetTouches:null,changedTouches:null,altKey:null,metaKey:null,ctrlKey:null,shiftKey:null,getModifierState:fe}),jk=R.extend({propertyName:null,elapsedTime:null,pseudoElement:null}),kk=ec.extend({deltaX:function(a){return"deltaX"in a?a.deltaX:"wheelDeltaX"in a?-a.wheelDeltaX:0},deltaY:function(a){return"deltaY"in a?a.deltaY:"wheelDeltaY"in a?-a.wheelDeltaY:"wheelDelta"in a?
-a.wheelDelta:0},deltaZ:null,deltaMode:null}),lk={eventTypes:dg,extractEvents:function(a,b,c,d,e){e=cg.get(a);if(!e)return null;switch(a){case "keypress":if(0===Ac(c))return null;case "keydown":case "keyup":a=gk;break;case "blur":case "focus":a=dk;break;case "click":if(2===c.button)return null;case "auxclick":case "dblclick":case "mousedown":case "mousemove":case "mouseup":case "mouseout":case "mouseover":case "contextmenu":a=ec;break;case "drag":case "dragend":case "dragenter":case "dragexit":case "dragleave":case "dragover":case "dragstart":case "drop":a=
hk;break;case "touchcancel":case "touchend":case "touchmove":case "touchstart":a=ik;break;case $h:case ai:case bi:a=bk;break;case ci:a=jk;break;case "scroll":a=dc;break;case "wheel":a=kk;break;case "copy":case "cut":case "paste":a=ck;break;case "gotpointercapture":case "lostpointercapture":case "pointercancel":case "pointerdown":case "pointermove":case "pointerout":case "pointerover":case "pointerup":a=hi;break;default:a=R}b=a.getPooled(e,b,c,d);lb(b);return b}};(function(a){if(ic)throw Error(k(101));
ic=Array.prototype.slice.call(a);nf()})("ResponderEventPlugin SimpleEventPlugin EnterLeaveEventPlugin ChangeEventPlugin SelectEventPlugin BeforeInputEventPlugin".split(" "));(function(a,b,c){td=a;rf=b;mf=c})(ae,Hb,Pa);pf({SimpleEventPlugin:lk,EnterLeaveEventPlugin:Yj,ChangeEventPlugin:Xj,SelectEventPlugin:ak,BeforeInputEventPlugin:Wj});var ie=[],ob=-1,Ca={},B={current:Ca},G={current:!1},Ra=Ca,bj=Pd,je=$f,Rg=Lj,aj=Nj,Dc=Oj,Ig=Zh,Jg=ag,Kg=Pj,Lg=Qj,Qg={},yj=Mj,Cj=void 0!==Yh?Yh:function(){},qa=null,
Ec=null,ke=!1,ii=ff(),Y=1E4>ii?ff:function(){return ff()-ii},Ic={current:null},Hc=null,qb=null,Gc=null,Tg=0,Jc=2,Ga=!1,Vb=da.ReactCurrentBatchConfig,$g=(new ea.Component).refs,Mc={isMounted:function(a){return(a=a._reactInternalFiber)?Na(a)===a:!1},enqueueSetState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;d=Va(d,a,e);e=Ea(d,e);e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueReplaceState:function(a,b,c){a=a._reactInternalFiber;var d=ka(),e=Vb.suspense;
d=Va(d,a,e);e=Ea(d,e);e.tag=1;e.payload=b;void 0!==c&&null!==c&&(e.callback=c);Fa(a,e);Ja(a,d)},enqueueForceUpdate:function(a,b){a=a._reactInternalFiber;var c=ka(),d=Vb.suspense;c=Va(c,a,d);d=Ea(c,d);d.tag=Jc;void 0!==b&&null!==b&&(d.callback=b);Fa(a,d);Ja(a,c)}},Qc=Array.isArray,wb=ah(!0),Fe=ah(!1),Sb={},ja={current:Sb},Ub={current:Sb},Tb={current:Sb},D={current:0},Sc=da.ReactCurrentDispatcher,X=da.ReactCurrentBatchConfig,Ia=0,z=null,K=null,J=null,Uc=!1,Tc={readContext:W,useCallback:S,useContext:S,
useEffect:S,useImperativeHandle:S,useLayoutEffect:S,useMemo:S,useReducer:S,useRef:S,useState:S,useDebugValue:S,useResponder:S,useDeferredValue:S,useTransition:S},dj={readContext:W,useCallback:ih,useContext:W,useEffect:eh,useImperativeHandle:function(a,b,c){c=null!==c&&void 0!==c?c.concat([a]):null;return ze(4,2,gh.bind(null,b,a),c)},useLayoutEffect:function(a,b){return ze(4,2,a,b)},useMemo:function(a,b){var c=ub();b=void 0===b?null:b;a=a();c.memoizedState=[a,b];return a},useReducer:function(a,b,c){var d=
ub();b=void 0!==c?c(b):b;d.memoizedState=d.baseState=b;a=d.queue={pending:null,dispatch:null,lastRenderedReducer:a,lastRenderedState:b};a=a.dispatch=ch.bind(null,z,a);return[d.memoizedState,a]},useRef:function(a){var b=ub();a={current:a};return b.memoizedState=a},useState:xe,useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=xe(a),d=c[0],e=c[1];eh(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=
xe(!1),c=b[0];b=b[1];return[ih(Ce.bind(null,b,a),[b,a]),c]}},ej={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Vc,useRef:dh,useState:function(a){return Vc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Vc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Vc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,
b,a),[b,a]),c]}},fj={readContext:W,useCallback:Yc,useContext:W,useEffect:Xc,useImperativeHandle:hh,useLayoutEffect:fh,useMemo:jh,useReducer:Wc,useRef:dh,useState:function(a){return Wc(Ua)},useDebugValue:Be,useResponder:ue,useDeferredValue:function(a,b){var c=Wc(Ua),d=c[0],e=c[1];Xc(function(){var c=X.suspense;X.suspense=void 0===b?null:b;try{e(a)}finally{X.suspense=c}},[a,b]);return d},useTransition:function(a){var b=Wc(Ua),c=b[0];b=b[1];return[Yc(Ce.bind(null,b,a),[b,a]),c]}},ra=null,Ka=null,Wa=
!1,gj=da.ReactCurrentOwner,ia=!1,Je={dehydrated:null,retryTime:0};var jj=function(a,b,c,d){for(c=b.child;null!==c;){if(5===c.tag||6===c.tag)a.appendChild(c.stateNode);else if(4!==c.tag&&null!==c.child){c.child.return=c;c=c.child;continue}if(c===b)break;for(;null===c.sibling;){if(null===c.return||c.return===b)return;c=c.return}c.sibling.return=c.return;c=c.sibling}};var wh=function(a){};var ij=function(a,b,c,d,e){var f=a.memoizedProps;if(f!==d){var g=b.stateNode;Ta(ja.current);a=null;switch(c){case "input":f=
Cd(g,f);d=Cd(g,d);a=[];break;case "option":f=Fd(g,f);d=Fd(g,d);a=[];break;case "select":f=M({},f,{value:void 0});d=M({},d,{value:void 0});a=[];break;case "textarea":f=Gd(g,f);d=Gd(g,d);a=[];break;default:"function"!==typeof f.onClick&&"function"===typeof d.onClick&&(g.onclick=uc)}Ud(c,d);var h,m;c=null;for(h in f)if(!d.hasOwnProperty(h)&&f.hasOwnProperty(h)&&null!=f[h])if("style"===h)for(m in g=f[h],g)g.hasOwnProperty(m)&&(c||(c={}),c[m]="");else"dangerouslySetInnerHTML"!==h&&"children"!==h&&"suppressContentEditableWarning"!==
h&&"suppressHydrationWarning"!==h&&"autoFocus"!==h&&(db.hasOwnProperty(h)?a||(a=[]):(a=a||[]).push(h,null));for(h in d){var k=d[h];g=null!=f?f[h]:void 0;if(d.hasOwnProperty(h)&&k!==g&&(null!=k||null!=g))if("style"===h)if(g){for(m in g)!g.hasOwnProperty(m)||k&&k.hasOwnProperty(m)||(c||(c={}),c[m]="");for(m in k)k.hasOwnProperty(m)&&g[m]!==k[m]&&(c||(c={}),c[m]=k[m])}else c||(a||(a=[]),a.push(h,c)),c=k;else"dangerouslySetInnerHTML"===h?(k=k?k.__html:void 0,g=g?g.__html:void 0,null!=k&&g!==k&&(a=a||
[]).push(h,k)):"children"===h?g===k||"string"!==typeof k&&"number"!==typeof k||(a=a||[]).push(h,""+k):"suppressContentEditableWarning"!==h&&"suppressHydrationWarning"!==h&&(db.hasOwnProperty(h)?(null!=k&&oa(e,h),a||g===k||(a=[])):(a=a||[]).push(h,k))}c&&(a=a||[]).push("style",c);e=a;if(b.updateQueue=e)b.effectTag|=4}};var kj=function(a,b,c,d){c!==d&&(b.effectTag|=4)};var pj="function"===typeof WeakSet?WeakSet:Set,wj="function"===typeof WeakMap?WeakMap:Map,sj=Math.ceil,gd=da.ReactCurrentDispatcher,
Uh=da.ReactCurrentOwner,H=0,Ye=8,ca=16,ma=32,Xa=0,hd=1,Oh=2,ad=3,bd=4,Xe=5,p=H,U=null,t=null,P=0,F=Xa,id=null,ta=1073741823,Yb=1073741823,kd=null,Xb=0,jd=!1,Re=0,Ph=500,l=null,cd=!1,Se=null,La=null,ld=!1,Zb=null,$b=90,bb=null,ac=0,af=null,dd=0,Ja=function(a,b){if(50<ac)throw ac=0,af=null,Error(k(185));a=ed(a,b);if(null!==a){var c=Cc();1073741823===b?(p&Ye)!==H&&(p&(ca|ma))===H?Te(a):(V(a),p===H&&ha()):V(a);(p&4)===H||98!==c&&99!==c||(null===bb?bb=new Map([[a,b]]):(c=bb.get(a),(void 0===c||c>b)&&bb.set(a,
b)))}};var zj=function(a,b,c){var d=b.expirationTime;if(null!==a){var e=b.pendingProps;if(a.memoizedProps!==e||G.current)ia=!0;else{if(d<c){ia=!1;switch(b.tag){case 3:sh(b);Ee();break;case 5:bh(b);if(b.mode&4&&1!==c&&e.hidden)return b.expirationTime=b.childExpirationTime=1,null;break;case 1:N(b.type)&&Bc(b);break;case 4:se(b,b.stateNode.containerInfo);break;case 10:d=b.memoizedProps.value;e=b.type._context;y(Ic,e._currentValue);e._currentValue=d;break;case 13:if(null!==b.memoizedState){d=b.child.childExpirationTime;
if(0!==d&&d>=c)return th(a,b,c);y(D,D.current&1);b=sa(a,b,c);return null!==b?b.sibling:null}y(D,D.current&1);break;case 19:d=b.childExpirationTime>=c;if(0!==(a.effectTag&64)){if(d)return vh(a,b,c);b.effectTag|=64}e=b.memoizedState;null!==e&&(e.rendering=null,e.tail=null);y(D,D.current);if(!d)return null}return sa(a,b,c)}ia=!1}}else ia=!1;b.expirationTime=0;switch(b.tag){case 2:d=b.type;null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;e=pb(b,B.current);rb(b,c);e=we(null,
b,d,a,e,c);b.effectTag|=1;if("object"===typeof e&&null!==e&&"function"===typeof e.render&&void 0===e.$$typeof){b.tag=1;b.memoizedState=null;b.updateQueue=null;if(N(d)){var f=!0;Bc(b)}else f=!1;b.memoizedState=null!==e.state&&void 0!==e.state?e.state:null;ne(b);var g=d.getDerivedStateFromProps;"function"===typeof g&&Lc(b,d,g,a);e.updater=Mc;b.stateNode=e;e._reactInternalFiber=b;pe(b,d,a,c);b=Ie(null,b,d,!0,f,c)}else b.tag=0,T(null,b,e,c),b=b.child;return b;case 16:a:{e=b.elementType;null!==a&&(a.alternate=
null,b.alternate=null,b.effectTag|=2);a=b.pendingProps;ri(e);if(1!==e._status)throw e._result;e=e._result;b.type=e;f=b.tag=Gj(e);a=aa(e,a);switch(f){case 0:b=He(null,b,e,a,c);break a;case 1:b=rh(null,b,e,a,c);break a;case 11:b=nh(null,b,e,a,c);break a;case 14:b=oh(null,b,e,aa(e.type,a),d,c);break a}throw Error(k(306,e,""));}return b;case 0:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),He(a,b,d,e,c);case 1:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),rh(a,b,d,e,c);
case 3:sh(b);d=b.updateQueue;if(null===a||null===d)throw Error(k(282));d=b.pendingProps;e=b.memoizedState;e=null!==e?e.element:null;oe(a,b);Qb(b,d,null,c);d=b.memoizedState.element;if(d===e)Ee(),b=sa(a,b,c);else{if(e=b.stateNode.hydrate)Ka=kb(b.stateNode.containerInfo.firstChild),ra=b,e=Wa=!0;if(e)for(c=Fe(b,null,d,c),b.child=c;c;)c.effectTag=c.effectTag&-3|1024,c=c.sibling;else T(a,b,d,c),Ee();b=b.child}return b;case 5:return bh(b),null===a&&De(b),d=b.type,e=b.pendingProps,f=null!==a?a.memoizedProps:
null,g=e.children,Yd(d,e)?g=null:null!==f&&Yd(d,f)&&(b.effectTag|=16),qh(a,b),b.mode&4&&1!==c&&e.hidden?(b.expirationTime=b.childExpirationTime=1,b=null):(T(a,b,g,c),b=b.child),b;case 6:return null===a&&De(b),null;case 13:return th(a,b,c);case 4:return se(b,b.stateNode.containerInfo),d=b.pendingProps,null===a?b.child=wb(b,null,d,c):T(a,b,d,c),b.child;case 11:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),nh(a,b,d,e,c);case 7:return T(a,b,b.pendingProps,c),b.child;case 8:return T(a,
b,b.pendingProps.children,c),b.child;case 12:return T(a,b,b.pendingProps.children,c),b.child;case 10:a:{d=b.type._context;e=b.pendingProps;g=b.memoizedProps;f=e.value;var h=b.type._context;y(Ic,h._currentValue);h._currentValue=f;if(null!==g)if(h=g.value,f=Qa(h,f)?0:("function"===typeof d._calculateChangedBits?d._calculateChangedBits(h,f):1073741823)|0,0===f){if(g.children===e.children&&!G.current){b=sa(a,b,c);break a}}else for(h=b.child,null!==h&&(h.return=b);null!==h;){var m=h.dependencies;if(null!==
m){g=h.child;for(var l=m.firstContext;null!==l;){if(l.context===d&&0!==(l.observedBits&f)){1===h.tag&&(l=Ea(c,null),l.tag=Jc,Fa(h,l));h.expirationTime<c&&(h.expirationTime=c);l=h.alternate;null!==l&&l.expirationTime<c&&(l.expirationTime=c);Sg(h.return,c);m.expirationTime<c&&(m.expirationTime=c);break}l=l.next}}else g=10===h.tag?h.type===b.type?null:h.child:h.child;if(null!==g)g.return=h;else for(g=h;null!==g;){if(g===b){g=null;break}h=g.sibling;if(null!==h){h.return=g.return;g=h;break}g=g.return}h=
g}T(a,b,e.children,c);b=b.child}return b;case 9:return e=b.type,f=b.pendingProps,d=f.children,rb(b,c),e=W(e,f.unstable_observedBits),d=d(e),b.effectTag|=1,T(a,b,d,c),b.child;case 14:return e=b.type,f=aa(e,b.pendingProps),f=aa(e.type,f),oh(a,b,e,f,d,c);case 15:return ph(a,b,b.type,b.pendingProps,d,c);case 17:return d=b.type,e=b.pendingProps,e=b.elementType===d?e:aa(d,e),null!==a&&(a.alternate=null,b.alternate=null,b.effectTag|=2),b.tag=1,N(d)?(a=!0,Bc(b)):a=!1,rb(b,c),Yg(b,d,e),pe(b,d,e,c),Ie(null,
b,d,!0,a,c);case 19:return vh(a,b,c)}throw Error(k(156,b.tag));};var bf=null,Ne=null,la=function(a,b,c,d){return new Fj(a,b,c,d)};ef.prototype.render=function(a){md(a,this._internalRoot,null,null)};ef.prototype.unmount=function(){var a=this._internalRoot,b=a.containerInfo;md(null,a,null,function(){b[Lb]=null})};var Di=function(a){if(13===a.tag){var b=Fc(ka(),150,100);Ja(a,b);df(a,b)}};var Yf=function(a){13===a.tag&&(Ja(a,3),df(a,3))};var Bi=function(a){if(13===a.tag){var b=ka();b=Va(b,a,null);Ja(a,
b);df(a,b)}};sd=function(a,b,c){switch(b){case "input":Dd(a,c);b=c.name;if("radio"===c.type&&null!=b){for(c=a;c.parentNode;)c=c.parentNode;c=c.querySelectorAll("input[name="+JSON.stringify(""+b)+'][type="radio"]');for(b=0;b<c.length;b++){var d=c[b];if(d!==a&&d.form===a.form){var e=ae(d);if(!e)throw Error(k(90));Gf(d);Dd(d,e)}}}break;case "textarea":Lf(a,c);break;case "select":b=c.value,null!=b&&hb(a,!!c.multiple,b,!1)}};(function(a,b,c,d){ee=a;eg=b;vd=c;vf=d})(Qh,function(a,b,c,d,e){var f=p;p|=4;
try{return Da(98,a.bind(null,b,c,d,e))}finally{p=f,p===H&&ha()}},function(){(p&(1|ca|ma))===H&&(uj(),xb())},function(a,b){var c=p;p|=2;try{return a(b)}finally{p=c,p===H&&ha()}});var mk={Events:[Hb,Pa,ae,pf,qd,lb,function(a){Kd(a,Ki)},sf,tf,sc,pc,xb,{current:!1}]};(function(a){var b=a.findFiberByHostInstance;return Ej(M({},a,{overrideHookState:null,overrideProps:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:da.ReactCurrentDispatcher,findHostInstanceByFiber:function(a){a=Sf(a);
return null===a?null:a.stateNode},findFiberByHostInstance:function(a){return b?b(a):null},findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null}))})({findFiberByHostInstance:Bb,bundleType:0,version:"16.13.1",rendererPackageName:"react-dom"});I.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=mk;I.createPortal=Xh;I.findDOMNode=function(a){if(null==a)return null;if(1===a.nodeType)return a;var b=a._reactInternalFiber;if(void 0===
b){if("function"===typeof a.render)throw Error(k(188));throw Error(k(268,Object.keys(a)));}a=Sf(b);a=null===a?null:a.stateNode;return a};I.flushSync=function(a,b){if((p&(ca|ma))!==H)throw Error(k(187));var c=p;p|=1;try{return Da(99,a.bind(null,b))}finally{p=c,ha()}};I.hydrate=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!0,c)};I.render=function(a,b,c){if(!bc(b))throw Error(k(200));return nd(null,a,b,!1,c)};I.unmountComponentAtNode=function(a){if(!bc(a))throw Error(k(40));return a._reactRootContainer?
(Rh(function(){nd(null,null,a,!1,function(){a._reactRootContainer=null;a[Lb]=null})}),!0):!1};I.unstable_batchedUpdates=Qh;I.unstable_createPortal=function(a,b){return Xh(a,b,2<arguments.length&&void 0!==arguments[2]?arguments[2]:null)};I.unstable_renderSubtreeIntoContainer=function(a,b,c,d){if(!bc(c))throw Error(k(200));if(null==a||void 0===a._reactInternalFiber)throw Error(k(38));return nd(a,b,c,!1,d)};I.version="16.13.1"});
</script>
    <script>const e = React.createElement;

function pathToString(path) {
  if (path[0] === '/') {
    return '/' + path.slice(1).join('/');
  } else {
    return path.join('/');
  }
}

function findCommonPath(files) {
  if (!files || !files.length) {
    return [];
  }

  function isPrefix(arr, prefix) {
    if (arr.length < prefix.length) {
      return false;
    }
    for (let i = prefix.length - 1; i >= 0; --i) {
      if (arr[i] !== prefix[i]) {
        return false;
      }
    }
    return true;
  }

  let commonPath = files[0].path.slice(0, -1);
  while (commonPath.length) {
    if (files.every(file => isPrefix(file.path, commonPath))) {
      break;
    }
    commonPath.pop();
  }
  return commonPath;
}

function findFolders(files) {
  if (!files || !files.length) {
    return [];
  }

  let folders = files.filter(file => file.path.length > 1).map(file => file.path[0]);
  folders = [...new Set(folders)]; // unique
  folders.sort();

  folders = folders.map(folder => {
    let filesInFolder = files
      .filter(file => file.path[0] === folder)
      .map(file => ({
        ...file,
        path: file.path.slice(1),
        parent: [...file.parent, file.path[0]],
      }));

    const children = findFolders(filesInFolder); // recursion

    return {
      is_folder: true,
      path: [folder],
      parent: files[0].parent,
      children,
      covered: children.reduce((sum, file) => sum + file.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.coverable, 0),
      prevRun: {
        covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
        coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
      },
    };
  });

  return [...folders, ...files.filter(file => file.path.length === 1)];
}

class App extends React.Component {
  constructor(...args) {
    super(...args);

    this.state = {
      current: [],
    };
  }

  componentDidMount() {
    this.updateStateFromLocation();
    window.addEventListener('hashchange', () => this.updateStateFromLocation(), false);
  }

  updateStateFromLocation() {
    if (window.location.hash.length > 1) {
      const current = window.location.hash.slice(1).split('/');
      this.setState({current});
    } else {
      this.setState({current: []});
    }
  }

  getCurrentPath() {
    let file = this.props.root;
    let path = [file];
    for (let p of this.state.current) {
      file = file.children.find(file => file.path[0] === p);
      if (!file) {
        return path;
      }
      path.push(file);
    }
    return path;
  }

  render() {
    const path = this.getCurrentPath();
    const file = path[path.length - 1];

    let w = null;
    if (file.is_folder) {
      w = e(FilesList, {
        folder: file,
        onSelectFile: this.selectFile.bind(this),
        onBack: path.length > 1 ? this.back.bind(this) : null,
      });
    } else {
      w = e(DisplayFile, {
        file,
        onBack: this.back.bind(this),
      });
    }

    return e('div', {className: 'app'}, w);
  }

  selectFile(file) {
    this.setState(
      ({current}) => {
        return {current: [...current, file.path[0]]};
      },
      () => this.updateHash(),
    );
  }

  back(file) {
    this.setState(
      ({current}) => {
        return {current: current.slice(0, current.length - 1)};
      },
      () => this.updateHash(),
    );
  }

  updateHash() {
    if (!this.state.current || !this.state.current.length) {
      window.location = '#';
    } else {
      window.location = '#' + this.state.current.join('/');
    }
  }
}

function FilesList({folder, onSelectFile, onBack}) {
  let files = folder.children;
  return e(
    'div',
    {className: 'display-folder'},
    e(FileHeader, {file: folder, onBack}),
    e(
      'table',
      {className: 'files-list'},
      e('thead', {className: 'files-list__head'}, e('tr', null, e('th', null, 'Path'), e('th', null, 'Coverage'))),
      e(
        'tbody',
        {className: 'files-list__body'},
        files.map(file => e(File, {file, onClick: onSelectFile})),
      ),
    ),
  );
}

function File({file, onClick}) {
  const coverage = file.coverable ? (file.covered / file.coverable) * 100 : -1;
  const coverageDelta =
    file.prevRun && (file.covered / file.coverable) * 100 - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'tr',
    {
      className:
        'files-list__file' +
        (coverage >= 0 && coverage < 50 ? ' files-list__file_low' : '') +
        (coverage >= 50 && coverage < 80 ? ' files-list__file_medium' : '') +
        (coverage >= 80 ? ' files-list__file_high' : '') +
        (file.is_folder ? ' files-list__file_folder' : ''),
      onClick: () => onClick(file),
    },
    e('td', null, e('a', null, pathToString(file.path))),
    e(
      'td',
      null,
      file.covered + ' / ' + file.coverable + (coverage >= 0 ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
    ),
  );
}

function DisplayFile({file, onBack}) {
  return e('div', {className: 'display-file'}, e(FileHeader, {file, onBack}), e(FileContent, {file}));
}

function FileHeader({file, onBack}) {
  const coverage = (file.covered / file.coverable) * 100;
  const coverageDelta = file.prevRun && coverage - (file.prevRun.covered / file.prevRun.coverable) * 100;

  return e(
    'div',
    {className: 'file-header'},
    onBack ? e('a', {className: 'file-header__back', onClick: onBack}, 'Back') : null,
    e('div', {className: 'file-header__name'}, pathToString([...file.parent, ...file.path])),
    e(
      'div',
      {className: 'file-header__stat'},
      'Covered: ' + file.covered + ' of ' + file.coverable + (file.coverable ? ' (' + coverage.toFixed(2) + '%)' : ''),
      e(
        'span',
        {title: 'Change from the previous run'},
        coverageDelta ? ` (${coverageDelta > 0 ? '+' : ''}${coverageDelta.toFixed(2)}%)` : '',
      ),
      e('input', {id: 'theme-toggle', type: 'checkbox', hidden: true}),
      e('label', {for: 'theme-toggle', id: 'theme-toggle-label'}, ''),
    ),
  );
}

function FileContent({file}) {
  return e(
    'pre',
    {className: 'file-content'},
    file.content.split(/\r?\n/).map((line, index) => {
      const trace = file.traces.find(trace => trace.line === index + 1);
      const covered = trace && trace.stats.Line;
      const uncovered = trace && !trace.stats.Line;
      const nbHit = covered? trace.stats.Line: 0;
      return e(
        'div',
        { className: 'code-text-container' },
        e(
          'code',
          {
            className: 'code-line' + (covered ? ' code-line_covered' : '') + (uncovered ? ' code-line_uncovered' : ''),
          },
          line
        ),
        e(
          'div',
          { className: 'cover-indicator' + (covered? ' check-cover': '') + (uncovered? ' no-cover': '')},
          e(
            'div',
            { className: (covered? 'stat-line-hit': '')},
            covered? nbHit: ""
          )
        )
      );
    }),
  );
}

(function () {
  const commonPath = findCommonPath(data.files);
  const prevFilesMap = new Map();

  previousData &&
    previousData.files.forEach(file => {
      const path = file.path.slice(commonPath.length).join('/');
      prevFilesMap.set(path, file);
    });

  const files = data.files.map(file => {
    const path = file.path.slice(commonPath.length);
    const {covered = 0, coverable = 0} = prevFilesMap.get(path.join('/')) || {};
    return {
      ...file,
      path,
      parent: commonPath,
      prevRun: {covered, coverable},
    };
  });

  const children = findFolders(files);

  const root = {
    is_folder: true,
    children,
    path: commonPath,
    parent: [],
    covered: children.reduce((sum, file) => sum + file.covered, 0),
    coverable: children.reduce((sum, file) => sum + file.coverable, 0),
    prevRun: {
      covered: children.reduce((sum, file) => sum + file.prevRun.covered, 0),
      coverable: children.reduce((sum, file) => sum + file.prevRun.coverable, 0),
    },
  };

  ReactDOM.render(e(App, {root, prevFilesMap}), document.getElementById('root'));

  const toggle = document.getElementById('theme-toggle');
  const label = document.getElementById('theme-toggle-label');
  label.textContent = '';

  toggle.addEventListener('change', () => {
    if (toggle.checked) {
      document.documentElement.setAttribute('data-theme', 'dark');
      label.textContent = '';
    } else {
      document.documentElement.removeAttribute('data-theme');
      label.textContent = '';
    }
  });
})();
</script>
</body>
</html>